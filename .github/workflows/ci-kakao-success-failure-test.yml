name: CI - Kakao μ„±κ³µ/μ‹¤ν¨ μ•λ¦Ό ν…μ¤νΈ

on:
  push:
    branches: [ "develop" ]
  workflow_dispatch: # μλ™ μ‹¤ν–‰ κ°€λ¥

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      # 1) μ €μ¥μ† μ²΄ν¬μ•„μ›ƒ
      - name: Checkout code
        uses: actions/checkout@v4

      # 2) Node.js μ„Έν…
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      # 3) μμ΅΄μ„± μ„¤μΉ
      - name: Install deps
        run: npm install --legacy-peer-deps

      # 4) β… μ„±κ³µ μ•λ¦Ό ν…μ¤νΈ
      - name: Notify n8n Kakao Success
        run: |
          curl -X POST https://<YOUR_N8N_URL>/webhook/ci-kakao-alert \
          -H "Content-Type: application/json" \
          -d '{
            "status": "success",
            "repo": "jaeman-vibe",
            "branch": "develop",
            "author": "ν•λ‹"
          }'

      # 5) β μ‹¤ν¨ μ•λ¦Ό ν…μ¤νΈ
      - name: Notify n8n Kakao Failure
        run: |
          curl -X POST https://<YOUR_N8N_URL>/webhook/ci-kakao-alert \
          -H "Content-Type: application/json" \
          -d '{
            "status": "failure",
            "repo": "jaeman-vibe",
            "branch": "develop",
            "author": "ν•λ‹"
          }'

      # 6) π€ μ‹¤μ  CI κ²°κ³Ό μ•λ¦Ό (μ„ νƒμ‚¬ν•­)
      - name: Notify n8n Kakao Real CI Result
        if: always()
        run: |
          curl -X POST https://<YOUR_N8N_URL>/webhook/ci-kakao-alert \
          -H "Content-Type: application/json" \
          -d '{
            "status": "${{ job.status }}",
            "repo": "${{ github.repository }}",
            "branch": "${{ github.ref_name }}",
            "author": "${{ github.actor }}"
          }'
