# 🔒 보안 규칙 가이드

이 문서는 Firebase 보안 규칙 설정과 사용법에 대해 설명합니다.

## 📋 개요

Firebase 보안 규칙은 데이터베이스와 스토리지에 대한 접근을 제어하는 중요한 보안 메커니즘입니다. 이 프로젝트에서는 환경별로 다른 보안 규칙을 적용할 수 있도록 구성되어 있습니다.

## 🏗️ 보안 규칙 구조

### Firestore 규칙
- **프로덕션**: `firestore.rules.production` - 엄격한 보안 규칙
- **개발**: `firestore.rules.development` - 유연한 보안 규칙
- **현재 적용**: `firestore.rules` - 현재 활성화된 규칙

### Storage 규칙
- **프로덕션**: `storage.rules.production` - 엄격한 보안 규칙
- **개발**: `storage.rules.development` - 유연한 보안 규칙
- **현재 적용**: `storage.rules` - 현재 활성화된 규칙

## 🚀 사용법

### 1. 환경별 보안 규칙 적용

```bash
# 개발 환경 규칙 적용
npm run security:dev

# 프로덕션 환경 규칙 적용
npm run security:prod
```

### 2. 보안 규칙 테스트

```bash
# 보안 규칙 테스트 실행
npm run security:test
```

**주의**: 테스트 실행 전에 Firebase 에뮬레이터가 실행 중이어야 합니다.

### 3. Firebase 배포

```bash
# 전체 배포
npm run firebase:deploy

# 보안 규칙만 배포
npm run firebase:deploy:rules
```

## 🔐 보안 규칙 상세

### Firestore 보안 규칙

#### 프로덕션 환경
- **기본 정책**: 모든 접근 거부
- **사용자 프로필**: 자신의 프로필만 읽기/쓰기
- **상품 아이템**: 인증된 사용자 읽기, 소유자만 쓰기
- **찜하기**: 자신의 찜만 읽기/쓰기
- **상태 변경 이력**: 소유자만 읽기, 생성은 소유자만, 수정/삭제 금지
- **관리자 전용**: 설정, 카테고리, 지역 정보 등

#### 개발 환경
- **기본 정책**: 인증된 사용자만 접근
- **더 유연한 규칙**: 개발 중 테스트를 위한 완화된 규칙
- **임시 데이터**: 개발용 임시 데이터 접근 허용

### Storage 보안 규칙

#### 프로덕션 환경
- **기본 정책**: 모든 접근 거부
- **사용자 프로필**: 자신의 프로필 이미지만 읽기/쓰기
- **상품 이미지**: 인증된 사용자 읽기, 소유자만 쓰기
- **공개 이미지**: 모든 사용자 읽기, 인증된 사용자만 쓰기
- **임시 업로드**: 소유자만 읽기/쓰기

#### 개발 환경
- **기본 정책**: 인증된 사용자만 접근
- **더 유연한 규칙**: 개발 중 테스트를 위한 완화된 규칙
- **개발용 임시 파일**: 인증된 사용자 접근 허용

## 🧪 테스트

### 보안 규칙 테스트 항목

1. **인증되지 않은 사용자 접근 차단**
   - 상품 생성/수정/삭제 시도
   - 파일 업로드 시도
   - 데이터 읽기 시도

2. **권한 없는 사용자 접근 차단**
   - 다른 사용자의 상품 수정 시도
   - 다른 사용자의 폴더에 파일 업로드 시도
   - 다른 사용자의 찜하기 접근 시도

3. **권한 있는 사용자 접근 허용**
   - 자신의 상품 수정
   - 자신의 폴더에 파일 업로드
   - 자신의 찜하기 관리

### 테스트 실행 방법

```bash
# 1. Firebase 에뮬레이터 시작
firebase emulators:start

# 2. 새 터미널에서 보안 규칙 테스트 실행
npm run security:test
```

## ⚠️ 주의사항

### 프로덕션 배포 전 체크리스트

- [ ] 보안 규칙이 의도한 대로 작동하는지 확인
- [ ] 모든 테스트 케이스 통과 확인
- [ ] 권한 없는 사용자의 접근이 차단되는지 확인
- [ ] 권한 있는 사용자의 정상적인 접근이 허용되는지 확인
- [ ] 에러 메시지가 민감한 정보를 노출하지 않는지 확인

### 보안 규칙 수정 시 주의사항

1. **테스트 우선**: 수정된 규칙은 반드시 테스트 후 적용
2. **점진적 적용**: 큰 변경사항은 단계적으로 적용
3. **백업**: 기존 규칙은 백업 후 수정
4. **모니터링**: 적용 후 로그 모니터링으로 문제 확인

## 🔧 문제 해결

### 일반적인 문제

1. **권한 거부 오류**
   - 사용자 인증 상태 확인
   - 보안 규칙 문법 오류 확인
   - 데이터 소유권 확인

2. **테스트 실패**
   - 에뮬레이터 상태 확인
   - 테스트 데이터 정리
   - 규칙 문법 검증

3. **배포 실패**
   - 규칙 문법 오류 확인
   - Firebase 프로젝트 설정 확인
   - 권한 확인

### 디버깅 팁

1. **Firebase 콘솔 로그 확인**
2. **에뮬레이터 로그 확인**
3. **규칙 시뮬레이터 사용**
4. **단계별 규칙 테스트**

## 📚 추가 자료

- [Firebase 보안 규칙 공식 문서](https://firebase.google.com/docs/rules)
- [Firestore 보안 규칙 가이드](https://firebase.google.com/docs/firestore/security/get-started)
- [Storage 보안 규칙 가이드](https://firebase.google.com/docs/storage/security/get-started)
- [보안 규칙 테스트 가이드](https://firebase.google.com/docs/rules/unit-tests)

## 🤝 기여

보안 규칙 개선 제안이나 버그 리포트는 이슈로 등록해주세요.

---

**⚠️ 보안은 지속적인 과정입니다. 정기적으로 규칙을 검토하고 업데이트하세요.** 