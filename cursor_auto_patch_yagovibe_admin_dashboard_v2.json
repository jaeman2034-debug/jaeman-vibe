{
  "project": "YAGO VIBE - ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ v2.0 (í™•ì¥ ê¸°ëŠ¥)",
  "description": "ë‚ ì§œ í•„í„° + ê°ì • ë¶„ì„ ì°¨íŠ¸ + PDF ë‹¤ìš´ë¡œë“œ ì¶”ê°€",
  "author": "YAGO VIBE Team",
  "created": "2025-01-13",
  "extends": "cursor_auto_patch_yagovibe_admin_dashboard_v1.json",
  "new_features": [
    "ğŸ“… ê¸°ê°„ë³„ í•„í„° (ë‚ ì§œ ì„ íƒ UI)",
    "ğŸ˜Š AI ê°ì • ë¶„ì„ ì°¨íŠ¸ (BarChart)",
    "ğŸ“¤ ë¦¬í¬íŠ¸ PDF ë‹¤ìš´ë¡œë“œ ë²„íŠ¼"
  ],
  "steps": [
    {
      "step": 1,
      "action": "create",
      "file": "src/components/DateRangeFilter.tsx",
      "description": "âœ… ë‚ ì§œ ë²”ìœ„ ì„ íƒ í•„í„°",
      "content": "import { useState } from 'react';\nimport { Calendar } from 'lucide-react';\n\ntype DateRangeFilterProps = {\n  onFilterChange: (startDate: Date | null, endDate: Date | null) => void;\n};\n\nexport default function DateRangeFilter({ onFilterChange }: DateRangeFilterProps) {\n  const [startDate, setStartDate] = useState('');\n  const [endDate, setEndDate] = useState('');\n\n  const handleApply = () => {\n    const start = startDate ? new Date(startDate) : null;\n    const end = endDate ? new Date(endDate) : null;\n    onFilterChange(start, end);\n  };\n\n  const handleReset = () => {\n    setStartDate('');\n    setEndDate('');\n    onFilterChange(null, null);\n  };\n\n  return (\n    <div className='bg-white rounded-xl shadow-md p-4 mb-6'>\n      <div className='flex items-center gap-4 flex-wrap'>\n        <div className='flex items-center gap-2'>\n          <Calendar className='w-5 h-5 text-gray-500' />\n          <span className='text-sm font-semibold text-gray-700'>ê¸°ê°„ ì„ íƒ:</span>\n        </div>\n        <div className='flex items-center gap-2'>\n          <label className='text-sm text-gray-600'>ì‹œì‘ì¼:</label>\n          <input type='date' value={startDate} onChange={(e) => setStartDate(e.target.value)} className='border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500' />\n        </div>\n        <div className='flex items-center gap-2'>\n          <label className='text-sm text-gray-600'>ì¢…ë£Œì¼:</label>\n          <input type='date' value={endDate} onChange={(e) => setEndDate(e.target.value)} className='border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500' />\n        </div>\n        <button onClick={handleApply} className='bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-colors'>ì ìš©</button>\n        <button onClick={handleReset} className='bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg text-sm font-semibold transition-colors'>ì´ˆê¸°í™”</button>\n      </div>\n    </div>\n  );\n}"
    },
    {
      "step": 2,
      "action": "create",
      "file": "src/components/SentimentChart.tsx",
      "description": "âœ… AI ê°ì • ë¶„ì„ ì°¨íŠ¸ (BarChart)",
      "content": "import { useEffect, useState } from 'react';\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, Cell } from 'recharts';\nimport { collection, getDocs } from 'firebase/firestore';\nimport { db } from '../lib/firebase';\n\nconst COLORS = {\n  ê¸ì •: '#10B981',\n  ì¤‘ë¦½: '#6B7280',\n  ë¶€ì •: '#EF4444',\n};\n\nexport default function SentimentChart() {\n  const [data, setData] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    const fetchSentiment = async () => {\n      try {\n        // chatEvents ë˜ëŠ” AI ë¶„ì„ ê²°ê³¼ì—ì„œ ê°ì • ë°ì´í„° ì§‘ê³„\n        const eventsSnap = await getDocs(collection(db, 'chatEvents'));\n        const sentiments = { ê¸ì •: 0, ì¤‘ë¦½: 0, ë¶€ì •: 0 };\n        \n        eventsSnap.forEach((doc) => {\n          const text = doc.data().text || '';\n          // ê°„ë‹¨í•œ ê°ì • ë¶„ì„ (ì‹¤ì œë¡œëŠ” AI ë¶„ì„ ê²°ê³¼ ì‚¬ìš©)\n          if (text.includes('ê°ì‚¬') || text.includes('ì¢‹ì•„') || text.includes('ì™„ë²½')) {\n            sentiments.ê¸ì •++;\n          } else if (text.includes('ì•ˆíƒ€ê¹') || text.includes('ì‹¤ë§') || text.includes('ë¶ˆë§Œ')) {\n            sentiments.ë¶€ì •++;\n          } else {\n            sentiments.ì¤‘ë¦½++;\n          }\n        });\n\n        const chartData = Object.entries(sentiments).map(([name, value]) => ({ name, value, color: COLORS[name] }));\n        setData(chartData);\n      } catch (error) {\n        console.error('ê°ì • ë¶„ì„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchSentiment();\n  }, []);\n\n  if (loading) return <div className='text-center py-8'><div className='animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto'></div></div>;\n  if (data.length === 0) return <div className='text-center py-8 text-gray-500'>ê°ì • ë¶„ì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div>;\n\n  return (\n    <ResponsiveContainer width='100%' height={300}>\n      <BarChart data={data}>\n        <CartesianGrid strokeDasharray='3 3' />\n        <XAxis dataKey='name' />\n        <YAxis />\n        <Tooltip />\n        <Legend />\n        <Bar dataKey='value' name='ë©”ì‹œì§€ ìˆ˜'>\n          {data.map((entry, index) => <Cell key={`cell-${index}`} fill={entry.color} />)}\n        </Bar>\n      </BarChart>\n    </ResponsiveContainer>\n  );\n}"
    },
    {
      "step": 3,
      "action": "create",
      "file": "src/components/PDFExportButton.tsx",
      "description": "âœ… PDF ë‹¤ìš´ë¡œë“œ ë²„íŠ¼",
      "content": "import { Download } from 'lucide-react';\nimport jsPDF from 'jspdf';\nimport html2canvas from 'html2canvas';\n\ntype PDFExportButtonProps = {\n  targetId: string;\n  filename?: string;\n};\n\nexport default function PDFExportButton({ targetId, filename = 'yagovibe-report.pdf' }: PDFExportButtonProps) {\n  const [exporting, setExporting] = useState(false);\n\n  const handleExport = async () => {\n    setExporting(true);\n    try {\n      const element = document.getElementById(targetId);\n      if (!element) {\n        alert('ëŒ€ì‹œë³´ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');\n        return;\n      }\n\n      // HTMLì„ Canvasë¡œ ë³€í™˜\n      const canvas = await html2canvas(element, {\n        scale: 2,\n        useCORS: true,\n        logging: false,\n      });\n\n      // Canvasë¥¼ PDFë¡œ ë³€í™˜\n      const imgData = canvas.toDataURL('image/png');\n      const pdf = new jsPDF({\n        orientation: 'portrait',\n        unit: 'mm',\n        format: 'a4',\n      });\n\n      const imgWidth = 210; // A4 width in mm\n      const imgHeight = (canvas.height * imgWidth) / canvas.width;\n\n      pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);\n      pdf.save(filename);\n\n      console.log('âœ… PDF ë‹¤ìš´ë¡œë“œ ì™„ë£Œ:', filename);\n    } catch (error) {\n      console.error('âŒ PDF ìƒì„± ì‹¤íŒ¨:', error);\n      alert('PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n    } finally {\n      setExporting(false);\n    }\n  };\n\n  return (\n    <button onClick={handleExport} disabled={exporting} className='flex items-center gap-2 bg-green-500 hover:bg-green-600 disabled:bg-gray-300 text-white px-4 py-2 rounded-lg font-semibold transition-colors shadow-md'>\n      <Download className='w-4 h-4' />\n      {exporting ? 'PDF ìƒì„± ì¤‘...' : 'PDF ë‹¤ìš´ë¡œë“œ'}\n    </button>\n  );\n}"
    },
    {
      "step": 4,
      "action": "update",
      "file": "src/pages/AdminChatDashboard.tsx",
      "description": "âœ… v2 ê¸°ëŠ¥ í†µí•© (ë‚ ì§œ í•„í„° + ê°ì • ë¶„ì„ + PDF)",
      "content": "import { useEffect, useState } from 'react';\nimport { collection, getDocs, query, orderBy, limit, where } from 'firebase/firestore';\nimport { db } from '../lib/firebase';\nimport { MessageCircle, TrendingUp, Users, Activity } from 'lucide-react';\nimport ReportCard from '../components/ReportCard';\nimport KeywordChart from '../components/KeywordChart';\nimport ChatTrendChart from '../components/ChatTrendChart';\nimport RecentChatLog from '../components/RecentChatLog';\nimport DateRangeFilter from '../components/DateRangeFilter';\nimport SentimentChart from '../components/SentimentChart';\nimport PDFExportButton from '../components/PDFExportButton';\n\nexport default function AdminChatDashboard() {\n  const [stats, setStats] = useState({ totalMessages: 0, totalRooms: 0, activeUsers: 0, todayMessages: 0 });\n  const [loading, setLoading] = useState(true);\n  const [dateRange, setDateRange] = useState({ start: null, end: null });\n\n  useEffect(() => {\n    const fetchStats = async () => {\n      try {\n        let eventsQuery = query(collection(db, 'chatEvents'));\n        \n        // ë‚ ì§œ í•„í„° ì ìš©\n        if (dateRange.start) {\n          eventsQuery = query(eventsQuery, where('createdAt', '>=', dateRange.start));\n        }\n        if (dateRange.end) {\n          eventsQuery = query(eventsQuery, where('createdAt', '<=', dateRange.end));\n        }\n\n        const eventsSnap = await getDocs(eventsQuery);\n        const totalMessages = eventsSnap.size;\n\n        const roomsSnap = await getDocs(collection(db, 'chatRooms'));\n        const totalRooms = roomsSnap.size;\n\n        const participants = new Set();\n        roomsSnap.forEach((doc) => {\n          const data = doc.data();\n          data.participants?.forEach((uid) => participants.add(uid));\n        });\n        const activeUsers = participants.size;\n\n        const today = new Date();\n        today.setHours(0, 0, 0, 0);\n        const todayQuery = query(collection(db, 'chatEvents'), where('createdAt', '>=', today));\n        const todaySnap = await getDocs(todayQuery);\n        const todayMessages = todaySnap.size;\n\n        setStats({ totalMessages, totalRooms, activeUsers, todayMessages });\n      } catch (error) {\n        console.error('í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', error);\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchStats();\n  }, [dateRange]);\n\n  const handleDateRangeChange = (start, end) => {\n    setDateRange({ start, end });\n    setLoading(true);\n  };\n\n  if (loading) {\n    return (\n      <div className='min-h-screen bg-gray-50 flex items-center justify-center'>\n        <div className='text-center'>\n          <div className='animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4'></div>\n          <p className='text-gray-500'>ëŒ€ì‹œë³´ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className='min-h-screen bg-gray-50'>\n      {/* í—¤ë” */}\n      <header className='bg-white shadow-sm border-b'>\n        <div className='max-w-7xl mx-auto px-4 py-6'>\n          <div className='flex items-center justify-between'>\n            <div>\n              <h1 className='text-2xl font-bold text-gray-800 flex items-center gap-3'>\n                <Activity className='w-8 h-8 text-blue-500' />\n                âš½ YAGO VIBE ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ v2.0\n              </h1>\n              <p className='text-sm text-gray-500 mt-1'>ì‹¤ì‹œê°„ ì±„íŒ… í†µê³„ ë° AI ë¶„ì„ + í™•ì¥ ê¸°ëŠ¥</p>\n            </div>\n            <PDFExportButton targetId='dashboard-content' filename={`yagovibe-report-${new Date().toISOString().split('T')[0]}.pdf`} />\n          </div>\n        </div>\n      </header>\n\n      {/* ë©”ì¸ ì½˜í…ì¸  */}\n      <main id='dashboard-content' className='max-w-7xl mx-auto px-4 py-8'>\n        {/* ë‚ ì§œ í•„í„° */}\n        <DateRangeFilter onFilterChange={handleDateRangeChange} />\n\n        {/* KPI ì¹´ë“œ 4ê°œ */}\n        <div className='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8'>\n          <ReportCard title='ì˜¤ëŠ˜ ë©”ì‹œì§€' value={stats.todayMessages} icon={<MessageCircle className='w-6 h-6' />} color='blue' change='+12%' />\n          <ReportCard title='ì „ì²´ ë©”ì‹œì§€' value={stats.totalMessages} icon={<TrendingUp className='w-6 h-6' />} color='green' />\n          <ReportCard title='í™œì„± ì±„íŒ…ë°©' value={stats.totalRooms} icon={<MessageCircle className='w-6 h-6' />} color='purple' />\n          <ReportCard title='í™œì„± ì‚¬ìš©ì' value={stats.activeUsers} icon={<Users className='w-6 h-6' />} color='orange' />\n        </div>\n\n        {/* ì°¨íŠ¸ 3ê°œ */}\n        <div className='grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8'>\n          <div className='bg-white rounded-2xl shadow-md p-6'>\n            <h2 className='text-lg font-semibold text-gray-800 mb-4'>ğŸ“Š ì¼ìë³„ ëŒ€í™”ëŸ‰ ì¶”ì´</h2>\n            <ChatTrendChart />\n          </div>\n          <div className='bg-white rounded-2xl shadow-md p-6'>\n            <h2 className='text-lg font-semibold text-gray-800 mb-4'>ğŸ”¥ ì£¼ìš” í‚¤ì›Œë“œ ë¶„ì„</h2>\n            <KeywordChart />\n          </div>\n        </div>\n\n        {/* ê°ì • ë¶„ì„ ì°¨íŠ¸ (NEW) */}\n        <div className='bg-white rounded-2xl shadow-md p-6 mb-8'>\n          <h2 className='text-lg font-semibold text-gray-800 mb-4'>ğŸ˜Š AI ê°ì • ë¶„ì„</h2>\n          <SentimentChart />\n        </div>\n\n        {/* ìµœê·¼ ì±„íŒ… ë¡œê·¸ */}\n        <div className='bg-white rounded-2xl shadow-md p-6'>\n          <h2 className='text-lg font-semibold text-gray-800 mb-4'>ğŸ“‹ ìµœê·¼ AI ìš”ì•½ ë¡œê·¸</h2>\n          <RecentChatLog />\n        </div>\n      </main>\n    </div>\n  );\n}"
    },
    {
      "step": 5,
      "action": "command",
      "command": "npm install jspdf html2canvas",
      "description": "âœ… PDF ìƒì„± ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜"
    }
  ],
  "dependencies": {
    "jspdf": "^2.5.1",
    "html2canvas": "^1.4.1",
    "recharts": "^2.10.0"
  },
  "new_components": [
    "DateRangeFilter.tsx - ë‚ ì§œ ë²”ìœ„ ì„ íƒ í•„í„°",
    "SentimentChart.tsx - AI ê°ì • ë¶„ì„ ì°¨íŠ¸",
    "PDFExportButton.tsx - PDF ë‹¤ìš´ë¡œë“œ ë²„íŠ¼"
  ],
  "features": [
    "âœ… ë‚ ì§œ ë²”ìœ„ í•„í„° (ì‹œì‘ì¼/ì¢…ë£Œì¼ ì„ íƒ)",
    "âœ… AI ê°ì • ë¶„ì„ ì°¨íŠ¸ (ê¸ì •/ì¤‘ë¦½/ë¶€ì •)",
    "âœ… PDF ë‹¤ìš´ë¡œë“œ (ì „ì²´ ëŒ€ì‹œë³´ë“œ)",
    "âœ… í•„í„°ë§ëœ í†µê³„ ìë™ ì—…ë°ì´íŠ¸",
    "âœ… ë°˜ì‘í˜• ë””ìì¸ ìœ ì§€"
  ],
  "manual_steps": {
    "after_auto_patch": [
      "1ï¸âƒ£ npm install jspdf html2canvas recharts",
      "2ï¸âƒ£ /admin/chat-dashboard ì ‘ì†",
      "3ï¸âƒ£ ë‚ ì§œ í•„í„° í…ŒìŠ¤íŠ¸",
      "4ï¸âƒ£ PDF ë‹¤ìš´ë¡œë“œ í…ŒìŠ¤íŠ¸"
    ]
  },
  "completion_message": "ğŸ‰ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ v2.0 ì™„ì„±!\n\nâœ… ì¶”ê°€ëœ ê¸°ëŠ¥:\n- ğŸ“… ë‚ ì§œ ë²”ìœ„ í•„í„°\n- ğŸ˜Š AI ê°ì • ë¶„ì„ ì°¨íŠ¸\n- ğŸ“¤ PDF ë‹¤ìš´ë¡œë“œ\n\nğŸ“‹ ë‹¤ìŒ ë‹¨ê³„:\n1. npm install jspdf html2canvas\n2. /admin/chat-dashboard ì ‘ì†\n3. ë‚ ì§œ í•„í„° ì„ íƒ â†’ í†µê³„ ìë™ ì—…ë°ì´íŠ¸\n4. PDF ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ í´ë¦­\n\nğŸ¯ ì™„ì„±ëœ ê¸°ëŠ¥:\n- ì‹¤ì‹œê°„ í†µê³„ (4ê°œ KPI)\n- ì¼ìë³„ íŠ¸ë Œë“œ ì°¨íŠ¸\n- í‚¤ì›Œë“œ ë¶„ì„ ì°¨íŠ¸\n- ê°ì • ë¶„ì„ ì°¨íŠ¸ (NEW)\n- ìµœê·¼ ë¡œê·¸ í…Œì´ë¸”\n- ë‚ ì§œ í•„í„° (NEW)\n- PDF ë‹¤ìš´ë¡œë“œ (NEW)"
}

