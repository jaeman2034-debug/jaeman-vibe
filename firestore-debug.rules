rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function authed() { return request.auth != null; }

    match /clubs/{clubId} {
      allow read: if true;

      // 클럽 생성: 본인 소유로 만들 때만
      allow create: if authed()
        && request.resource.data.ownerUid == request.auth.uid
        && request.resource.data.name is string
        && request.resource.data.active == true;

      allow update, delete: if authed();

      // 멤버
      match /members/{uid} {
        allow read: if true;
        allow create, update, delete: if authed();
      }

      // blog 단일 도큐먼트 아래 posts 컬렉션 - 임시로 모든 로그인 사용자 허용
      match /blog/{blogId}/posts/{postId} {
        allow read: if true;
        allow create: if authed()
          && request.resource.data.authorUid == request.auth.uid
          && request.resource.data.title is string
          && request.resource.data.content is string;
        allow update, delete: if authed();
      }

      // 팀
      match /teams/{teamId} {
        allow read: if true;
        allow write: if authed();
      }

      // 그 외 모든 하위 경로
      match /{anySub=**} {
        allow read: if true;
        allow write: if authed();
      }
    }

    // 기본 거부
    match /{document=**} { allow read, write: if false; }
  }
}
