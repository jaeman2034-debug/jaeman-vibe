{
  "name": "YAGO VIBE AI ìë™ ë¦¬í¬íŠ¸ ìƒì„±",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 0 * * *"
            }
          ]
        }
      },
      "id": "cron-trigger",
      "name": "ë§¤ì¼ ìì • ì‹¤í–‰",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 1,
      "position": [200, 300],
      "webhookDescription": "ë§¤ì¼ ìì •(00:00)ì— ì‹¤í–‰ë˜ì–´ ì „ë‚  ì•Œë¦¼ í†µê³„ë¥¼ ì§‘ê³„í•©ë‹ˆë‹¤"
    },
    {
      "parameters": {
        "projectId": "jaeman-vibe-platform",
        "collection": "notifications",
        "operation": "getMany"
      },
      "id": "firestore-query",
      "name": "Firestore ì•Œë¦¼ ë°ì´í„° ì¡°íšŒ",
      "type": "n8n-nodes-base.googleFirebase",
      "typeVersion": 1,
      "position": [600, 300]
    },
    {
      "parameters": {
        "functionCode": "// ì „ë‚  ë‚ ì§œ ê³„ì‚°\nconst yesterday = new Date();\nyesterday.setDate(yesterday.getDate() - 1);\nconst dateStr = yesterday.toISOString().split('T')[0];\n\nconsole.log('ğŸ“Š ì²˜ë¦¬í•  ë‚ ì§œ:', dateStr);\n\n// Firestoreì—ì„œ ë°›ì€ ë°ì´í„° ì²˜ë¦¬\nconst items = $input.all();\nconsole.log('ğŸ“‹ ë°›ì€ ì•Œë¦¼ ë°ì´í„°:', items.length, 'ê°œ');\n\n// í†µê³„ ê³„ì‚°\nconst stats = {\n  FCM: 0,\n  Slack: 0,\n  Kakao: 0,\n  message: 0,\n  comment: 0,\n  market: 0,\n  system: 0\n};\n\nlet totalCount = 0;\n\n// ê° ì•Œë¦¼ ë¬¸ì„œ ì²˜ë¦¬\nfor (const item of items) {\n  const data = item.json;\n  \n  // ì•Œë¦¼ ì•„ì´í…œë“¤ ì²˜ë¦¬\n  if (data.items) {\n    for (const [itemId, itemData] of Object.entries(data.items)) {\n      const notification = itemData;\n      \n      // ì „ë‚  ìƒì„±ëœ ì•Œë¦¼ë§Œ ì²˜ë¦¬\n      if (notification.createdAt) {\n        const itemDate = new Date(notification.createdAt.seconds * 1000);\n        const itemDateStr = itemDate.toISOString().split('T')[0];\n        \n        if (itemDateStr === dateStr) {\n          totalCount++;\n          \n          // íƒ€ì…ë³„ í†µê³„\n          const type = notification.type || 'system';\n          if (stats.hasOwnProperty(type)) {\n            stats[type]++;\n          } else {\n            stats.system++;\n          }\n          \n          // ì±„ë„ë³„ í†µê³„ (dataì— channel ì •ë³´ê°€ ìˆëŠ” ê²½ìš°)\n          const channel = notification.channel || notification.data?.channel;\n          if (channel === 'FCM' || channel === 'fcm') stats.FCM++;\n          else if (channel === 'Slack' || channel === 'slack') stats.Slack++;\n          else if (channel === 'Kakao' || channel === 'kakao') stats.Kakao++;\n        }\n      }\n    }\n  }\n}\n\nconsole.log('ğŸ“ˆ ê³„ì‚°ëœ í†µê³„:', stats);\nconsole.log('ğŸ“Š ì´ ì•Œë¦¼ ìˆ˜:', totalCount);\n\n// ê²°ê³¼ ë°˜í™˜\nreturn [{\n  json: {\n    date: dateStr,\n    stats: stats,\n    totalCount: totalCount,\n    processedAt: new Date().toISOString()\n  }\n}];"
      },
      "id": "js-stats",
      "name": "JavaScript: í†µê³„ ê³„ì‚°",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [1000, 300]
    },
    {
      "parameters": {
        "resource": "chat",
        "operation": "create",
        "model": "gpt-4o-mini",
        "messages": {
          "values": [
            {
              "role": "system",
              "content": "ë„ˆëŠ” YAGO VIBE í”Œë«í¼ì˜ ë°ì´í„° ë¶„ì„ê°€ì•¼. ì•Œë¦¼ í†µê³„ ë°ì´í„°ë¥¼ ë³´ê³  í•˜ë£¨ ìš”ì•½ ë¦¬í¬íŠ¸ë¥¼ ì‘ì„±í•´ì¤˜."
            },
            {
              "role": "user",
              "content": "ë‹¤ìŒì€ {{$json.date}}ì˜ ì•Œë¦¼ í†µê³„ ë°ì´í„°ì…ë‹ˆë‹¤:\\n\\nì´ ì•Œë¦¼ ìˆ˜: {{$json.totalCount}}ê±´\\n\\nì±„ë„ë³„ ë¶„í¬:\\n- FCM: {{$json.stats.FCM}}ê±´\\n- Slack: {{$json.stats.Slack}}ê±´\\n- Kakao: {{$json.stats.Kakao}}ê±´\\n\\níƒ€ì…ë³„ ë¶„í¬:\\n- ë©”ì‹œì§€: {{$json.stats.message}}ê±´\\n- ëŒ“ê¸€: {{$json.stats.comment}}ê±´\\n- ë§ˆì¼“: {{$json.stats.market}}ê±´\\n- ì‹œìŠ¤í…œ: {{$json.stats.system}}ê±´\\n\\nìœ„ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ 2-3ë¬¸ì¥ì˜ í•œêµ­ì–´ ìš”ì•½ ë¦¬í¬íŠ¸ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”. í˜•ì‹ì€:\\n\\n\"ì˜¤ëŠ˜ í•˜ë£¨ ì´ Xê±´ì˜ ì•Œë¦¼ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. ì£¼ìš” ì±„ë„ì€ Yì˜€ìœ¼ë©°, Z íƒ€ì… ì•Œë¦¼ì´ ê°€ì¥ ë§ì•˜ìŠµë‹ˆë‹¤. ì „ë°˜ì ìœ¼ë¡œ ì•ˆì •ì ì¸ ì•Œë¦¼ ì„œë¹„ìŠ¤ ìš´ì˜ì´ ì´ë£¨ì–´ì¡ŒìŠµë‹ˆë‹¤.\""
            }
          ]
        },
        "options": {
          "temperature": 0.7,
          "maxTokens": 200
        }
      },
      "id": "openai-summary",
      "name": "OpenAI: AI ìš”ì•½ ìƒì„±",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1,
      "position": [1400, 300]
    },
    {
      "parameters": {
        "projectId": "jaeman-vibe-platform",
        "collection": "reports",
        "operation": "create",
        "fields": {
          "string": [
            {
              "name": "date",
              "value": "={{$('JavaScript: í†µê³„ ê³„ì‚°').item.json.date}}"
            },
            {
              "name": "stats",
              "value": "={{$('JavaScript: í†µê³„ ê³„ì‚°').item.json.stats}}"
            },
            {
              "name": "totalCount",
              "value": "={{$('JavaScript: í†µê³„ ê³„ì‚°').item.json.totalCount}}"
            },
            {
              "name": "summary",
              "value": "={{$('OpenAI: AI ìš”ì•½ ìƒì„±').item.json.choices[0].message.content}}"
            },
            {
              "name": "createdAt",
              "value": "={{$now}}"
            },
            {
              "name": "processedAt",
              "value": "={{$('JavaScript: í†µê³„ ê³„ì‚°').item.json.processedAt}}"
            }
          ]
        }
      },
      "id": "firestore-write",
      "name": "Firestore: ë¦¬í¬íŠ¸ ì €ì¥",
      "type": "n8n-nodes-base.googleFirebase",
      "typeVersion": 1,
      "position": [1800, 300]
    },
    {
      "parameters": {
        "channel": "#yago-vibe-reports",
        "text": "ğŸ¤– **YAGO VIBE ì¼ì¼ AI ë¦¬í¬íŠ¸ ìƒì„± ì™„ë£Œ**\\n\\nğŸ“… **ë‚ ì§œ**: {{$('JavaScript: í†µê³„ ê³„ì‚°').item.json.date}}\\nğŸ“Š **ì´ ì•Œë¦¼ ìˆ˜**: {{$('JavaScript: í†µê³„ ê³„ì‚°').item.json.totalCount}}ê±´\\n\\nğŸ“ˆ **ì±„ë„ë³„ ë¶„í¬**:\\n- FCM: {{$('JavaScript: í†µê³„ ê³„ì‚°').item.json.stats.FCM}}ê±´\\n- Slack: {{$('JavaScript: í†µê³„ ê³„ì‚°').item.json.stats.Slack}}ê±´\\n- Kakao: {{$('JavaScript: í†µê³„ ê³„ì‚°').item.json.stats.Kakao}}ê±´\\n\\nğŸ¤– **AI ìš”ì•½**:\\n{{$('OpenAI: AI ìš”ì•½ ìƒì„±').item.json.choices[0].message.content}}\\n\\nğŸ“Š ëŒ€ì‹œë³´ë“œì—ì„œ ìƒì„¸ í™•ì¸: http://localhost:5183/admin/reports"
      },
      "id": "slack-notify",
      "name": "Slack: ì™„ë£Œ ì•Œë¦¼",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 1,
      "position": [1800, 100]
    }
  ],
  "connections": {
    "ë§¤ì¼ ìì • ì‹¤í–‰": {
      "main": [
        [
          {
            "node": "Firestore ì•Œë¦¼ ë°ì´í„° ì¡°íšŒ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Firestore ì•Œë¦¼ ë°ì´í„° ì¡°íšŒ": {
      "main": [
        [
          {
            "node": "JavaScript: í†µê³„ ê³„ì‚°",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "JavaScript: í†µê³„ ê³„ì‚°": {
      "main": [
        [
          {
            "node": "OpenAI: AI ìš”ì•½ ìƒì„±",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI: AI ìš”ì•½ ìƒì„±": {
      "main": [
        [
          {
            "node": "Firestore: ë¦¬í¬íŠ¸ ì €ì¥",
            "type": "main",
            "index": 0
          },
          {
            "node": "Slack: ì™„ë£Œ ì•Œë¦¼",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "tags": ["yago-vibe", "ai", "reports", "automation"],
  "triggerCount": 0,
  "meta": {
    "description": "ë§¤ì¼ ìì •ì— ì‹¤í–‰ë˜ì–´ ì „ë‚ ì˜ ì•Œë¦¼ í†µê³„ë¥¼ ì§‘ê³„í•˜ê³ , OpenAIë¥¼ í†µí•´ AI ìš”ì•½ì„ ìƒì„±í•˜ì—¬ Firestoreì— ì €ì¥í•˜ëŠ” ì›Œí¬í”Œë¡œìš°ì…ë‹ˆë‹¤."
  }
}
