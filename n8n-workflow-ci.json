{
  "nodes": [
    {
      "id": "1",
      "name": "CI Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [300, 300],
      "parameters": {
        "path": "ci-result",
        "httpMethod": "POST"
      }
    },
    {
      "id": "2",
      "name": "Switch by Status",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [600, 300],
      "parameters": {
        "propertyName": "status",
        "rules": [
          { "operation": "equal", "value": "success" },
          { "operation": "equal", "value": "failure" }
        ]
      }
    },
    {
      "id": "3",
      "name": "ì¹´í†¡ ì„±ê³µ ì•Œë¦¼",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [900, 150],
      "parameters": {
        "url": "https://kapi.kakao.com/v2/api/talk/memo/default/send",
        "method": "POST",
        "authentication": "headerAuth",
        "sendBody": true,
        "jsonParameters": true,
        "bodyParametersJson": "={\"template_object\": {\n  \"object_type\": \"text\",\n  \"text\": \"âœ… CI ì„±ê³µ!\\nRepo: {{$json[\"repo\"]}}\\nRun: {{$json[\"run\"]}}\\nActor: {{$json[\"actor\"]}}\\nCommit: {{$json[\"commit_msg\"]}}\\nDuration: {{$json[\"duration\"]}}\\nğŸ‘‰ ìƒì„¸ë³´ê¸°: {{$json[\"url\"]}}\",\n  \"link\": {\"web_url\": \"{{$json[\"url\"]}}\"}\n}}"
      }
    },
    {
      "id": "4",
      "name": "ì¹´í†¡ ì‹¤íŒ¨ ì•Œë¦¼",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [900, 250],
      "parameters": {
        "url": "https://kapi.kakao.com/v2/api/talk/memo/default/send",
        "method": "POST",
        "authentication": "headerAuth",
        "sendBody": true,
        "jsonParameters": true,
        "bodyParametersJson": "={\"template_object\": {\n  \"object_type\": \"text\",\n  \"text\": \"âŒ CI ì‹¤íŒ¨!\\nRepo: {{$json[\"repo\"]}}\\nRun: {{$json[\"run\"]}}\\nActor: {{$json[\"actor\"]}}\\nCommit: {{$json[\"commit_msg\"]}}\\nDuration: {{$json[\"duration\"]}}\\nğŸ‘‰ ìƒì„¸ë³´ê¸°: {{$json[\"url\"]}}\",\n  \"link\": {\"web_url\": \"{{$json[\"url\"]}}\"}\n}}"
      }
    },
    {
      "id": "5",
      "name": "Slack ì„±ê³µ ì•Œë¦¼",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [900, 350],
      "parameters": {
        "url": "={{$json[\"SLACK_WEBHOOK_URL\"]}}",
        "method": "POST",
        "sendBody": true,
        "jsonParameters": true,
        "bodyParametersJson": "={\n  \"text\": \":white_check_mark: *CI ì„±ê³µ!*\\n*Repo:* {{$json[\"repo\"]}}\\n*Run:* {{$json[\"run\"]}}\\n*Actor:* {{$json[\"actor\"]}}\\n*Commit:* {{$json[\"commit_msg\"]}}\\n*Duration:* {{$json[\"duration\"]}}\\n<{{$json[\"url\"]}}|ìƒì„¸ë³´ê¸°>\"\n}"
      }
    },
    {
      "id": "6",
      "name": "Slack ì‹¤íŒ¨ ì•Œë¦¼",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [900, 450],
      "parameters": {
        "url": "={{$json[\"SLACK_WEBHOOK_URL\"]}}",
        "method": "POST",
        "sendBody": true,
        "jsonParameters": true,
        "bodyParametersJson": "={\n  \"text\": \":x: *CI ì‹¤íŒ¨!*\\n*Repo:* {{$json[\"repo\"]}}\\n*Run:* {{$json[\"run\"]}}\\n*Actor:* {{$json[\"actor\"]}}\\n*Commit:* {{$json[\"commit_msg\"]}}\\n*Duration:* {{$json[\"duration\"]}}\\n<{{$json[\"url\"]}}|ìƒì„¸ë³´ê¸°>\\n\\n*ìµœê·¼ ë¡œê·¸ (ë§ˆì§€ë§‰ 10ì¤„):*\\n```{{$json[\"log_snippet\"]}}```\"\n}"
      }
    },
    {
      "id": "7",
      "name": "Slack ë¡œê·¸ íŒŒì¼ ì—…ë¡œë“œ",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [1150, 500],
      "parameters": {
        "url": "https://slack.com/api/files.upload",
        "method": "POST",
        "authentication": "headerAuth",
        "sendBody": true,
        "jsonParameters": false,
        "options": {},
        "bodyContentType": "form-data-multipart",
        "bodyParameters": {
          "channels": "#ci-alerts",
          "filename": "test_output.log",
          "filetype": "text",
          "title": "ì „ì²´ CI ë¡œê·¸",
          "content": "={{Buffer.from($json[\"log_file_b64\"], 'base64').toString('utf8')}}"
        }
      }
    }
  ],
  "connections": {
    "CI Webhook": {
      "main": [[{ "node": "Switch by Status", "type": "main", "index": 0 }]]
    },
    "Switch by Status": {
      "main": [
        [
          { "node": "ì¹´í†¡ ì„±ê³µ ì•Œë¦¼", "type": "main", "index": 0 },
          { "node": "Slack ì„±ê³µ ì•Œë¦¼", "type": "main", "index": 0 }
        ],
        [
          { "node": "ì¹´í†¡ ì‹¤íŒ¨ ì•Œë¦¼", "type": "main", "index": 0 },
          { "node": "Slack ì‹¤íŒ¨ ì•Œë¦¼", "type": "main", "index": 0 },
          { "node": "Slack ë¡œê·¸ íŒŒì¼ ì—…ë¡œë“œ", "type": "main", "index": 0 }
        ]
      ]
    }
  }
}
