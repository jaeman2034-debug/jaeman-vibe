{
  "name": "YAGO VIBE - ?섎룞 ?뺣━ (利됱떆 ?ㅽ뻾)",
  "nodes": [
    {
      "parameters": {},
      "id": "1",
      "name": "Manual Start",
      "type": "n8n-nodes-base.start",
      "typeVersion": 1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "resource": "document",
        "operation": "getAll",
        "collection": "marketItems"
      },
      "id": "2",
      "name": "Firestore - Get All Products",
      "type": "n8n-nodes-base.firestore",
      "typeVersion": 1,
      "position": [500, 300],
      "credentials": {
        "firebaseFirestoreOAuth2Api": "YAGO VIBE Firestore"
      }
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json[\"imageUrl\"]}}",
              "operation": "isEmpty"
            }
          ]
        }
      },
      "id": "3",
      "name": "IF - Filter No Image Products",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [750, 300]
    },
    {
      "parameters": {
        "resource": "document",
        "operation": "create",
        "collection": "marketItems_backup",
        "documentId": "={{$json[\"id\"]}}_manual_{{new Date().toISOString().replace(/[:.]/g, '-')}}",
        "fields": "={{$json}}"
      },
      "id": "4",
      "name": "Firestore - Backup Products",
      "type": "n8n-nodes-base.firestore",
      "typeVersion": 1,
      "position": [1000, 280],
      "credentials": {
        "firebaseFirestoreOAuth2Api": "YAGO VIBE Firestore"
      }
    },
    {
      "parameters": {
        "resource": "document",
        "operation": "delete",
        "collection": "marketItems",
        "documentId": "={{$json[\"id\"]}}"
      },
      "id": "5",
      "name": "Firestore - Delete Original",
      "type": "n8n-nodes-base.firestore",
      "typeVersion": 1,
      "position": [1250, 280],
      "credentials": {
        "firebaseFirestoreOAuth2Api": "YAGO VIBE Firestore"
      }
    },
    {
      "parameters": {
        "functionCode": "// ?쭬 ?섎룞 ?ㅽ뻾 寃곌낵 泥섎━\nconst deletedCount = items.length;\nconst deletedTitles = items.map(i => i.json.title || i.json.id || '?쒕ぉ ?놁쓬');\nconst timestamp = new Date().toLocaleString('ko-KR', { timeZone: 'Asia/Seoul' });\nconst backupLocation = 'marketItems_backup';\nconst executionType = 'MANUAL';\n\n// ?뱤 ?곸꽭 ?듦퀎\nconst stats = {\n  totalDeleted: deletedCount,\n  deletedTitles: deletedTitles,\n  backupLocation: backupLocation,\n  executionTime: timestamp,\n  executionType: executionType,\n  executor: 'YAGO VIBE Manual System',\n  status: 'SUCCESS'\n};\n\n// ?뼢截?肄섏넄 濡쒓렇 (?곸꽭)\nconsole.log('?㏏ YAGO VIBE ?섎룞 ?뺣━ ?꾨즺!');\nconsole.log(`?뿊截???젣???곹뭹: ${deletedCount}媛?);\nconsole.log(`?뾺截?諛깆뾽 ?꾩튂: ${backupLocation}`);\nconsole.log(`?븧 ?ㅽ뻾 ?쒓컙: ${timestamp}`);\nconsole.log(`?뫀 ?ㅽ뻾 諛⑹떇: ${executionType}`);\nconsole.log('?뱥 ??젣???곹뭹 紐⑸줉:');\ndeletedTitles.forEach((title, index) => {\n  console.log(`  ${index + 1}. ${title}`);\n});\n\nreturn [{\n  json: stats\n}];"
      },
      "id": "6",
      "name": "Generate Manual Report",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [1500, 280]
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "post",
        "channel": "#yago-vibe-alerts",
        "text": "?㏏ YAGO VIBE ?섎룞 ?뺣━ ?꾨즺",
        "blocks": [
          {
            "type": "header",
            "text": {
              "type": "plain_text",
              "text": "?㏏ YAGO VIBE ?섎룞 ?뺣━ ?꾨즺"
            }
          },
          {
            "type": "section",
            "fields": [
              {
                "type": "mrkdwn",
                "text": "*??젣???곹뭹 ??*\\n{{$json.totalDeleted}}媛?
              },
              {
                "type": "mrkdwn",
                "text": "*諛깆뾽 ?꾩튂:*\\n{{$json.backupLocation}}"
              },
              {
                "type": "mrkdwn",
                "text": "*?ㅽ뻾 ?쒓컙:*\\n{{$json.executionTime}}"
              },
              {
                "type": "mrkdwn",
                "text": "*?ㅽ뻾 諛⑹떇:*\\n{{$json.executionType}}"
              }
            ]
          },
          {
            "type": "section",
            "text": {
              "type": "mrkdwn",
              "text": "*?뿊截???젣???곹뭹 紐⑸줉:*\\n{{$json.deletedTitles.map((title, index) => `${index + 1}. ${title}`).join('\\n')}}"
            }
          },
          {
            "type": "context",
            "elements": [
              {
                "type": "mrkdwn",
                "text": "??諛깆뾽 ?꾨즺 ???뫀 ?섎룞 ?ㅽ뻾 ????YAGO VIBE ?쒖뒪??
              }
            ]
          }
        ]
      },
      "id": "7",
      "name": "Slack - Manual Notification",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 1,
      "position": [1750, 280],
      "credentials": {
        "slackOAuth2Api": "YAGO VIBE Slack"
      }
    }
  ],
  "connections": {
    "Manual Start": {
      "main": [
        [
          {
            "node": "Firestore - Get All Products",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Firestore - Get All Products": {
      "main": [
        [
          {
            "node": "IF - Filter No Image Products",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF - Filter No Image Products": {
      "main": [
        [
          {
            "node": "Firestore - Backup Products",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Firestore - Backup Products": {
      "main": [
        [
          {
            "node": "Firestore - Delete Original",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Firestore - Delete Original": {
      "main": [
        [
          {
            "node": "Generate Manual Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Manual Report": {
      "main": [
        [
          {
            "node": "Slack - Manual Notification",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "timezone": "Asia/Seoul"
  },
  "meta": {
    "description": "YAGO VIBE ?섎룞 ?뺣━ - ?대┃ ??踰덉쑝濡?利됱떆 ?ㅽ뻾, 諛깆뾽 ????젣, Slack ?뚮┝",
    "tags": ["yago-vibe", "firestore", "cleanup", "manual", "backup", "slack", "instant"],
    "version": "2.0.0",
    "author": "YAGO VIBE Team",
    "features": [
      "?먰겢由??섎룞 ?ㅽ뻾",
      "?덉쟾??諛깆뾽 ?쒖뒪??,
      "?ㅼ떆媛?Slack ?뚮┝",
      "?곸꽭??濡쒓퉭 諛??듦퀎",
      "利됱떆 ?ㅽ뻾 媛??
    ]
  }
}
