{
  "name": "YAGO ‚Äì SNS Post Auto-Deploy",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "yago/sns-post",
        "responseMode": "lastNode"
      },
      "id": "Webhook",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [0, 300]
    },
    {
      "parameters": {
        "functionCode": "const { title, description, url, clubName, sport, region } = $json;\nconst caption = `${title}\\n\\n${description}\\n\\nüìç ${region || ''}\\nüèÉ ${sport || ''}\\n\\n#${clubName?.replace(/\\s+/g, '')} #ÏïºÍ≥†Ïä§Ìè¨Ï∏† #Î™®ÏûÑ`;\nreturn [{ json: { ...$json, caption } }];"
      },
      "name": "Build Caption",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [260, 300]
    },
    {
      "parameters": {
        "requestMethod": "GET",
        "url": "={{$json.url}}",
        "options": {
          "response": {
            "response": {
              "fullResponse": false,
              "neverError": true
            }
          }
        }
      },
      "name": "Fetch OG Image",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [520, 300]
    },
    {
      "parameters": {
        "requestMethod": "POST",
        "url": "https://upload.twitter.com/1.1/media/upload.json",
        "jsonParameters": true,
        "options": {
          "headers": {
            "Authorization": "=\"Bearer \" + $env.X_BEARER_TOKEN"
          }
        },
        "bodyParametersJson": "={\n  \"media_data\": \"{{$binary.data}}\"\n}"
      },
      "name": "X ‚Äì Upload Media (v2)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [780, 300]
    },
    {
      "parameters": {
        "requestMethod": "POST",
        "url": "https://api.twitter.com/2/tweets",
        "jsonParameters": true,
        "options": {
          "headers": {
            "Authorization": "=\"Bearer \" + $env.X_BEARER_TOKEN"
          }
        },
        "bodyParametersJson": "={\n  \"text\": $json.caption,\n  \"media\": {\n    \"media_ids\": [\"{{$json('data').media_id_string}}\"]\n  }\n}"
      },
      "name": "X ‚Äì Create Post",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [1040, 300]
    },
    {
      "parameters": {
        "requestMethod": "POST",
        "url": "=\"https://graph.facebook.com/\" + ($env.IG_GRAPH_VERSION || 'v23.0') + \"/\" + $env.IG_USER_ID + \"/media\"",
        "jsonParameters": true,
        "options": {
          "headers": {
            "Authorization": "=\"Bearer \" + $env.INSTAGRAM_ACCESS_TOKEN"
          }
        },
        "bodyParametersJson": "={\n  \"image_url\": $json.ogUrl,\n  \"caption\": $json.caption\n}"
      },
      "name": "IG ‚Äì Create Media Container",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [720, 300]
    },
    {
      "parameters": {
        "requestMethod": "POST",
        "url": "=\"https://graph.facebook.com/\" + ($env.IG_GRAPH_VERSION || 'v23.0') + \"/\" + $env.IG_USER_ID + \"/media_publish\"",
        "jsonParameters": true,
        "options": {
          "headers": {
            "Authorization": "=\"Bearer \" + $env.INSTAGRAM_ACCESS_TOKEN"
          }
        },
        "bodyParametersJson": "={\n  \"creation_id\": {{$json(\"body\").id}}\n}"
      },
      "name": "IG ‚Äì Publish",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [980, 300]
    },
    {
      "parameters": {
        "requestMethod": "POST",
        "url": "=\"https://graph.facebook.com/\" + ($env.IG_GRAPH_VERSION || 'v23.0') + \"/\" + $env.FACEBOOK_PAGE_ID + \"/photos\"",
        "jsonParameters": true,
        "options": {
          "headers": {
            "Authorization": "=\"Bearer \" + $env.FACEBOOK_ACCESS_TOKEN"
          }
        },
        "bodyParametersJson": "={\n  \"url\": $json.ogUrl,\n  \"message\": $json.caption\n}"
      },
      "name": "FB Page ‚Äì Photo",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [720, 520]
    },
    {
      "parameters": {
        "requestMethod": "POST",
        "url": "https://api.linkedin.com/rest/posts",
        "jsonParameters": true,
        "options": {
          "headers": {
            "Authorization": "=\"Bearer \" + $env.LINKEDIN_ACCESS_TOKEN",
            "Linkedin-Version": "202502",
            "Content-Type": "application/json"
          }
        },
        "bodyParametersJson": "={\n  \"author\": \"{{$env.LINKEDIN_ORG_URN}}\",\n  \"commentary\": $json.caption,\n  \"visibility\": \"PUBLIC\",\n  \"distribution\": {\n    \"feedDistribution\": \"MAIN_FEED\",\n    \"targetEntities\": [],\n    \"thirdPartyDistributionChannels\": []\n  },\n  \"content\": {\n    \"media\": {\n      \"altText\": \"YAGO OG Image\",\n      \"originalUrl\": $json.ogUrl\n    }\n  }\n}"
      },
      "name": "LinkedIn ‚Äì Post (URL attach)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [720, 740],
      "disabled": true
    },
    {
      "parameters": {
        "responseBody": "={{$json}}",
        "responseCode": 200
      },
      "name": "Respond",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1240, 300]
    }
  ],
  "connections": {
    "Webhook": {
      "main": [[{"node": "Build Caption", "type": "main", "index": 0}]]
    },
    "Build Caption": {
      "main": [
        [{"node": "Fetch OG Image", "type": "main", "index": 0}],
        [{"node": "IG ‚Äì Create Media Container", "type": "main", "index": 0}],
        [{"node": "FB Page ‚Äì Photo", "type": "main", "index": 0}],
        [{"node": "LinkedIn ‚Äì Post (URL attach)", "type": "main", "index": 0}]
      ]
    },
    "Fetch OG Image": {
      "main": [[{"node": "X ‚Äì Upload Media (v2)", "type": "main", "index": 0}]]
    },
    "X ‚Äì Upload Media (v2)": {
      "main": [[{"node": "X ‚Äì Create Post", "type": "main", "index": 0}]]
    },
    "X ‚Äì Create Post": {
      "main": [[{"node": "Respond", "type": "main", "index": 0}]]
    },
    "IG ‚Äì Create Media Container": {
      "main": [[{"node": "IG ‚Äì Publish", "type": "main", "index": 0}]]
    },
    "IG ‚Äì Publish": {
      "main": [[{"node": "Respond", "type": "main", "index": 0}]]
    },
    "FB Page ‚Äì Photo": {
      "main": [[{"node": "Respond", "type": "main", "index": 0}]]
    },
    "LinkedIn ‚Äì Post (URL attach)": {
      "main": [[{"node": "Respond", "type": "main", "index": 0}]]
    }
  }
}
