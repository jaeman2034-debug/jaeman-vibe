{
  "name": "YAGO VIBE - 3D ì‹¤ì‹œê°„ AI ì•„ë°”íƒ€ ë¹„ì„œ",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "yago-voice-assistant",
        "responseMode": "onReceived",
        "responseData": "={{$json}}"
      },
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [300, 200],
      "webhookId": "yago-voice-assistant"
    },
    {
      "parameters": {
        "authentication": "headerAuth",
        "url": "https://api.openai.com/v1/chat/completions",
        "responseFormat": "json",
        "options": {},
        "headerParametersJson": "{\n  \"Authorization\": \"Bearer {{$env.OPENAI_API_KEY}}\",\n  \"Content-Type\": \"application/json\"\n}",
        "bodyParametersJson": "={\n  \"model\": \"gpt-4o-mini\",\n  \"messages\": [\n    {\n      \"role\": \"system\",\n      \"content\": \"ë‹¹ì‹ ì€ YAGO VIBEì˜ ê°œì¸ ë¹„ì„œì…ë‹ˆë‹¤. ì‚¬ìš©ì ë§íˆ¬ë¥¼ ì¡´ì¤‘í•˜ê³ , ì¹œê·¼í•˜ê³  ì§§ê²Œ ëŒ€ë‹µí•˜ì„¸ìš”. ì‚¬ìš©ìê°€ íŒë§¤, ë“±ë¡, ì¼ì •, ì¡°íšŒ ê´€ë ¨ ìš”ì²­ì„ í•˜ë©´ ì‹¤í–‰ ì˜ë„(intent)ê¹Œì§€ í•¨ê»˜ ë°˜í™˜í•˜ì„¸ìš”.\\n\\nì¶œë ¥ í˜•ì‹:\\n{\\\"reply\\\": \\\"í˜•ë‹˜, ì˜¤ëŠ˜ ë“±ë¡ëœ ì¶•êµ¬í™”ëŠ” 2ê°œì…ë‹ˆë‹¤. í•˜ë‚˜ëŠ” í¬ì²œíŒ€ì—ì„œ ì˜ˆì•½í–ˆì–´ìš” ğŸ˜\\\", \\\"emotion\\\": \\\"happy\\\", \\\"intent\\\": \\\"show_stats\\\"}\\n\\nê°ì • ì˜µì…˜: happy, excited, sad, neutral\\nì˜ë„ ì˜µì…˜: navigate_upload, navigate_market, navigate_report, show_stats, greeting, gratitude, clarification\"\n    },\n    {\n      \"role\": \"user\",\n      \"content\": \"{{$json.message}}\"\n    }\n  ],\n  \"max_tokens\": 300\n}"
      },
      "name": "OpenAI GPT-4o",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [600, 200]
    },
    {
      "parameters": {
        "functionCode": "const content = $json[\"choices\"][0][\"message\"][\"content\"];\nlet parsed;\n\ntry {\n  parsed = JSON.parse(content);\n} catch (e) {\n  // JSON íŒŒì‹± ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ì‘ë‹µ\n  parsed = {\n    reply: content || \"ë¬´ìŠ¨ ëœ»ì¸ì§€ ë‹¤ì‹œ ë§ì”€í•´ì£¼ì‹¤ë˜ìš”?\",\n    emotion: \"neutral\",\n    intent: \"\"\n  };\n}\n\n// ê°ì • ë¶„ì„ (í‚¤ì›Œë“œ ê¸°ë°˜)\nconst userMessage = $json[\"message\"] || \"\";\nif (userMessage.includes(\"ê³ ë§ˆì›Œ\") || userMessage.includes(\"ê°ì‚¬\")) {\n  parsed.emotion = \"happy\";\n} else if (userMessage.includes(\"ë³´ê³ ì„œ\") || userMessage.includes(\"ë¶„ì„\")) {\n  parsed.emotion = \"excited\";\n} else if (userMessage.includes(\"ì‹¤íŒ¨\") || userMessage.includes(\"ì˜¤ë¥˜\")) {\n  parsed.emotion = \"sad\";\n}\n\n// ì˜ë„ ë¶„ì„\nif (userMessage.includes(\"ë“±ë¡\") || userMessage.includes(\"ì˜¬ë¦¬\")) {\n  parsed.intent = \"navigate_upload\";\n} else if (userMessage.includes(\"ë§ˆì¼“\") || userMessage.includes(\"ìƒí’ˆ\")) {\n  parsed.intent = \"navigate_market\";\n} else if (userMessage.includes(\"ë³´ê³ ì„œ\") || userMessage.includes(\"í†µê³„\")) {\n  parsed.intent = \"navigate_report\";\n} else if (userMessage.includes(\"ì•ˆë…•\") || userMessage.includes(\"í•˜ì´\")) {\n  parsed.intent = \"greeting\";\n}\n\nreturn {\n  reply: parsed.reply || \"ë¬´ìŠ¨ ëœ»ì¸ì§€ ë‹¤ì‹œ ë§ì”€í•´ì£¼ì‹¤ë˜ìš”?\",\n  emotion: parsed.emotion || \"neutral\",\n  intent: parsed.intent || \"\",\n  timestamp: new Date().toISOString()\n};"
      },
      "name": "Parse Response",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [900, 200]
    },
    {
      "parameters": {
        "responseBody": "={{$json}}",
        "responseCode": 200,
        "options": {}
      },
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1200, 200]
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "OpenAI GPT-4o",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI GPT-4o": {
      "main": [
        [
          {
            "node": "Parse Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Response": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {},
  "versionId": "1.0.0"
}
