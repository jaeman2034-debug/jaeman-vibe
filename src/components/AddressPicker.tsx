import { useEffect, useRef, useState } from 'react';import { geocode } from '../api/geo';import { loadKakao } from '../lib/kakao';import { db } from '@/lib/firebase';import { doc, setDoc, GeoPoint, serverTimestamp } from 'firebase/firestore';export default function AddressPicker() {  const [addr, setAddr] = useState('?œìš¸ ì¤‘êµ¬ ?œí‰ë¡?ê°€ 31'); // ?˜í”Œ  const [result, setResult] = useState<any>(null);  const [saving, setSaving] = useState(false);  const mapRef = useRef<HTMLDivElement>(null);  const kakaoRef = useRef<any>(null);  const mapObjRef = useRef<any>(null);  const markerRef = useRef<any>(null);  useEffect(() => {    (async () => {      kakaoRef.current = await loadKakao();      if (mapRef.current && !mapObjRef.current) {        mapObjRef.current = new kakaoRef.current.maps.Map(mapRef.current, {          center: new kakaoRef.current.maps.LatLng(37.5665, 126.9780),          level: 5,        });      }    })().catch(console.error);  }, []);  const onSearch = async () => {    try {      const r = await geocode(addr);      setResult(r);      if (!kakaoRef.current || !mapObjRef.current) return;      const pos = new kakaoRef.current.maps.LatLng(r.y, r.x);      if (!markerRef.current) markerRef.current = new kakaoRef.current.maps.Marker({ map: mapObjRef.current, position: pos });      else markerRef.current.setPosition(pos);      mapObjRef.current.setCenter(pos);    } catch (e:any) {      alert('ì§€?¤ì½”???¤íŒ¨: ' + e.message);    }  };  const onSave = async () => {    if (!result?.ok) return alert('ë¨¼ì? ì£¼ì†Œë¥?ê²€?‰í•˜?¸ìš”.');    const productId = prompt('?€?¥í•  productId ?…ë ¥'); // ?°ëª¨?? ?¤ì œ UI??ë§ê²Œ êµì²´ ê°€??    if (!productId) return;    setSaving(true);    try {      await setDoc(doc(db, 'products', productId), {        address: result.address,        location: new GeoPoint(result.y, result.x), // (lat, lng)        region: result.region ?? null,        updatedAt: serverTimestamp(),      }, { merge: true });      alert('?€???„ë£Œ');    } catch (e:any) {      alert('?€???¤íŒ¨: ' + e.message);    } finally {      setSaving(false);    }  };  return (    <div style={{display:'grid', gap:12, maxWidth:720, margin:'24px auto'}}>      <h2>ì£¼ì†Œ ??ì¢Œí‘œ ë³€??& ì§€???œì‹œ</h2>      <div style={{display:'flex', gap:8}}>        <input          value={addr}          onChange={e=>setAddr(e.target.value)}          placeholder="ì£¼ì†Œë¥??…ë ¥?˜ì„¸??          style={{flex:1, padding:'8px 12px'}}        />        <button onClick={onSearch} style={{padding:'8px 12px'}}>ê²€??/button>        <button onClick={onSave} disabled={saving || !result?.ok} style={{padding:'8px 12px'}}>          {saving ? '?€?¥ì¤‘...' : 'Firestore ?€??}        </button>      </div>      <div ref={mapRef} style={{width:'100%', height:380, border:'1px solid #e5e7eb', borderRadius:8}} />      {result?.ok && (        <pre style={{background:'#0b1020', color:'#cde3ff', padding:12, borderRadius:8, overflow:'auto'}}>{JSON.stringify(result, null, 2)}        </pre>      )}    </div>  );}