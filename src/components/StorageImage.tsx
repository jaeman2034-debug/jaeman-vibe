import { useEffect, useState } from "react";import { getBlob, ref } from "firebase/storage";import { storage } from "@/lib/firebase";// downloadURL -> storage path ï¿?ë³€??(market%2Fabc.jpg ??market/abc.jpg)function toPath(url: string) {  try {    const p = decodeURIComponent(new URL(url).pathname);    const after = p.split("/o/")[1];    return after?.replace(/%2F/g, "/") || null;  } catch { return null; }}export default function StorageImage({  url, alt="", className="", skeletonClass="bg-slate-100"}: { url: string; alt?: string; className?: string; skeletonClass?: string; }) {  const [src, setSrc] = useState<string | null>(null);  useEffect(() => {    if (!url) { setSrc(null); return; }    // 1) ?ï¿½ì„  ì§ì ‘ URLï¿??ï¿½ë„    const img = new Image();    img.onload = () => setSrc(url);    img.onerror = async () => {      // 2) ?ï¿½íŒ¨?ï¿½ë©´ SDKï¿?Blob ë°›ì•„???ï¿½ì‹œ (ê¶Œí•œ/?ï¿½í° ë¬¸ì œ ?ï¿½íšŒ)      const path = toPath(url);      if (!path) return setSrc(null);      try {        const blob = await getBlob(ref(storage, path));        setSrc(URL.createObjectURL(blob));      } catch {        setSrc(null);      }    };    img.src = url;    return () => { if (src?.startsWith("blob:")) URL.revokeObjectURL(src); };    // eslint-disable-next-line react-hooks/exhaustive-deps  }, [url]);  if (!src) return <div className={`${skeletonClass} h-40 w-full rounded-xl animate-pulse`} />;  return <img src={src} alt={alt} className={className} />;}
