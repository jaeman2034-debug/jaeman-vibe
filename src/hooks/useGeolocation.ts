import { useEffect, useState } from 'react';import { reverseGeocodeDong } from '@/lib/geo';export default function useGeolocation() {  const [coords, setCoords] = useState<{lat:number, lng:number, address?: {sido:string, sigungu:string, dong:string, full:string}} | null>(null);  const [err, setErr] = useState<string | null>(null);  const [permission, setPermission] = useState<'granted' | 'denied' | 'prompt' | null>(null);  const [isEnabled, setIsEnabled] = useState(true);  // ?„ì¹˜ ?•ë³´ë¥?ê°€?¸ì˜¬ ???‰ì •???•ë³´???¨ê»˜ ê°€?¸ì˜¤ê¸?  const getLocationWithAddress = async (lat: number, lng: number) => {    try {      const address = await reverseGeocodeDong(lat, lng);      return { lat, lng, address };    } catch (error) {      console.warn('?‰ì •???•ë³´ë¥?ê°€?¸ì˜¬ ???†ìŠµ?ˆë‹¤:', error);      return { lat, lng };    }  };  useEffect(() => {    if (!navigator.geolocation) {      setErr('ë¸Œë¼?°ì?ê°€ ?„ì¹˜ ?œë¹„?¤ë? ì§€?í•˜ì§€ ?ŠìŠµ?ˆë‹¤.');      return;    }    // ?„ì¹˜ ê¶Œí•œ ?íƒœ ?•ì¸    if (navigator.permissions) {      navigator.permissions.query({ name: 'geolocation' as PermissionName }).then((result) => {        setPermission(result.state);        result.onchange = () => {          setPermission(result.state);          if (result.state === 'denied') {            setCoords(null);            setErr('?„ì¹˜ ê¶Œí•œ??ê±°ë??˜ì—ˆ?µë‹ˆ??');          }        };      });    }    // ?„ì¹˜ ê°ì‹œ ?œìž‘    let id: number | null = null;        if (isEnabled) {      id = navigator.geolocation.watchPosition(        async (pos) => {          const locationWithAddress = await getLocationWithAddress(pos.coords.latitude, pos.coords.longitude);          setCoords(locationWithAddress);          setErr(null);        },        (e) => {          console.error('[GEOLOCATION] ?¤ë¥˜:', e);          switch (e.code) {            case e.PERMISSION_DENIED:              setErr('?„ì¹˜ ê¶Œí•œ??ê±°ë??˜ì—ˆ?µë‹ˆ?? ë¸Œë¼?°ì? ?¤ì •?ì„œ ?„ì¹˜ë¥??ˆìš©?´ì£¼?¸ìš”.');              setPermission('denied');              break;            case e.POSITION_UNAVAILABLE:              setErr('?„ì¹˜ ?•ë³´ë¥?ê°€?¸ì˜¬ ???†ìŠµ?ˆë‹¤.');              break;            case e.TIMEOUT:              setErr('?„ì¹˜ ?•ë³´ ?”ì²­ ?œê°„??ì´ˆê³¼?˜ì—ˆ?µë‹ˆ??');              break;            default:              setErr('?„ì¹˜ ?•ë³´ë¥?ê°€?¸ì˜¤??ì¤??¤ë¥˜ê°€ ë°œìƒ?ˆìŠµ?ˆë‹¤.');          }        },        {           enableHighAccuracy: true,           maximumAge: 10_000,           timeout: 10_000         }      );    }    return () => {      if (id !== null) {        navigator.geolocation.clearWatch(id);      }    };  }, [isEnabled]);  // ?„ì¹˜ ?œë¹„??? ê?  const toggleLocation = () => {    setIsEnabled(!isEnabled);    if (!isEnabled) {      setCoords(null);      setErr(null);    }  };  // ?„ì¹˜ ê¶Œí•œ ?”ì²­  const requestPermission = async () => {    if (navigator.geolocation) {      navigator.geolocation.getCurrentPosition(        async (pos) => {          const locationWithAddress = await getLocationWithAddress(pos.coords.latitude, pos.coords.longitude);          setCoords(locationWithAddress);          setErr(null);          setPermission('granted');          setIsEnabled(true);        },        (e) => {          setErr('?„ì¹˜ ê¶Œí•œ ?”ì²­??ê±°ë??˜ì—ˆ?µë‹ˆ??');          setPermission('denied');        }      );    }  };  return {     coords,     err,     permission,     isEnabled,     toggleLocation,     requestPermission   };}
