"use strict";
// src/hooks/useSpeechRecognition.tsimport { useEffect, useState, useRef } from 'react';import { startListeningGuard, stopListeningGuard, isCurrentlySpeaking, stripExamples } from '@/lib/tts';export const useSpeechRecognition = () => {  const [transcript, setTranscript] = useState('');  const [isListening, setIsListening] = useState(false);  const recognitionRef = useRef<SpeechRecognition | null>(null);  useEffect(() => {    const SpeechRecognition =      (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition;    if (!SpeechRecognition) {      alert('??브라?��????�성 ?�식??지?�하지 ?�습?�다.');      return;    }    const recognition = new SpeechRecognition();    recognition.lang = 'ko-KR';    recognition.interimResults = false;  // 중간 결과 비활?�화    recognition.continuous = false;      // ?�스?????�정??    recognition.onresult = (event: SpeechRecognitionEvent) => {      // ?�시?�도 TTS가 켜져?�으�?결과 무시      if (isCurrentlySpeaking()) return;            const rawResult = event.results[0][0].transcript;      // ?��?�??�시 문장 ?�거 (보조 ?�전�?      const cleaned = stripExamples(rawResult);            // 개발 ?�경?�서�?로그 출력      if (import.meta.env.DEV && rawResult !== cleaned) {        console.log("?�� ?�시 문장 ?�거:", { raw: rawResult, cleaned });      }            setTranscript(cleaned);    };    recognition.onend = () => {      setIsListening(false);      stopListeningGuard(); // ??TTS ?�생 ?�용    };    recognitionRef.current = recognition;  }, []);  const startListening = () => {    if (recognitionRef.current) {      setTranscript('');      startListeningGuard(); // ??TTS 즉시 중단      recognitionRef.current.interimResults = false;      recognitionRef.current.continuous = false;  // ?�스?????�정??      recognitionRef.current.start();      setIsListening(true);    }  };  return { transcript, isListening, startListening };};
