export interface ChatResponse {  reply: string;  model?: string;  timestamp?: string;  error?: string;}export async function sendChat(message: string, opts?: { retries?: number; timeoutMs?: number }): Promise<ChatResponse> {  const retries = opts?.retries ?? 2;  const timeoutMs = opts?.timeoutMs ?? 15000;  let err: any;    for (let i = 0; i <= retries; i++) {    const ctrl = new AbortController();    const to = setTimeout(() => ctrl.abort("timeout"), timeoutMs);        try {      const res = await fetch("/api/chat", {        method: "POST",        headers: { "Content-Type": "application/json" },        body: JSON.stringify({           message,          userId: 'anonymous' // ?„ìš”???¤ì œ ?¬ìš©??IDë¡?ë³€ê²?        }),        signal: ctrl.signal      });            clearTimeout(to);            if (!res.ok) {        const errorData = await res.json().catch(() => ({}));        throw new Error(errorData.error || `Chat API failed: ${res.status}`);      }            const json = await res.json();      if (!json?.reply) throw new Error("empty reply");            return json as ChatResponse;          } catch (e) {      clearTimeout(to);            // ?€?„ì•„???¤ë¥˜?¸ì? ?•ì¸      if (e.name === 'AbortError' && e.message === 'timeout') {        err = new Error(`?”ì²­ ?œê°„ ì´ˆê³¼ (${timeoutMs}ms)`);      } else {        err = e;      }            // ë§ˆì?ë§??œë„ê°€ ?„ë‹ˆë©??¬ì‹œ??      if (i < retries) {        const delay = 300 * (i + 1); // ì§§ì? ë°±ì˜¤?? 300ms, 600ms, 900ms        console.log(`[ChatAPI] ?¬ì‹œ??${i + 1}/${retries + 1} (${delay}ms ?? - ${err.message}`);        await new Promise(r => setTimeout(r, delay));      }    }  }    // ëª¨ë“  ?¬ì‹œ???¤íŒ¨  console.error(`[ChatAPI] ${retries + 1}ë²??œë„ ëª¨ë‘ ?¤íŒ¨:`, err);  throw err;} 
