// devHelpers.ts (index?ì„œ import)import { getAuth } from "firebase/auth";import { backfillDong, checkAdminDong } from "./adminDong";import { getFirestore, doc, updateDoc, serverTimestamp } from "firebase/firestore";// DEV?ì„œë§?window ?¸ì¶œif (import.meta.env.DEV) {  (window as any).authUser = () => console.log(getAuth().currentUser);    (window as any).smoke = async () => {    const { uploadImage } = await import("./upload");    const { addDoc, collection, serverTimestamp } = await import("firebase/firestore");    const { db } = await import("./firebase");    const { url, path } = await uploadImage(new File([new Blob(["iVBORw0KGgo="],{type:"image/png"})], "s.png"));    const ref = await addDoc(collection(db,"products"), {       title:"smoke",       price:1,       category:"ê¸°í?",       images:[{url,path}],       createdAt:serverTimestamp(),       addr:{hjdStatus:"pending"}     });    console.log("SMOKE:", ref.id, url);  };    (window as any).backfillDong = backfillDong;  (window as any).checkAdminDong = checkAdminDong;  // 1) env ?•ì¸  (window as any).envInfo = () => ({    projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,    bucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,    kakaoKeyPresent: !!import.meta.env.VITE_KAKAO_REST_KEY,  });  // 2) ?„ì˜ ì¢Œí‘œ ?¸íŒ…(?†ì„ ??ë¹ ë¥´ê²??ŒìŠ¤??  (window as any).setLoc = async (id: string, lat: number, lng: number) => {    const db = getFirestore();    await updateDoc(doc(db, "products", id), {      "loc.lat": Number(lat),      "loc.lng": Number(lng),      "addr.hjdStatus": "pending",      "addr.hjdCheckedAt": serverTimestamp(),    });    console.log("[HJD] setLoc done:", id, lat, lng);  };  // 3) ì¹´ì¹´??API ??ê¶Œí•œ/???ê?)  (window as any).kakaoPing = async () => {    const key = import.meta.env.VITE_KAKAO_REST_KEY;    const res = await fetch(      "https://dapi.kakao.com/v2/local/geo/coord2address.json?y=37.5665&x=126.9780",      { headers: { Authorization: `KakaoAK ${key}` } }    );    console.log("kakaoPing", res.status, await res.json());  };  // 4) ?‰ì •???íƒœ ?ŒìŠ¤??(HjdBadge ì»´í¬?ŒíŠ¸ ?ŒìŠ¤?¸ìš©)  (window as any).testHjdBadge = () => {    console.log("?§ª HjdBadge ?ŒìŠ¤???œë‚˜ë¦¬ì˜¤:");    console.log("1. ì¢Œí‘œ ?†ìŒ: loc: null");    console.log("2. ì¢Œí‘œ ?ˆìŒ, pending: loc: {lat: 37.5665, lng: 126.9780}, status: 'pending'");    console.log("3. ì¢Œí‘œ ?ˆìŒ, ?±ê³µ: loc: {lat: 37.5665, lng: 126.9780}, status: 'ok'");    console.log("4. ì¢Œí‘œ ?ˆìŒ, ?¤íŒ¨: loc: {lat: 37.5665, lng: 126.9780}, status: 'fail'");    console.log("5. hjd ?ˆìŒ: loc: {lat: 37.5665, lng: 126.9780}, hjd: 'ì¢…ë¡œêµ?");  };  // 5) Firestore ?¸ë±???íƒœ ?•ì¸  (window as any).checkIndexes = () => {    console.log("?” Firestore ?¸ë±???íƒœ ?•ì¸:");    console.log("?„ì¬ ?„ë¡œ?íŠ¸???¸ë±??ëª©ë¡???•ì¸?˜ë ¤ë©?");    console.log("?°ë??ì—?? firebase firestore:indexes");    console.log("?ëŠ” Firebase Console > Firestore > Indexes ??—???•ì¸");    console.log("");    console.log("ê°€ê²?ì¶”ì²œ ê¸°ëŠ¥???„ìš”???¸ë±?¤ë“¤:");    console.log("??(category, status, createdAt)");    console.log("??(category, createdAt)");    console.log("??(status, createdAt)");    console.log("");    console.log("?¸ë±?¤ê? ?†ë‹¤ë©? firebase deploy --only firestore:indexes");  };  // 6) ê°€ê²?ì¶”ì²œ ?”ë²„ê¹?  (window as any).debugPriceSuggest = async (category = "?„ìê¸°ê¸°") => {    console.log("?” ê°€ê²?ì¶”ì²œ ?”ë²„ê¹??œì‘:", category);        const { collection, query, where, orderBy, limit, getDocs } = await import("firebase/firestore");    const { db } = await import("./firebase");        try {      // 1) ?„ì²´ ?í’ˆ ???•ì¸      const allProducts = await getDocs(collection(db, "products"));      console.log(`?“Š ?„ì²´ ?í’ˆ ?? ${allProducts.size}ê°?);            // 2) ì¹´í…Œê³ ë¦¬ë³??í’ˆ ???•ì¸      const categoryProducts = await getDocs(query(        collection(db, "products"),        where("category", "==", category)      ));      console.log(`?“Š ${category} ì¹´í…Œê³ ë¦¬ ?í’ˆ ?? ${categoryProducts.size}ê°?);            // 3) ?íƒœë³??í’ˆ ???•ì¸      const statusProducts = await getDocs(query(        collection(db, "products"),        where("status", "==", "?„ë£Œ")      ));      console.log(`?“Š ?„ë£Œ ?íƒœ ?í’ˆ ?? ${statusProducts.size}ê°?);            // 4) ì¹´í…Œê³ ë¦¬ + ?íƒœ ì¡°í•© ?•ì¸      const categoryStatusProducts = await getDocs(query(        collection(db, "products"),        where("category", "==", category),        where("status", "==", "?„ë£Œ")      ));      console.log(`?“Š ${category} + ?„ë£Œ ?íƒœ ?í’ˆ ?? ${categoryStatusProducts.size}ê°?);            // 5) ?¤ì œ ?°ì´???˜í”Œ ?•ì¸      if (categoryStatusProducts.size > 0) {        const sample = categoryStatusProducts.docs[0].data();        console.log("?“‹ ?˜í”Œ ?°ì´??", {          id: categoryStatusProducts.docs[0].id,          title: sample.title,          category: sample.category,          status: sample.status,          price: sample.price,          createdAt: sample.createdAt,          updatedAt: sample.updatedAt        });      }            // 6) ?¤ë¥¸ ì¹´í…Œê³ ë¦¬???•ì¸      const allCategories = new Set();      allProducts.forEach(doc => {        const data = doc.data();        if (data.category) allCategories.add(data.category);      });      console.log("?“‹ ?¬ìš© ê°€?¥í•œ ì¹´í…Œê³ ë¦¬??", Array.from(allCategories));            // 7) ?¤ë¥¸ ?íƒœ???•ì¸      const allStatuses = new Set();      allProducts.forEach(doc => {        const data = doc.data();        if (data.status) allStatuses.add(data.status);      });      console.log("?“‹ ?¬ìš© ê°€?¥í•œ ?íƒœ??", Array.from(allStatuses));          } catch (error) {      console.error("??ê°€ê²?ì¶”ì²œ ?”ë²„ê¹??¤íŒ¨:", error);    }  };  // 7) ?´ë?ì§€ ?†ì´ ?ŒìŠ¤???í’ˆ ?ì„± (CORS ë¬¸ì œ ?°íšŒ)  (window as any).smokeNoImage = async () => {    try {      const { addDoc, collection, serverTimestamp } = await import("firebase/firestore");      const { db } = await import("./firebase");            const ref = await addDoc(collection(db, "products"), {         title: "?ŒìŠ¤???í’ˆ (?´ë?ì§€ ?†ìŒ)",        price: 10000,        category: "ê¸°í?",        description: "CORS ë¬¸ì œë¥??°íšŒ???ŒìŠ¤???í’ˆ?…ë‹ˆ??",        images: [],        createdAt: serverTimestamp(),        status: "?ë§¤ì¤?,        addr: { hjdStatus: "pending" }      });            console.log("???ŒìŠ¤???í’ˆ ?ì„± ?±ê³µ:", ref.id);      return ref.id;    } catch (error) {      console.error("???ŒìŠ¤???í’ˆ ?ì„± ?¤íŒ¨:", error);      throw error;    }  };  // 8) ë¸Œë¼?°ì? ?„ì¹˜ë¡??í’ˆ ì¢Œí‘œ ?¤ì • (HJD ë¬¸ì œ ?´ê²°)  (window as any).setLocFromBrowser = async (productId: string) => {    try {      const { getFirestore, doc, updateDoc, serverTimestamp, GeoPoint } = await import("firebase/firestore");            // ë¸Œë¼?°ì? ?„ì¹˜ ê¶Œí•œ ?”ì²­      const position = await new Promise<GeolocationPosition>((resolve, reject) => {        navigator.geolocation.getCurrentPosition(resolve, reject, {          enableHighAccuracy: true,          timeout: 10000,          maximumAge: 60000        });      });            const { latitude, longitude } = position.coords;      const db = getFirestore();            // ?í’ˆ ë¬¸ì„œ??loc ?„ë“œ ì¶”ê?      await updateDoc(doc(db, "products", productId), {        loc: new GeoPoint(latitude, longitude),        "addr.hjdStatus": "pending",        "addr.hjdCheckedAt": serverTimestamp(),        updatedAt: serverTimestamp()      });            console.log("??[HJD] ë¸Œë¼?°ì? ?„ì¹˜ë¡?ì¢Œí‘œ ?¤ì • ?„ë£Œ:", {        productId,        lat: latitude,        lng: longitude,        hjdStatus: "pending"      });            return { lat: latitude, lng: longitude };    } catch (error) {      console.error("??[HJD] ë¸Œë¼?°ì? ?„ì¹˜ ?¤ì • ?¤íŒ¨:", error);      throw error;    }  };  // 9) ê¸°ì¡´ ?í’ˆ?¤ì— ì¢Œí‘œ ?¼ê´„ ?¤ì • (ë²Œí¬ ë³´ì •)  (window as any).bulkSetLocFromBrowser = async (batchSize = 5) => {    try {      const { collection, query, getDocs, updateDoc, serverTimestamp } = await import("firebase/firestore");      const { db } = await import("./firebase");            // loc???†ëŠ” ?í’ˆ??ì¡°íšŒ      const productsRef = collection(db, "products");      const snapshot = await getDocs(productsRef);            const productsWithoutLoc = snapshot.docs.filter(doc => {        const data = doc.data();        return !data.loc || !data.loc.latitude || !data.loc.longitude;      });            console.log(`?” [HJD] ì¢Œí‘œê°€ ?†ëŠ” ?í’ˆ: ${productsWithoutLoc.length}ê°?);            if (productsWithoutLoc.length === 0) {        console.log("??[HJD] ëª¨ë“  ?í’ˆ??ì¢Œí‘œê°€ ?´ë? ?¤ì •?˜ì–´ ?ˆìŠµ?ˆë‹¤.");        return;      }            // ë¸Œë¼?°ì? ?„ì¹˜ ê°€?¸ì˜¤ê¸?      const position = await new Promise<GeolocationPosition>((resolve, reject) => {        navigator.geolocation.getCurrentPosition(resolve, reject, {          enableHighAccuracy: true,          timeout: 10000,          maximumAge: 60000        });      });            const { latitude, longitude } = position.coords;      console.log(`?“ [HJD] ?„ì¬ ?„ì¹˜: ${latitude}, ${longitude}`);            // ë°°ì¹˜ ?¬ê¸°ë§Œí¼ ì²˜ë¦¬      const batch = productsWithoutLoc.slice(0, batchSize);      let successCount = 0;            for (const doc of batch) {        try {          await updateDoc(doc.ref, {            loc: new GeoPoint(latitude, longitude),            "addr.hjdStatus": "pending",            "addr.hjdCheckedAt": serverTimestamp(),            updatedAt: serverTimestamp()          });          successCount++;          console.log(`??[HJD] ${doc.id} ì¢Œí‘œ ?¤ì • ?„ë£Œ`);        } catch (error) {          console.error(`??[HJD] ${doc.id} ì¢Œí‘œ ?¤ì • ?¤íŒ¨:`, error);        }      }            console.log(`?¯ [HJD] ë²Œí¬ ì¢Œí‘œ ?¤ì • ?„ë£Œ: ${successCount}/${batch.length}ê°??±ê³µ`);      return { successCount, total: batch.length };    } catch (error) {      console.error("??[HJD] ë²Œí¬ ì¢Œí‘œ ?¤ì • ?¤íŒ¨:", error);      throw error;    }  };  // 10) ?í’ˆ ?´ë?ì§€ ?…ë¡œ??(ì½˜ì†”?ì„œ ì§ì ‘ ?¬ìš©)  (window as any).uploadProductImage = async (productId: string, file: File) => {    try {      const { getStorage, ref, uploadBytesResumable, getDownloadURL } = await import("firebase/storage");      const { getFirestore, doc, updateDoc, arrayUnion } = await import("firebase/firestore");            const storage = getStorage();      const path = `market/${Date.now()}-${file.name}`;      const task = uploadBytesResumable(ref(storage, path), file, { contentType: file.type });            console.log("?“¤ [?´ë?ì§€] ?…ë¡œ???œì‘...");      await task;      const url = await getDownloadURL(ref(storage, path));      console.log("??[?´ë?ì§€] ?…ë¡œ???„ë£Œ:", url);      const db = getFirestore();      await updateDoc(doc(db, "products", productId), {        images: arrayUnion({ path, url }),        cover: url,        hasImages: true,        updatedAt: serverTimestamp()      });            console.log("??[?´ë?ì§€] ?í’ˆ ë¬¸ì„œ ?…ë°?´íŠ¸ ?„ë£Œ");      return { url, path };    } catch (error) {      console.error("??[?´ë?ì§€] ?…ë¡œ???¤íŒ¨:", error);      throw error;    }  };  // 11) ë¸Œë¼?°ì? ?„ì¹˜ë¡??í’ˆ ì¢Œí‘œ ?¤ì • (ê°„ë‹¨ ë²„ì „)  (window as any).setLocFromBrowser = async (productId: string) => {    try {      const { getFirestore, doc, updateDoc, GeoPoint } = await import("firebase/firestore");            return new Promise<void>((resolve, reject) => {        navigator.geolocation.getCurrentPosition(async ({ coords }) => {          try {            const db = getFirestore();            await updateDoc(doc(db, "products", productId), {              loc: new GeoPoint(coords.latitude, coords.longitude),              "addr.hjdStatus": "pending",              "addr.hjdCheckedAt": serverTimestamp(),              updatedAt: serverTimestamp()            });                        console.log("??[HJD] ë¸Œë¼?°ì? ?„ì¹˜ë¡?ì¢Œí‘œ ?¤ì • ?„ë£Œ:", {              productId,              lat: coords.latitude,              lng: coords.longitude            });            resolve();          } catch (error) {            reject(error);          }        }, reject, { enableHighAccuracy: true });      });    } catch (error) {      console.error("??[HJD] ë¸Œë¼?°ì? ?„ì¹˜ ?¤ì • ?¤íŒ¨:", error);      throw error;    }  };  // 12) ëª¨ë“  ?í’ˆ??ì¢Œí‘œ ?¼ê´„ ë³´ì • (? íƒ)  (window as any).backfillLocForAll = async () => {    try {      const { getFirestore, collection, getDocs, updateDoc, doc, GeoPoint } = await import("firebase/firestore");            // ?„ì¬ ë¸Œë¼?°ì? ?„ì¹˜ë¥?ë°›ì•„, loc???†ëŠ” ë¬¸ì„œë§??¼ê´„ ì±„ì?      const position = await new Promise<GeolocationPosition>((resolve, reject) =>        navigator.geolocation.getCurrentPosition(resolve, reject, { enableHighAccuracy: true })      );            const geoPoint = new GeoPoint(position.coords.latitude, position.coords.longitude);      console.log(`?“ [HJD] ?„ì¬ ?„ì¹˜: ${position.coords.latitude}, ${position.coords.longitude}`);      const db = getFirestore();      const snapshot = await getDocs(collection(db, "products"));      const jobs: Promise<any>[] = [];            snapshot.forEach(s => {        const data = s.data() as any;        if (!data.loc) {          jobs.push(updateDoc(doc(db, "products", s.id), {             loc: geoPoint,            "addr.hjdStatus": "pending",            "addr.hjdCheckedAt": serverTimestamp(),            updatedAt: serverTimestamp()          }));        }      });            if (jobs.length === 0) {        console.log("??[HJD] ëª¨ë“  ?í’ˆ??ì¢Œí‘œê°€ ?´ë? ?¤ì •?˜ì–´ ?ˆìŠµ?ˆë‹¤.");        return;      }            console.log(`?” [HJD] ì¢Œí‘œê°€ ?†ëŠ” ?í’ˆ: ${jobs.length}ê°?);      await Promise.all(jobs);      console.log("?¯ [HJD] ëª¨ë“  ?í’ˆ??ì¢Œí‘œ ?¤ì • ?„ë£Œ!");          } catch (error) {      console.error("??[HJD] ?¼ê´„ ì¢Œí‘œ ?¤ì • ?¤íŒ¨:", error);      throw error;    }  };    console.log("?§° Dev helpers ready:");  console.log("  - window.authUser() : ?„ì¬ ?¸ì¦ ?¬ìš©???•ì¸");  console.log("  - window.smoke() : ?ŒìŠ¤???í’ˆ ?ì„±");  console.log("  - window.backfillDong(batchSize) : ë²Œí¬ ?‰ì •???•ì¸");  console.log("  - window.checkAdminDong(id) : ?¨ê±´ ?‰ì •???•ì¸");  console.log("  - window.envInfo() : ?˜ê²½ë³€???•ì¸");  console.log("  - window.setLoc(id, lat, lng) : ?í’ˆ ì¢Œí‘œ ?¤ì •");  console.log("  - window.kakaoPing() : ì¹´ì¹´??API ?°ê²° ?ŒìŠ¤??);  console.log("  - window.testHjdBadge() : ?‰ì •???íƒœ ?ŒìŠ¤???œë‚˜ë¦¬ì˜¤");  console.log("  - window.checkIndexes() : Firestore ?¸ë±???íƒœ ?•ì¸");  console.log("  - window.debugPriceSuggest(category) : ê°€ê²?ì¶”ì²œ ?”ë²„ê¹?);  console.log("  - window.smokeNoImage() : ?´ë?ì§€ ?†ì´ ?ŒìŠ¤???í’ˆ ?ì„± (CORS ?°íšŒ)");  console.log("  - window.setLocFromBrowser(id) : ë¸Œë¼?°ì? ?„ì¹˜ë¡??í’ˆ ì¢Œí‘œ ?¤ì • (HJD ?´ê²°)");  console.log("  - window.bulkSetLocFromBrowser(batchSize) : ê¸°ì¡´ ?í’ˆ??ì¢Œí‘œ ?¼ê´„ ?¤ì •");  console.log("  - window.uploadProductImage(productId, file) : ?í’ˆ ?´ë?ì§€ ?…ë¡œ??);  console.log("  - window.setLocFromBrowser(id) : ë¸Œë¼?°ì? ?„ì¹˜ë¡??í’ˆ ì¢Œí‘œ ?¤ì • (ê°„ë‹¨ ë²„ì „)");  console.log("  - window.backfillLocForAll() : ëª¨ë“  ?í’ˆ??ì¢Œí‘œ ?¼ê´„ ë³´ì •");}