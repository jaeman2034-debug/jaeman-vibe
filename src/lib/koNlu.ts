// src/lib/koNlu.tsexport type ExtractResult = { value: string; ok: boolean; s?: string; text?: string; seg?: string };// -------------------- ê³µí†µ ? í‹¸ --------------------const PROVIDER_KO: Record<string, string> = {  'ì§€ë©”ì¼': 'gmail', 'ì§€ ë©”ì¼': 'gmail', 'gë©”ì¼': 'gmail', 'gmail': 'gmail',  '?¤ì´ë²?: 'naver', '?¤ì´ë²?: 'naver', 'naver': 'naver',  '?¤ìŒ': 'daum', '?œë©”??: 'hanmail',  'ì¹´ì¹´?¤ë©”??: 'kakao', 'ì¹´ì¹´??: 'kakao',  '?¼í›„': 'yahoo', '?«ë©”??: 'hotmail', '??ë©”ì¼': 'hotmail',  'outlook': 'outlook'};const TLD_KO: Record<string, string> = {  '?·ì»´': 'com', 'ì»?: 'com', 'ì½?: 'com', 'com': 'com',  '??: 'net',  'org': 'org', '?¤ì•Œì§€': 'org', '?¤ì???: 'org',  'ì¼€?´ì•Œ': 'kr', 'kr': 'kr',  'ì½?: 'co', '?¨ì˜¤': 'co'};// ê¸°í˜¸/ë¶ˆë¦¿/?°ì˜´?????¼ë°˜ ?•ë¦¬ (?´ë¦„??function sanitizeText(s: string) {  return s    .replace(/(?:^|\s)[??-?“â€?\s+(?=[?œâ€??˜â€?A-Za-zê°€-??)/g, ' ') // ë¶ˆë¦¿/?€???¤ìŒ ?°ì˜´??ë¬¸ì ?œì‘    .replace(/[??-?“â€?/g, ' ')    .replace(/[?œâ€??˜â€?Â«Â»?Œã€ã€ã€?/g, ' ')    .replace(/[(){}\[\]<>]/g, ' ')    .replace(/[!ï¼?ï¼?/g, '.')    .replace(/\s+/g, ' ')    .trim();}// '????ë§? ??'?´ì¬ë§?, 2~6??ìµœì¥ ?„ë³´function pickHangulName(seg: string) {  const comp = seg.replace(/([ê°€-??)\s+(?=[ê°€-??)/g, '$1');  const tokens = comp.match(/[ê°€-??{2,6}/g) || [];  tokens.sort((a, b) => b.length - a.length);  return tokens[0] || '';}// -------------------- ?´ë¦„ ì¶”ì¶œ --------------------export function extractName(t: string): ExtractResult {  const text = sanitizeText(t);  const TRIG = /(?:??s*)??´ë¦„\s*(?:?€|??:)?\s*/i;  // ?œì…?ˆë‹¤/?´ì—???´ë¼ê³??¼êµ¬???¼ê³ ?Â·ë¬¸?¥ë??¸Â·ê³µë°±Â·ë ?±ì—???¤í†±  const STOP = /(?!^)(?=$|[\n,.\-!???'\)\]\} ]|?…ë‹ˆ???´ì—???´ë¼ê³??¼êµ¬???¼ê³ )/i;  const re = new RegExp(TRIG.source + '([\\s\\S]{0,30}?)' + STOP.source, 'i');  const m = text.match(re);  const seg = m ? m[1] : '';  const name = pickHangulName(seg).replace(/??/, '');  return { value: name, ok: !!name, text, seg };}// -------------------- ?´ë©”??ì¶”ì¶œ --------------------function normalizeEmailTokens(s: string) {  // 1) ê¸°í˜¸ ì¹˜í™˜  s = s    .replace(/ê³?s*ë±?s*??ê³¨ë±…????\bat\b/gi, ' @ ')    .replace(/?????„íŠ¸|\bdot\b/gi, ' . ');  // 2) ê³µê¸‰???„ë©”???œê?) ???ë¬¸ ë¨¼ì?  for (const [k, v] of Object.entries(PROVIDER_KO)) {    s = s.replace(new RegExp(k, 'gi'), ' ' + v + ' ');  }  for (const [k, v] of Object.entries(TLD_KO)) {    s = s.replace(new RegExp(k, 'gi'), ' ' + v + ' ');  }  // 3) ?¼ë°˜ ? í° ?œê±° (ì§€ë©”ì¼ ??gmailë¡?ë°”ë€??¤ë¼ ?ˆì „)  s = s.replace(    /(??s*ë©?s*(?:?????\s*(?:????ë¥?ë¯?|??s*ë©??´ë©œ|ë©?s*??ë©”ì¼|ì£¼ì†Œ|?€|?????…ë‹ˆ???´ì—??ë§í• ê²??¤ì‹œ|??.)/gi,    ' '  );  return s.replace(/\s+/g, ' ').trim();}export function extractEmail(raw: string): ExtractResult {  const TRIG = /(?:??s*ë©?s*(?:?????\s*(?:????ë¥?ë¯?|??s*ë©??´ë©œ|ë©?s*??ë©”ì¼)\s*(?:?€|????:)?\s*/i;  const STOP = /(?„í™”|ë²ˆí˜¸|ë¹„ë?ë²ˆí˜¸|ë¹„ë²ˆ|?´ë¦„|???…ë‹ˆ???´ì—???¤ì‹œ ë§??¬ì§ˆë¬?/i;  const m = raw.match(new RegExp(TRIG.source + '([\\s\\S]{0,120}?)(?=' + STOP.source + '|$)', 'i'));  const seg = m ? m[1] : raw;  const s = normalizeEmailTokens(seg);  const em = s.match(/([A-Za-z0-9._\- ]+)\s*@\s*([A-Za-z0-9\-]+)\s*\.\s*([A-Za-z]{2,})/);  if (!em) return { value: '', ok: false, s };  const id = em[1].replace(/[\s.]/g, '').toLowerCase();  const provider = em[2].toLowerCase();  const tld = em[3].toLowerCase();  return { value: `${id}@${provider}.${tld}`, ok: true, s };}
