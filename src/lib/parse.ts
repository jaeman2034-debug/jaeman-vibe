// src/lib/parse.ts// ===== ?«ì ?Œì„œ (? í° ê¸°ë°˜) =====const DIGIT_MAP: Record<string,string> = {  "0":"0","1":"1","2":"2","3":"3","4":"4","5":"5","6":"6","7":"7","8":"8","9":"9",  "ê³?:"0","??:"0","ë¹?:"0",  "??:"1","??:"2","??:"3","??:"4","??:"5","??:"6","ë¥?:"6","ì¹?:"7","??:"8","êµ?:"9",};const MULTI_REPL: [RegExp,string][] = [  [/?¬ì„¯/g, "6"], [/?¼ê³±/g, "7"], [/?¬ëŸ/g, "8"], [/?„í™‰/g, "9"],  [/?ì´???ì‡/g, "8"],  // ?ì–´ ë°œìŒ ë³´ì •];function tokenToDigits(tok: string): string {  // ?œìˆ˜ ?«ìë©?ê·¸ë?ë¡?  if (/^\d+$/.test(tok)) return tok;  // ???œê??´ë©´ë§?ë³€???œë„  if (!/^[ê°€-??+$/.test(tok)) return "";  // ë³µí•© ?Œì ˆ ë¨¼ì? ì¹˜í™˜  for (const [re, rep] of MULTI_REPL) tok = tok.replace(re, rep);  // ?ˆìš© ë¬¸ìë¡œë§Œ êµ¬ì„±??ê²½ìš°?ë§Œ 1:1 ë§¤í•‘  for (const ch of tok) {    if (!(ch in DIGIT_MAP)) return "";  }  return [...tok].map(ch => DIGIT_MAP[ch]).join("");}export function digitsFromSpeech(text: string) {  let s = text.normalize("NFC").toLowerCase();  // êµ¬ë‘??êµ¬ë¶„?´ë? ê³µë°±?¼ë¡œ  s = s.replace(/\b(?˜ì´??ë¹¼ê¸°|?€??dash|??dot|?¼í‘œ|ì½¤ë§ˆ|comma|ë§ˆì¹¨???„í™”ë²ˆí˜¸??|ë²ˆí˜¸??)\b/g, " ");  s = s.replace(/[~_=+.,/\\(){}[\]:;'"`!?@#%^&*<>|]/g, " ");  s = s.replace(/\s+/g, " ").trim();  const tokens = s.split(" ");  let out = "";  for (const t of tokens) out += tokenToDigits(t);  return out;}function pick01xBlock(ds: string): string | null {  const full = ds.match(/01[016789]\d{7,8}/);  if (full) return full[0];  const near = ds.match(/01[016789]\d{6,8}/); // ???ë¦¬ ëª¨ì???ˆìš©  return near?.[0] ?? null;}export function extractPhone(text: string) {  const ds = digitsFromSpeech(text);  const all = pick01xBlock(ds);  if (!all) return null;  const head = all.slice(0, 3);  const remain = all.slice(3);  let midLen = (all.length === 10) ? 3 : 4; // 010-3-4 ?ëŠ” 010-4-4  if (all.length === 9) midLen = Math.max(2, remain.length - 4); // ëª¨ì???„ì‹œ?œê¸°  const mid = remain.slice(0, midLen);  const tail = remain.slice(midLen);  return { digits: head + remain, display: `${head}-${mid}-${tail}` };}export function extractName(raw: string) {  // ?„ì²˜ë¦? ê³µë°±/êµ¬ë‘???•ë¦¬ + ?„ì–´ì§??´ë¦„ ë¶™ì´ê¸?????ë§????´ì¬ë§?  let t = raw    .normalize("NFC")    .replace(/[.,!?;:]/g, " ")    .replace(/\s+/g, " ")    .trim()    .replace(/([ê°€-??)\s(?=[ê°€-??(?:\s[ê°€-??)?)/g, "$1");  // ?´ë¦„ ?¤ì— ?????ˆëŠ” ì¢…ê²°/?„í™˜ ?¤ì›Œ??  const END  = String.raw`(?:?…ë‹ˆ????s*?????´ì—????s*??s*???ˆìš”|??s*????`;  const NEXT = String.raw`(?:?„í™”|?„í™”ë²ˆí˜¸|?„í™”\s*ë²ˆí˜¸|?°ë½ì²??¸ë“œ???´ë???ë²ˆí˜¸)`;  // ?´ë¦„ì²˜ëŸ¼ ë³´ì—¬???ˆë? ?´ë¦„???„ë‹Œ ?¨ì–´  const STOP = /^(?„í™”ë²ˆí˜¸|?„í™”|?°ë½ì²?ë²ˆí˜¸|?´ë¦„|?±í•¨)$/;  const clean = (s: string) =>    s.replace(/\s+/g, "").replace(/(??ë¦?ë¦???$/u, "").replace(/(? ìƒ??|????êµ???$/u, "");  const tryPick = (re: RegExp) => {    const m = t.match(re);    if (!m?.[1]) return null;    const name = clean(m[1]);    if (STOP.test(name)) return null;    return name.length >= 2 && name.length <= 4 ? name : null;  };  // ??"?????´ë¦„?€ ?´ì¬ë§?(??"  const p1 = new RegExp(String.raw`(?:????\s*?´ë¦„(?:?€|:)?\s*([ê°€-??{2,4})(?=\s*(?:${END}|${NEXT}|[^ê°€-??|$))`, "u");  // ??"?´ë¦„?€ ?´ì¬ë§?(??"  ?????ˆë¡œ ì¶”ê?: '???? ?†ì´??ë§¤ì¹­  const p1b = new RegExp(String.raw`?´ë¦„(?:?€|:)?\s*([ê°€-??{2,4})(?=\s*(?:${END}|${NEXT}|[^ê°€-??|$))`, "u");  // ??"?€???˜ëŠ” ?´ì¬ë§?(??"  const p2 = new RegExp(String.raw`(?:?€???˜ëŠ”)\s*([ê°€-??{2,4})(?=\s*(?:${END}|${NEXT}|[^ê°€-??|$))`, "u");  // ???¤ì¸ ë³´ì •: ?´ë¦„+??ë¦?? ì´ ë¶™ì? ê²½ìš°(?´ì¬ë§Œì…/?´ì¬ë§Œë¦„)  const p3 = new RegExp(String.raw`([ê°€-??{2,4})(?=\s*(?:??ë¦?ë¦?ë¦?????\b)`, "u");  // ???¼ë°˜: ì¢…ê²°?´ê? ?¤ì— ë¶™ëŠ” ê²½ìš°?ë§Œ(ë¬¸ì¥ ???¬í•¨)  const p4 = new RegExp(String.raw`([ê°€-??{2,4})(?=\s*${END}\b|$)`, "u");  return tryPick(p1) ?? tryPick(p1b) ?? tryPick(p2) ?? tryPick(p3) ?? tryPick(p4);} 
