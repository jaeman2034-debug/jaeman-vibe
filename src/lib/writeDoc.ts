import { collection, addDoc, serverTimestamp } from "firebase/firestore";import { db } from "@/lib/firebase";import { getCurrentLocation } from "@/features/location/locationService";export type BaseDoc = {  title: string;  imageUrl?: string;  price?: number;  location?: string;  category?: string;  tags?: string[];};export async function createDoc(  collectionName: "products" | "meetings" | "jobs",  data: BaseDoc,  ownerId: string) {  // ?”¥ products ì»¬ë ‰?˜ì¸ ê²½ìš° ?„ìž¬ ?„ì¹˜ ?ë™ ê°€?¸ì˜¤ê¸?  let currentLocation = null;  if (collectionName === "products") {    try {      currentLocation = await getCurrentLocation();      console.log("[CREATE] createDoc - ?„ìž¬ ?„ì¹˜ ê°€?¸ì˜´:", currentLocation);    } catch (error) {      console.warn("[CREATE] createDoc - ?„ì¹˜ ê°€?¸ì˜¤ê¸??¤íŒ¨:", error);    }  }  const doc = {    ...data,    ownerId,    // ?”¥ products??ê²½ìš° ?„ì¹˜ ?•ë³´ ì¶”ê?    ...(collectionName === "products" && currentLocation && {      loc: {        lat: currentLocation.lat,        lng: currentLocation.lng,      },      addr: {        hjdStatus: 'pending' as const      }    }),    createdAt: serverTimestamp(),     // ?”’ rules?ì„œ request.time ?”êµ¬    keywords: buildKeywords(data),    // ?”Ž ?ë™?„ì„± ?•í™•???¥ìƒ  };  return addDoc(collection(db, collectionName), doc);}function buildKeywords(d: BaseDoc): string[] {  const parts = [    d.title,    d.category,    d.location,    ...(d.tags ?? []),  ]    .filter(Boolean)    .map((s) => String(s).toLowerCase());  // ê°„ë‹¨ n-gram prefix  const tokens = new Set<string>();  for (const p of parts) {    const words = p.split(/[^a-z0-9ê°€-??+/i).filter(Boolean);    for (const w of words) {      tokens.add(w);      for (let i = 1; i <= Math.min(w.length, 10); i++) {        tokens.add(w.slice(0, i));      }    }  }  return Array.from(tokens).slice(0, 200);} 