import React, { useState } from "react";
import { signInWithEmailAndPassword, sendPasswordResetEmail } from "firebase/auth";
import { auth } from "@/lib/firebase"; // ???¨ì¼ ì§„ì…???¬ìš©// ?ï¿½ëŒì¹œí™”?ï¿½ì¸ ?ï¿½ì¦ ?ï¿½ë¥˜ ë©”ì‹œì§€ ë§¤í•‘const AUTH_MSG: Record<string, string> = {  'auth/user-not-found': 'ê°€?ï¿½ë˜ì§€ ?ï¿½ï¿½? ?ï¿½ë©”?ï¿½ì…?ï¿½ë‹¤.',  'auth/wrong-password': 'ë¹„ï¿½?ë²ˆí˜¸ê°€ ?ï¿½ë°”ë¥´ï¿½? ?ï¿½ìŠµ?ï¿½ë‹¤.',  'auth/invalid-credential': '?ï¿½ë©”???ï¿½ëŠ” ë¹„ï¿½?ë²ˆí˜¸ê°€ ?ï¿½ë°”ë¥´ï¿½? ?ï¿½ìŠµ?ï¿½ë‹¤.',  'auth/too-many-requests': '?ï¿½ì²­??ë§ìŠµ?ï¿½ë‹¤. ?ï¿½ì‹œ ???ï¿½ì‹œ ?ï¿½ë„?ï¿½ì„¸??',  'auth/network-request-failed': '?ï¿½íŠ¸?ï¿½í¬ ?ï¿½ë¥˜?ï¿½ë‹ˆ?? ?ï¿½í„°???ï¿½ê²°???ï¿½ì¸?ï¿½ì£¼?ï¿½ìš”.',  'auth/invalid-email': '?ï¿½ë°”ï¿??ï¿½ë©”???ï¿½ì‹???ï¿½ë‹™?ï¿½ë‹¤.',  default: 'ë¡œê·¸?ï¿½ì— ?ï¿½íŒ¨?ï¿½ìŠµ?ï¿½ë‹¤. ?ï¿½ì‹œ ???ï¿½ì‹œ ?ï¿½ë„?ï¿½ì„¸??',};function humanize(code?: string) {  return (code && AUTH_MSG[code]) || `${AUTH_MSG.default}${code ? ` (${code})` : ''}`;}export default function EmailLogin() {  const auth = getAuth();  const params = new URLSearchParams(window.location.search);  const [email, setEmail] = useState(params.get("email") || "");  const [password, setPassword] = useState("");  const [msg, setMsg] = useState<string | null>(null);  const [loading, setLoading] = useState(false);  const onLogin = async (e: React.FormEvent) => {    e.preventDefault();    setLoading(true);    setMsg(null);    try {      await signInWithEmailAndPassword(auth, email.trim(), password);      setMsg("ë¡œê·¸???ï¿½ê³µ! ?ï¿½ì‹œ ???ï¿½ë™?ï¿½ë‹ˆ??");      // ?ï¿½ìš” ?? window.location.href = "/";    } catch (err: any) {      // Firebase ?ï¿½ë¥˜ ì½”ë“œ/ë©”ì‹œì§€ï¿?ë¡œê¹… (ë¯¼ê° ?ï¿½ë³´ ?ï¿½ì™¸)      console.error('[AUTH] EmailLogin error:', err?.code, err?.message);      setMsg(humanize(err?.message)); // err.message??'auth/...' ì½”ë“œê°€ ?ï¿½ê²¨??    } finally {      setLoading(false);    }  };  const onReset = async () => {    if (!email) return setMsg("ë¹„ï¿½?ë²ˆí˜¸ ?ï¿½ì„¤??ë©”ì¼??ë³´ë‚¼ ?ï¿½ë©”?ï¿½ì„ ?ï¿½ë ¥??ì£¼ì„¸??");    setLoading(true);    setMsg(null);    try {      await sendPasswordResetEmail(auth, email.trim());      setMsg("ë¹„ï¿½?ë²ˆí˜¸ ?ï¿½ì„¤??ë©”ì¼??ë³´ëƒˆ?ï¿½ë‹ˆ?? ë©”ì¼?ï¿½ì„ ?ï¿½ì¸??ì£¼ì„¸??");    } catch (err: any) {      setMsg(err?.message ?? "?ï¿½ì„¤??ë©”ì¼ ?ï¿½ì†¡???ï¿½íŒ¨?ï¿½ìŠµ?ï¿½ë‹¤.");    } finally {      setLoading(false);    }  };  return (    <div style={{ maxWidth: 420, margin: "48px auto", padding: 24, border: "1px solid #333", borderRadius: 12 }}>      <h2 style={{ marginTop: 0 }}>?ï¿½ë©”??ë¡œê·¸??/h2>      <form onSubmit={onLogin}>        <div style={{ marginBottom: 8 }}>          <input            value={email}            onChange={(e) => setEmail(e.target.value)}            type="email"            placeholder="you@example.com"            required            style={{ width: "100%", padding: 10 }}          />        </div>        <div style={{ marginBottom: 8 }}>          <input            value={password}            onChange={(e) => setPassword(e.target.value)}            type="password"            placeholder="ë¹„ï¿½?ë²ˆí˜¸"            required            style={{ width: "100%", padding: 10 }}          />        </div>        <button disabled={loading} style={{ width: "100%", padding: 12 }}>          {loading ? "ë¡œê·¸??ï¿?.." : "ë¡œê·¸??}        </button>      </form>      <button onClick={onReset} disabled={loading} style={{ width: "100%", padding: 12, marginTop: 8 }}>        ë¹„ï¿½?ë²ˆí˜¸ ?ï¿½ì„¤??ë©”ì¼ ë³´ë‚´ï¿?      </button>      {msg && (        <div style={{ marginTop: 12, padding: 10, background: "#111", border: "1px solid #444" }}>          {msg}        </div>      )}    </div>  );}
