import { useMemo, useState } from "react";import { Link } from "react-router-dom";import ListingCard from "../components/ListingCard";import Pagination from "../components/Pagination";import SortSelect, { SortKey } from "../components/SortSelect";import { haversineKm } from "../utils/geo";import StorageImage from "../components/StorageImage";type Group = {  id: string;  name: string;  schedule: string; // "??09:00"  place: string;  desc: string;  lat: number;  lng: number;  images?: string[]; // ???´ë?ì§€ ?„ë“œ ì¶”ê?  createdAt: number;};const MOCK_GROUPS: Group[] = [  { id:"g1", name:"ì£¼ë§ ì¶•êµ¬ ëª¨ì„", schedule:"??09:00", place:"?±ìˆ˜ ?¸ì¡°êµ¬ì¥", desc:"ì´ˆì¤‘ê¸??˜ì˜", lat:37.544, lng:127.056, createdAt: Date.now()-2e6 },  { id:"g2", name:"?‰ì¼ ?€???Œë‹ˆ??, schedule:"??19:30", place:"? ì‹¤ ì½”íŠ¸", desc:"?”ë¸”???„ì£¼", lat:37.51, lng:127.08, createdAt: Date.now()-5e6 },  { id:"g3", name:"?êµ¬ ë²ˆê°œ", schedule:"ê¸?20:00", place:"ê°•ë‚¨ ?¤ë‚´ì²´ìœ¡ê´€", desc:"ì¹œì„  ê²½ê¸°", lat:37.49, lng:127.03, createdAt: Date.now()-1e6 },];export default function Groups() {  const [q, setQ] = useState("");  const [sort, setSort] = useState<SortKey>("newest");  const [coords, setCoords] = useState<{lat:number;lng:number}|null>(null);  const [radiusKm, setRadiusKm] = useState<number | null>(null);  const [page, setPage] = useState(1);  const pageSize = 6;  const useMyLocation = () => {    navigator.geolocation.getCurrentPosition(      pos=> setCoords({lat:pos.coords.latitude, lng:pos.coords.longitude}),      ()=> alert("?„ì¹˜ ê¶Œí•œ???„ìš”?©ë‹ˆ??")    );  };  const enriched = useMemo(()=>MOCK_GROUPS.map(g=>({    ...g, distanceKm: coords ? haversineKm(coords, {lat:g.lat,lng:g.lng}) : null  })),[coords]);  const filtered = useMemo(()=> enriched.filter(g=>{    if (q && !`${g.name} ${g.place} ${g.desc}`.toLowerCase().includes(q.toLowerCase())) return false;    if (radiusKm && (g.distanceKm ?? Infinity) > radiusKm) return false;    return true;  }),[enriched,q,radiusKm]);  const sorted = useMemo(()=>{    const arr = [...filtered];    if (sort==="distanceAsc") arr.sort((a,b)=>(a.distanceKm??1e9)-(b.distanceKm??1e9));    else arr.sort((a,b)=>b.createdAt-a.createdAt);    return arr;  },[filtered,sort]);  const total = sorted.length;  const pageData = sorted.slice((page-1)*pageSize, page*pageSize);  return (    <>      <div className="space-y-6">        <section className="flex items-center justify-between">          <h2 className="text-2xl font-extrabold">ëª¨ì„</h2>          <div className="flex items-center gap-2">            <button type="button" className="btn-ghost" onClick={useMyLocation}>?“ ???„ì¹˜</button>            <select              value={radiusKm ?? ""}              onChange={(e)=> setRadiusKm(e.target.value ? Number(e.target.value) : null)}              className="rounded-xl border border-slate-200 px-4 py-2.5 bg-white"            >              <option value="">ê±°ë¦¬ ?œí•œ ?†ìŒ</option>              <option value="3">3 km ?´ë‚´</option>              <option value="5">5 km ?´ë‚´</option>              <option value="10">10 km ?´ë‚´</option>            </select>            <SortSelect value={sort} onChange={setSort} withDistance />            <Link to="/groups/create" className="btn-primary">ëª¨ì„ ë§Œë“¤ê¸?/Link>          </div>        </section>        <section className="card">          <input            placeholder="ëª¨ì„ëª??¥ì†Œ/?¤ëª… ê²€??            value={q}            onChange={(e)=>setQ(e.target.value)}            className="w-full rounded-xl border border-slate-200 px-4 py-2.5"          />        </section>        <section className="grid gap-4 md:grid-cols-2">          {pageData.map((g)=>{            const imgUrl = Array.isArray(g.images) && g.images[0] ? g.images[0] : "";            return (              <div key={g.id} className="card">                {/* ???´ë?ì§€ê°€ ?ˆìœ¼ë©?StorageImage, ?†ìœ¼ë©??Œë ˆ?´ìŠ¤?€??*/}                {imgUrl ? (                  <StorageImage                    url={imgUrl}                    alt={g.name}                    className="mb-3 h-40 w-full rounded-xl object-cover"                  />                ) : (                  <div className="mb-3 h-40 w-full rounded-xl bg-slate-100 flex items-center justify-center text-slate-400">                    <div className="text-center">                      <div className="text-2xl mb-2">?‘¥</div>                      <div className="text-sm">?´ë?ì§€ ?†ìŒ</div>                    </div>                  </div>                )}                <div className="font-semibold">{g.name}</div>                <div className="text-sm text-slate-600">{g.desc}</div>                <div className="mt-1 text-sm text-slate-500">                  {[                    `${g.schedule} Â· ${g.place}`,                    g.distanceKm!=null ? `${g.distanceKm.toFixed(1)}km` : null                  ].filter(Boolean).join(" Â· ")}                </div>              </div>            );          })}          {total===0 && <div className="card text-center text-slate-500">ì¡°ê±´??ë§ëŠ” ëª¨ì„???†ì–´??</div>}        </section>        <Pagination page={page} pageSize={pageSize} total={total} setPage={setPage} />      </div>      {/* ???°í•˜???Œë¡œ??ëª¨ì„ ë§Œë“¤ê¸?ë²„íŠ¼ */}      <Link        to="/groups/create"        className="fixed bottom-6 right-6 rounded-full bg-purple-600 px-5 py-3 text-white shadow-lg hover:bg-purple-700 transition-colors duration-200 z-50"      >        + ëª¨ì„ ë§Œë“¤ê¸?      </Link>    </>  );} 
