import { useState } from "react";import { useNavigate } from "react-router-dom";import { createGroup } from "../lib/collections";import { auth, googleProvider } from "@/lib/firebase";import { signInWithPopup } from "firebase/auth";import { FirebaseError } from "firebase/app";export default function GroupsCreate() {  const nav = useNavigate();  const [form, setForm] = useState({ name: "", schedule: "", place: "", desc: "", lat:"", lng:"" });  const [loading, setLoading] = useState(false);  const onChange = (e:any)=> setForm(s=>({...s,[e.target.name]:e.target.value}));  const useMyLocation = () => {    navigator.geolocation.getCurrentPosition(      pos=> setForm(s=>({...s,lat:String(pos.coords.latitude),lng:String(pos.coords.longitude)})),      ()=> alert("?ï¿½ì¹˜ ê¶Œí•œ???ï¿½ìš”?ï¿½ë‹ˆ??")    );  };  const onSubmit = async (e:React.FormEvent) => {    e.preventDefault();    if (loading) return;    setLoading(true);    try {      // 1) ë¡œê·¸??ë³´ì¥ (ê·œì¹™??auth ?ï¿½ìš”?ï¿½ë©´ ?ï¿½ìˆ˜)      if (!auth.currentUser) {        await signInWithPopup(auth, googleProvider);      }      // 2) Firestore ?ï¿??      await createGroup({        name: form.name.trim(),        schedule: form.schedule.trim(),        place: form.place.trim(),        desc: form.desc.trim(),        lat: form.lat ? Number(form.lat) : null,        lng: form.lng ? Number(form.lng) : null,      });      // ??ë¨¼ï¿½? ?ï¿½í”¼???ï¿½ì œ      setLoading(false);      alert("ëª¨ì„ ?ï¿½ì„± ?ï¿½ë£Œ!");      // ?ï¿½ë©´ ?ï¿½í™˜?ï¿??ï¿½ìŒ ?ï¿½ë ˆ?ï¿½ì—      requestAnimationFrame(() => nav("/groups", { replace: true }));    } catch (err: any) {      console.error("[GROUPS_CREATE] error:", err);      setLoading(false); // ?ï¿½íŒ¨ ?ï¿½ë„ ë°”ë¡œ ?ï¿½ì œ      alert("?ï¿???ï¿½íŒ¨: " + (err?.code || err?.message || String(err)));    }  };  return (    <form onSubmit={onSubmit} className="space-y-6">      <h2 className="text-2xl font-extrabold">ëª¨ì„ ë§Œë“¤ï¿?/h2>      <div className="card space-y-4">        <div className="grid gap-4 md:grid-cols-2">          <input name="name" placeholder="ëª¨ì„ï¿? value={form.name} onChange={onChange}                 className="rounded-xl border border-slate-200 px-4 py-2.5" required />          <input name="schedule" placeholder="?ï¿½ì • (?? ??09:00)" value={form.schedule} onChange={onChange}                 className="rounded-xl border border-slate-200 px-4 py-2.5" required />          <input name="place" placeholder="?ï¿½ì†Œ" value={form.place} onChange={onChange}                 className="rounded-xl border border-slate-200 px-4 py-2.5" required />          <input name="lat" placeholder="?ï¿½ë„(lat)" value={form.lat} onChange={onChange}                 className="rounded-xl border border-slate-200 px-4 py-2.5" />          <input name="lng" placeholder="ê²½ë„(lng)" value={form.lng} onChange={onChange}                 className="rounded-xl border border-slate-200 px-4 py-2.5" />        </div>        <textarea name="desc" placeholder="?ï¿½ëª…" value={form.desc} onChange={onChange}                  className="w-full rounded-xl border border-slate-200 px-4 py-2.5 h-28" />        <button type="button" className="btn-ghost" onClick={useMyLocation}>?ï¿½ï¿½ ?ï¿½ì¬ ?ï¿½ì¹˜ï¿?ì±„ìš°ï¿?/button>        <div className="flex justify-end gap-3">          <button type="button" onClick={()=>nav(-1)} className="btn-ghost">ì·¨ì†Œ</button>          <button type="submit" className="btn-primary" disabled={loading}>            {loading ? "?ï¿??ï¿?.." : "ë§Œë“¤ï¿?}          </button>        </div>      </div>    </form>  );}
