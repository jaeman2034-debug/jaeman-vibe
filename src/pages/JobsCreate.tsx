import { useState } from "react";import { useNavigate } from "react-router-dom";import ImageUploader, { Uploaded } from "../components/ImageUploader";import { uploadImages } from "../lib/upload";import { createJobPost } from "../lib/collections";import { auth, googleProvider } from "@/lib/firebase";import { signInWithPopup } from "firebase/auth";export default function JobsCreate() {  const nav = useNavigate();  const [form, setForm] = useState({ role:"", org:"", location:"", pay:"", desc:"", lat:"", lng:"" });  // ???ï¿½ì¼ ë¦¬ìŠ¤??ë³€?ï¿½ëª…??images?ï¿?ê²¹ì¹˜ì§€ ?ï¿½ê²Œ  const [photos, setPhotos] = useState<Uploaded[]>([]);  const [loading, setLoading] = useState(false);  const onChange = (e:any)=> setForm(s=>({...s,[e.target.name]:e.target.value}));  const useMyLocation = () => {    navigator.geolocation.getCurrentPosition(      pos=> setForm(s=>({...s,lat:String(pos.coords.latitude),lng:String(pos.coords.longitude)})),      ()=> alert("?ï¿½ì¹˜ ê¶Œí•œ???ï¿½ìš”?ï¿½ë‹ˆ??")    );  };  const onSubmit = async (e:React.FormEvent) => {    e.preventDefault();    if (loading) return;    setLoading(true);    try {      // 1) ë¡œê·¸??ë³´ì¥ (ê·œì¹™??auth ?ï¿½ìš”?ï¿½ë©´ ?ï¿½ìˆ˜)      if (!auth.currentUser) {        await signInWithPopup(auth, googleProvider);      }      // 2) Storage ?ï¿½ë¡œ????URL ë°°ì—´      const urls = photos.length         ? await uploadImages(photos.map(p => p.file), "jobs")         : [];      // 3) Firestore?ï¿½ëŠ” URL ë°°ì—´ï¿??ï¿??      await createJobPost({        role: form.role.trim(),        org: form.org.trim(),        location: form.location.trim(),        pay: form.pay.trim() || undefined,        desc: form.desc.trim(),        lat: form.lat ? Number(form.lat) : null,        lng: form.lng ? Number(form.lng) : null,        images: urls,                              // ???ï¿½ì‹¬: URL ë°°ì—´ï¿?      });      // ??ë¨¼ï¿½? ?ï¿½í”¼???ï¿½ì œ      setLoading(false);      alert("ì±„ìš© ê³µê³  ?ï¿½ë¡ ?ï¿½ë£Œ!");      // ?ï¿½ë©´ ?ï¿½í™˜?ï¿??ï¿½ìŒ ?ï¿½ë ˆ?ï¿½ì—      requestAnimationFrame(() => nav("/jobs", { replace: true }));    } catch (err: any) {      console.error("[JOBS_CREATE] error:", err);      setLoading(false); // ?ï¿½íŒ¨ ?ï¿½ë„ ë°”ë¡œ ?ï¿½ì œ      alert("?ï¿½ë¡ ?ï¿½íŒ¨: " + (err?.code || err?.message || String(err)));    }  };  return (    <form onSubmit={onSubmit} className="space-y-6">      <h2 className="text-2xl font-extrabold">ì±„ìš© ê³µê³  ?ï¿½ë¡</h2>      <div className="card space-y-4">        <div className="grid gap-4 md:grid-cols-2">          <input name="role" placeholder="?ï¿½ï¿½??? value={form.role} onChange={onChange}                className="rounded-xl border border-slate-200 px-4 py-2.5" required />          <input name="org" placeholder="?ï¿½ì†/ê¸°ï¿½?" value={form.org} onChange={onChange}                className="rounded-xl border border-slate-200 px-4 py-2.5" required />          <input name="location" placeholder="ê·¼ë¬´ì§€" value={form.location} onChange={onChange}                className="rounded-xl border border-slate-200 px-4 py-2.5" required />          <input name="pay" placeholder="ê¸‰ì—¬(?ï¿½íƒ)" value={form.pay} onChange={onChange}                className="rounded-xl border border-slate-200 px-4 py-2.5" />        </div>        <textarea name="desc" placeholder="?ï¿½ë¬´ ?ï¿½ìš©, ?ï¿½ï¿½??ï¿½í•­ ?? value={form.desc} onChange={onChange}                  className="w-full rounded-xl border border-slate-200 px-4 py-2.5 h-28" />        <ImageUploader multiple onChange={setPhotos} />        <div className="grid gap-4 md:grid-cols-2">          <input name="lat" placeholder="?ï¿½ë„(lat)" value={form.lat} onChange={onChange}                className="rounded-xl border border-slate-200 px-4 py-2.5" />          <input name="lng" placeholder="ê²½ë„(lng)" value={form.lng} onChange={onChange}                className="rounded-xl border border-slate-200 px-4 py-2.5" />        </div>        <button type="button" className="btn-ghost" onClick={useMyLocation}>?ï¿½ï¿½ ?ï¿½ì¬ ?ï¿½ì¹˜ï¿?ì±„ìš°ï¿?/button>        <div className="flex justify-end gap-3">          <button type="button" onClick={()=>nav(-1)} className="btn-ghost">ì·¨ì†Œ</button>          <button type="submit" className="btn-primary" disabled={loading}>            {loading ? "?ï¿½ë¡ ï¿?.." : "?ï¿½ë¡?ï¿½ê¸°"}          </button>        </div>      </div>    </form>  );}
