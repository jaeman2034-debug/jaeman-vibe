import { useState } from "react";import { useNavigate } from "react-router-dom";import ImageUploader, { Uploaded } from "../components/ImageUploader";import { uploadImages } from "../lib/upload";import { createJobPost } from "../lib/collections";import { auth, googleProvider } from "@/lib/firebase";import { signInWithPopup } from "firebase/auth";export default function JobsCreate() {  const nav = useNavigate();  const [form, setForm] = useState({ role:"", org:"", location:"", pay:"", desc:"", lat:"", lng:"" });  // ???�일 리스??변?�명??images?� 겹치지 ?�게  const [photos, setPhotos] = useState<Uploaded[]>([]);  const [loading, setLoading] = useState(false);  const onChange = (e:any)=> setForm(s=>({...s,[e.target.name]:e.target.value}));  const useMyLocation = () => {    navigator.geolocation.getCurrentPosition(      pos=> setForm(s=>({...s,lat:String(pos.coords.latitude),lng:String(pos.coords.longitude)})),      ()=> alert("?�치 권한???�요?�니??")    );  };  const onSubmit = async (e:React.FormEvent) => {    e.preventDefault();    if (loading) return;    setLoading(true);    try {      // 1) 로그??보장 (규칙??auth ?�요?�면 ?�수)      if (!auth.currentUser) {        await signInWithPopup(auth, googleProvider);      }      // 2) Storage ?�로????URL 배열      const urls = photos.length         ? await uploadImages(photos.map(p => p.file), "jobs")         : [];      // 3) Firestore?�는 URL 배열�??�??      await createJobPost({        role: form.role.trim(),        org: form.org.trim(),        location: form.location.trim(),        pay: form.pay.trim() || undefined,        desc: form.desc.trim(),        lat: form.lat ? Number(form.lat) : null,        lng: form.lng ? Number(form.lng) : null,        images: urls,                              // ???�심: URL 배열�?      });      // ??먼�? ?�피???�제      setLoading(false);      alert("채용 공고 ?�록 ?�료!");      // ?�면 ?�환?� ?�음 ?�레?�에      requestAnimationFrame(() => nav("/jobs", { replace: true }));    } catch (err: any) {      console.error("[JOBS_CREATE] error:", err);      setLoading(false); // ?�패 ?�도 바로 ?�제      alert("?�록 ?�패: " + (err?.code || err?.message || String(err)));    }  };  return (    <form onSubmit={onSubmit} className="space-y-6">      <h2 className="text-2xl font-extrabold">채용 공고 ?�록</h2>      <div className="card space-y-4">        <div className="grid gap-4 md:grid-cols-2">          <input name="role" placeholder="?��??? value={form.role} onChange={onChange}                className="rounded-xl border border-slate-200 px-4 py-2.5" required />          <input name="org" placeholder="?�속/기�?" value={form.org} onChange={onChange}                className="rounded-xl border border-slate-200 px-4 py-2.5" required />          <input name="location" placeholder="근무지" value={form.location} onChange={onChange}                className="rounded-xl border border-slate-200 px-4 py-2.5" required />          <input name="pay" placeholder="급여(?�택)" value={form.pay} onChange={onChange}                className="rounded-xl border border-slate-200 px-4 py-2.5" />        </div>        <textarea name="desc" placeholder="?�무 ?�용, ?��??�항 ?? value={form.desc} onChange={onChange}                  className="w-full rounded-xl border border-slate-200 px-4 py-2.5 h-28" />        <ImageUploader multiple onChange={setPhotos} />        <div className="grid gap-4 md:grid-cols-2">          <input name="lat" placeholder="?�도(lat)" value={form.lat} onChange={onChange}                className="rounded-xl border border-slate-200 px-4 py-2.5" />          <input name="lng" placeholder="경도(lng)" value={form.lng} onChange={onChange}                className="rounded-xl border border-slate-200 px-4 py-2.5" />        </div>        <button type="button" className="btn-ghost" onClick={useMyLocation}>?�� ?�재 ?�치�?채우�?/button>        <div className="flex justify-end gap-3">          <button type="button" onClick={()=>nav(-1)} className="btn-ghost">취소</button>          <button type="submit" className="btn-primary" disabled={loading}>            {loading ? "?�록 �?.." : "?�록?�기"}          </button>        </div>      </div>    </form>  );}