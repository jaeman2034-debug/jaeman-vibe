import React, { useEffect, useState } from 'react';import { collection, getDocs, orderBy, query, where } from 'firebase/firestore';import { onAuthStateChanged } from 'firebase/auth';import { db, auth } from '@/lib/firebase';import { useNavigate } from 'react-router-dom';interface ProductData {  id: string;  title: string;  price: number;  status: '?ë§¤ì¤? | '?ˆì•½ì¤? | '?„ë£Œ';  createdAt: any;  images?: string[];  category?: string;}export default function MyProducts() {  const [items, setItems] = useState<ProductData[]>([]);  const [loading, setLoading] = useState(true);  const [user, setUser] = useState<any>(null);  const navigate = useNavigate();  // Auth ?íƒœ êµ¬ë…  useEffect(() => {    const unsubscribe = onAuthStateChanged(auth, (user) => {      console.log('[MyProducts] Auth state changed:', user?.uid);      setUser(user);    });    return () => unsubscribe();  }, []);  // ?í’ˆ ëª©ë¡ ë¡œë“œ  useEffect(() => {    if (!user?.uid) return;        const loadMyProducts = async () => {      try {        setLoading(true);        const q = query(          collection(db, 'products'), // ??products ê¸°ì??¼ë¡œ ë³€ê²?          where('sellerId', '==', user.uid),          orderBy('createdAt', 'desc')        );                const snapshot = await getDocs(q);        const products = snapshot.docs.map(doc => ({          id: doc.id,          ...doc.data()        })) as ProductData[];                setItems(products);      } catch (error) {        console.error('???í’ˆ ë¡œë“œ ?¤íŒ¨:', error);      } finally {        setLoading(false);      }    };    loadMyProducts();  }, [user?.uid]);  const getTimeAgo = (timestamp: any) => {    if (!timestamp) return '';        const now = Date.now();    const time = timestamp.toMillis ? timestamp.toMillis() : timestamp;    const diff = now - time;        if (diff < 60000) return 'ë°©ê¸ˆ ??;    if (diff < 3600000) return `${Math.floor(diff / 60000)}ë¶???;    if (diff < 86400000) return `${Math.floor(diff / 3600000)}?œê°„ ??;    return `${Math.floor(diff / 86400000)}????;  };  const getStatusColor = (status: string) => {    switch (status) {      case '?ë§¤ì¤?: return 'bg-green-100 text-green-800';      case '?ˆì•½ì¤?: return 'bg-yellow-100 text-yellow-800';      case '?„ë£Œ': return 'bg-gray-100 text-gray-800';      default: return 'bg-gray-100 text-gray-800';    }  };  if (!user) {    return (      <div className="p-4 text-center">        <p className="text-gray-600">ë¡œê·¸?¸ì´ ?„ìš”?©ë‹ˆ??</p>      </div>    );  }  if (loading) {    return (      <div className="p-4">        <div className="animate-pulse space-y-3">          {[1, 2, 3].map(i => (            <div key={i} className="border rounded p-3">              <div className="h-4 bg-gray-200 rounded mb-2"></div>              <div className="h-6 bg-gray-200 rounded"></div>            </div>          ))}        </div>      </div>    );  }  return (    <div className="p-4 max-w-4xl mx-auto">      {/* ?¤ë” */}      <div className="mb-6">        <h1 className="text-2xl font-bold mb-2">???í’ˆ</h1>        <p className="text-gray-600">?´ê? ?±ë¡???í’ˆ?¤ì„ ê´€ë¦¬í•˜?¸ìš”</p>      </div>      {/* ?í’ˆ ëª©ë¡ */}      {items.length === 0 ? (        <div className="text-center py-12">          <div className="text-gray-400 text-6xl mb-4">?“¦</div>          <p className="text-gray-600 mb-4">?„ì§ ?±ë¡???í’ˆ???†ìŠµ?ˆë‹¤</p>          <button            onClick={() => navigate('/market/create')}            className="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"          >            ì²??í’ˆ ?±ë¡?˜ê¸°          </button>        </div>      ) : (        <div className="space-y-4">          {items.map(product => (            <div key={product.id} className="border rounded-lg p-4 hover:shadow-md transition-shadow">              <div className="flex items-start justify-between">                {/* ?í’ˆ ?•ë³´ */}                <div className="flex-1">                  <div className="flex items-center gap-3 mb-2">                    <h3 className="text-lg font-semibold">{product.title}</h3>                    <span className={`px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(product.status)}`}>                      {product.status}                    </span>                  </div>                                    <div className="text-xl font-bold text-indigo-600 mb-2">                    {product.price?.toLocaleString()}??                  </div>                                    <div className="flex items-center gap-4 text-sm text-gray-500">                    <span>{getTimeAgo(product.createdAt)}</span>                    {product.category && <span>ì¹´í…Œê³ ë¦¬: {product.category}</span>}                  </div>                </div>                {/* ?¸ë„¤???´ë?ì§€ */}                {product.images && product.images.length > 0 && (                  <div className="ml-4">                    <img                      src={product.images[0]}                      alt={product.title}                      className="w-20 h-20 object-cover rounded-lg"                    />                  </div>                )}              </div>              {/* ?¡ì…˜ ë²„íŠ¼??*/}              <div className="flex items-center gap-3 mt-4 pt-4 border-t">                <button                  onClick={() => navigate(`/market/${product.id}/edit`)}                  className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"                >                  ?˜ì •?˜ê¸°                </button>                                <button                  onClick={() => navigate(`/market/${product.id}`)}                  className="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"                >                  ?ì„¸ë³´ê¸°                </button>                                <button                  onClick={() => navigate(`/market/${product.id}`)}                  className="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"                >                  ì±„íŒ…ë°?                </button>              </div>            </div>          ))}        </div>      )}      {/* ???í’ˆ ?±ë¡ ë²„íŠ¼ */}      {items.length > 0 && (        <div className="mt-8 text-center">          <button            onClick={() => navigate('/market/create')}            className="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"          >            + ???í’ˆ ?±ë¡          </button>        </div>      )}    </div>  );}