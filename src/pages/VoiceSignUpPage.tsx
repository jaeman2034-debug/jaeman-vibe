// src/pages/VoiceSignUpPage.tsximport { useEffect, useRef, useState } from "react";import {   createUserWithEmailAndPassword,   signInWithEmailAndPassword} from "firebase/auth";import type {   UserCredential} from "firebase/auth";import { auth, db } from "@/lib/firebase";/** * ?????Œì¼ ?˜ë‚˜ë¡??ë‚˜??"?µë³µ" ë²„ì „ * - useSettings ?€ì²? ê¸°ë³¸ locale?€ ko-KR * - ë§ˆì´??ê¶Œí•œ ?•ì¸/?ˆë²¨ë¯¸í„°/?•ë¦¬(force kill) ?´ì¥ * - ?´ë¦„/?´ë©”??ë¹„ë?ë²ˆí˜¸ ?•ê·œ??ê²€ì¦?? í‹¸ ?´ì¥ * - ë¸Œë¼?°ì? SpeechRecognition ì§ì ‘ êµ¬ë™ (?´ë¦­ ì»¨í…?¤íŠ¸?ì„œ ì¦‰ì‹œ start) * - Firebase Auth ?°ë™ (?Œì›ê°€??ë¡œê·¸?? * - TTS ?¼ë“œë°?(?Œì„± ?ˆë‚´) * - HTTPS ì²´í¬Â·ê°€??(ë³´ì•ˆ ê°•í™”) * * ?¬ìš©ë²? * 1) ???Œì¼???„ë¡œ?íŠ¸??ì¶”ê? * 2) ?¼ìš°?°ê? ?ˆë‹¤ë©???ì»´í¬?ŒíŠ¸ë¥??¼ìš°?¸ì— ?°ê²° *    (?ëŠ” App.tsx ?±ì—??<VoiceSignUpPage /> ?Œë”) */// ----------------------------------------------------// ?”’ HTTPS ì²´í¬Â·ê°€??// ----------------------------------------------------function checkHTTPS(): boolean {  if (window.location.protocol === 'https:') return true;  if (window.location.hostname === 'localhost') return true;  if (window.location.hostname === '127.0.0.1') return true;  return false;}function showHTTPSWarning(): void {  if (!checkHTTPS()) {    alert('? ï¸ ë³´ì•ˆ???„í•´ HTTPS ?°ê²°???„ìš”?©ë‹ˆ??\n?„ì¬ HTTPë¡??‘ì† ì¤‘ì…?ˆë‹¤.');  }}// ----------------------------------------------------// ?”Š TTS ?¼ë“œë°?? í‹¸// ----------------------------------------------------function speak(text: string, rate: number = 1.5): void {  if ('speechSynthesis' in window) {    // ê¸°ì¡´ ?Œì„± ì¤‘ì?    window.speechSynthesis.cancel();        const utterance = new SpeechSynthesisUtterance(text);    utterance.lang = 'ko-KR';    utterance.rate = rate; // ìµœì  ?ë„ 1.5    utterance.pitch = 1.0;    utterance.volume = 1.0;        window.speechSynthesis.speak(utterance);  }}// ----------------------------------------------------// ?”¥ Firebase Auth ?°ë™// ----------------------------------------------------async function signUpWithFirebase(email: string, password: string): Promise<UserCredential> {  try {    const userCredential = await createUserWithEmailAndPassword(auth, email, password);    return userCredential;  } catch (error: any) {    if (error && typeof error === 'object' && 'code' in error) {      throw new Error(getFirebaseErrorMessage(error.code));    }    throw new Error('?????†ëŠ” ?¤ë¥˜ê°€ ë°œìƒ?ˆìŠµ?ˆë‹¤.');  }}async function signInWithFirebase(email: string, password: string): Promise<UserCredential> {  try {    const userCredential = await signInWithEmailAndPassword(auth, email, password);    return userCredential;  } catch (error: any) {    if (error && typeof error === 'object' && 'code' in error) {      throw new Error(getFirebaseErrorMessage(error.code));    }    throw new Error('?????†ëŠ” ?¤ë¥˜ê°€ ë°œìƒ?ˆìŠµ?ˆë‹¤.');  }}function getFirebaseErrorMessage(code: string): string {  switch (code) {    case 'auth/email-already-in-use':      return '?´ë? ?¬ìš© ì¤‘ì¸ ?´ë©”?¼ì…?ˆë‹¤.';    case 'auth/invalid-email':      return '?¬ë°”ë¥´ì? ?Šì? ?´ë©”???•ì‹?…ë‹ˆ??';    case 'auth/operation-not-allowed':      return '?´ë©”??ë¹„ë?ë²ˆí˜¸ ë¡œê·¸?¸ì´ ë¹„í™œ?±í™”?˜ì–´ ?ˆìŠµ?ˆë‹¤.';    case 'auth/weak-password':      return 'ë¹„ë?ë²ˆí˜¸ê°€ ?ˆë¬´ ?½í•©?ˆë‹¤. 8???´ìƒ?¼ë¡œ ?¤ì •??ì£¼ì„¸??';    case 'auth/user-disabled':      return 'ë¹„í™œ?±í™”??ê³„ì •?…ë‹ˆ??';    case 'auth/user-not-found':      return '?±ë¡?˜ì? ?Šì? ?´ë©”?¼ì…?ˆë‹¤.';    case 'auth/wrong-password':      return '?˜ëª»??ë¹„ë?ë²ˆí˜¸?…ë‹ˆ??';    case 'auth/too-many-requests':      return '?ˆë¬´ ë§ì? ë¡œê·¸???œë„ê°€ ?ˆì—ˆ?µë‹ˆ?? ? ì‹œ ???¤ì‹œ ?œë„??ì£¼ì„¸??';    default:      return '?¸ì¦ ì¤??¤ë¥˜ê°€ ë°œìƒ?ˆìŠµ?ˆë‹¤.';  }}// ----------------------------------------------------// ë¸Œë¼?°ì? ?€???ˆì „ ì²˜ë¦¬ (webkitSpeechRecognition ?€??// ----------------------------------------------------type SpeechRecognitionErrorCode =  | "no-speech"  | "aborted"  | "audio-capture"  | "network"  | "not-allowed"  | "service-not-allowed"  | "bad-grammar"  | "language-not-supported"  | "unknown";type SRLike = SpeechRecognition & {  // webkitSpeechRecognition???¬í•¨};declare global {  interface Window {    webkitSpeechRecognition?: {      new (): SRLike;    };    SpeechRecognition?: {      new (): SRLike;    };  }}// ----------------------------------------------------// ê°„ë‹¨ Settings ?€ì²???(ê¸°ë³¸ ko-KR)// ----------------------------------------------------function useSettingsFallback() {  return { locale: "ko-KR" as const };}// ----------------------------------------------------// ?”§ ë§ˆì´??? í‹¸: ê¶Œí•œ/?ˆë²¨ë¯¸í„°/ê°•ì œì¢…ë£Œ// ----------------------------------------------------async function ensureMicPermission(): Promise<void> {  // ê¶Œí•œ ê°•ì œ ?•ì¸ (ê¶Œí•œ ?„ë¡¬?„íŠ¸)  await navigator.mediaDevices.getUserMedia({ audio: true });}type MeterStopper = () => void;/** * ë§ˆì´???ˆë²¨ ë¯¸í„° ?œì‘ * - callback(v): 0~1 RMS ê·¼ì‚¬ê°? * - ë°˜í™˜ê°? ?•ì? ?¨ìˆ˜ */async function startMicLevelMeter(  callback: (level01: number) => void): Promise<MeterStopper> {  const stream = await navigator.mediaDevices.getUserMedia({    audio: { echoCancellation: true, noiseSuppression: true, autoGainControl: true },  });  const Ctx = window.AudioContext || (window as any).webkitAudioContext;  const ctx = new Ctx();  const source = ctx.createMediaStreamSource(stream);  const analyser = ctx.createAnalyser();  analyser.fftSize = 1024;  source.connect(analyser);  const buf = new Float32Array(analyser.fftSize);  let rafId = 0;  const tick = () => {    analyser.getFloatTimeDomainData(buf);    let sum = 0;    for (let i = 0; i < buf.length; i++) sum += buf[i] * buf[i];    const rms = Math.sqrt(sum / buf.length); // 0~1 ê·¼ì‚¬    callback(Math.max(0, Math.min(1, rms)));    rafId = requestAnimationFrame(tick);  };  rafId = requestAnimationFrame(tick);  // ?•ì? ?¨ìˆ˜  const stop = () => {    try {      cancelAnimationFrame(rafId);      source.disconnect();      analyser.disconnect();      ctx.close();    } catch {}    try {      stream.getTracks().forEach((t) => t.stop());    } catch {}  };  return stop;}/** ë§ˆì´???¤ë””??ë¦¬ì†Œ??ê°•ì œ ì¢…ë£Œ??(ë³´ìˆ˜?ìœ¼ë¡??¸ì¶œ) */function forceKillMic() {  // ???µë³µ ?Œì¼?ì„  startMicLevelMeterê°€ ë¦¬í„´?˜ëŠ” stop?¼ë¡œ ê´€ë¦¬ë˜ë¯€ë¡?  // ?¬ê¸°?œëŠ” ì¶”ê?ë¡?ì¢…ë£Œ???¤íŠ¸ë¦?ì»¨í…?¤íŠ¸ë¥?ì¶”ì ?˜ì? ?ŠìŒ.  // ?„ìš”???•ì¥ ê°€??}// ----------------------------------------------------// ?§¹ ?•ê·œ??ê²€ì¦?? í‹¸// ----------------------------------------------------function cleanName(raw: string): string {  // ?œê?/?ë¬¸/ê³µë°±ë§?? ì?, ?¤ì¤‘ ê³µë°± ?¨ì¼??  return (raw || "")    .replace(/[^a-zA-Zê°€-??s]/g, "")    .replace(/\s+/g, " ")    .trim();}function normalizeEmail(raw: string): string {  let t = (raw || "").toLowerCase().trim();  // ?œê? ?Œì„± ?œí˜„ ì¹˜í™˜  // ?? "ê³¨ë±…?? -> @, "?? -> ".", "?·ì»´" -> ".com"  t = t    .replace(/\s+/g, " ")    .replace(/ê³¨ë±…?????ì´??g, "@")    .replace(/??s?/g, ".")    .replace(/?·ì»´|??ì»???ì½?g, ".com")    .replace(/\s+/g, "");  // ê³µë°± ?œê±°, ?”í•œ ?œê? ?„ë©”??ë°œí™” ë³´ì •  t = t    .replace(/ì§€ë©”ì¼|gmail\.?com/g, "gmail.com")    .replace(/?¤ì´ë²?naver\.?com/g, "naver.com")    .replace(/?¤ìŒ|daum\.?net/g, "daum.net")    .replace(/?¼í›„|yahoo\.?com/g, "yahoo.com");  return t;}function isValidEmail(v: string): boolean {  if (!v) return false;  // ê°„ë‹¨/ê²¬ê³ ??ê²€ì¦?  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);}function isStrongPassword(v: string): boolean {  return (v || "").length >= 8; // ?„ìš”??ê·œì¹™ ê°•í™”}// ----------------------------------------------------// ?“¦ ë©”ì¸ ì»´í¬?ŒíŠ¸// ----------------------------------------------------type Step = 0 | 1 | 2 | 3; // 0: ?´ë¦„, 1: ?´ë©”?? 2: ë¹„ë²ˆ, 3: ?•ì¸/?œì¶œtype Mode = "signup" | "signin"; // ?Œì›ê°€???ëŠ” ë¡œê·¸??ëª¨ë“œexport default function VoiceSignUpPage() {  const { locale } = useSettingsFallback();  const safeLocale = locale || "ko-KR";  // HTTPS ì²´í¬  useEffect(() => {    showHTTPSWarning();  }, []);  const [mode, setMode] = useState<Mode>("signup");  const [step, setStep] = useState<Step>(0);  const [name, setName] = useState("");  const [email, setEmail] = useState("");  const [pw, setPw] = useState("");  const [listening, setListening] = useState(false);  const [error, setError] = useState<string | null>(null);  const [loading, setLoading] = useState(false);  // STT ë¡œê·¸ ?œì‹œ (ì½˜ì†” ??ë´ë„ ?ì¸ ?Œì•…)  const [srLog, setSrLog] = useState<string[]>([]);  const log = (m: string) => setSrLog((xs) => [...xs.slice(-80), m]);  // ë§ˆì´???ˆë²¨ ë¯¸í„° ?íƒœ  const [micLevel, setMicLevel] = useState(0); // 0~1  const meterStopRef = useRef<null | (() => void)>(null);  const [meterOn, setMeterOn] = useState(false);  const mounted = useRef(true);  useEffect(() => {    mounted.current = true;    return () => {      mounted.current = false;      try {        meterStopRef.current?.();      } catch {}      forceKillMic();    };  }, []);  // ë¯¸í„° ?œì‘/ì¢…ë£Œ  async function startMeter() {    try {      await ensureMicPermission();      meterStopRef.current = await startMicLevelMeter((v) => setMicLevel(v));      setMeterOn(true);      speak("ë§ˆì´?¬ê? ?œì„±?”ë˜?ˆìŠµ?ˆë‹¤.");    } catch {      setError("ë§ˆì´??ê¶Œí•œ???„ìš”?©ë‹ˆ?? ì£¼ì†Œì°??¼ìª½ ?”’?ì„œ ?ˆìš©?¼ë¡œ ë³€ê²½í•˜?¸ìš”.");      speak("ë§ˆì´??ê¶Œí•œ???„ìš”?©ë‹ˆ??");    }  }  function stopMeter() {    try {      meterStopRef.current?.();    } catch {}    meterStopRef.current = null;    setMeterOn(false);    setMicLevel(0);    speak("ë§ˆì´?¬ê? ë¹„í™œ?±í™”?˜ì—ˆ?µë‹ˆ??");  }  // ?Œì„± ?£ê¸° (ë¸Œë¼?°ì? SR ì§ì ‘)  const doListen = (field: "name" | "email" | "pw") => {    if (listening) return;    setError(null);    setListening(true);    // TTS ?¼ë“œë°?    if (field === "name") {      speak("?´ë¦„??ë§ì???ì£¼ì„¸??");    } else if (field === "email") {      speak("?´ë©”?¼ì„ ë§ì???ì£¼ì„¸??");    } else {      speak("ë¹„ë?ë²ˆí˜¸ë¥?ë§ì???ì£¼ì„¸??");    }    try {      const SR = window.webkitSpeechRecognition || window.SpeechRecognition;      if (!SR) {        setListening(false);        setError("??ë¸Œë¼?°ì????Œì„± ?¸ì‹??ì§€?í•˜ì§€ ?ŠìŠµ?ˆë‹¤. Chrome/Edge ?¬ìš©??ê¶Œì¥?©ë‹ˆ??");        speak("??ë¸Œë¼?°ì????Œì„± ?¸ì‹??ì§€?í•˜ì§€ ?ŠìŠµ?ˆë‹¤.");        return;      }      // ë°˜ë“œ???¬ìš©???´ë¦­ ?¸ë“¤??ì»¨í…?¤íŠ¸?ì„œ ì¦‰ì‹œ ?ì„±/?œì‘ (await ê¸ˆì?)      const r: SRLike = new SR();      r.lang = safeLocale;      r.interimResults = true;      r.maxAlternatives = 2;      r.continuous = false;      let finalText = "";      let interimText = "";      r.onstart = () => log("??onstart");      r.onaudiostart = () => log("??onaudiostart");      r.onsoundstart = () => log("??onsoundstart");      r.onspeechstart = () => log("??onspeechstart");      r.onresult = (e: SpeechRecognitionEvent) => {        try {          for (let i = e.resultIndex; i < e.results.length; i++) {            const res = e.results[i];            const alt = res && res[0];            const t = (alt?.transcript || "").trim();            if (!t) continue;            if (res.isFinal) finalText = t;            else interimText = t;          }          log(`?¯ onresult: "${finalText || interimText}"`);        } catch {}      };      r.onerror = (e: any) => {        const code: SpeechRecognitionErrorCode = e?.error || "unknown";        log(`??onerror: ${code}`);        const errorMsg =           code === "not-allowed"            ? "ë§ˆì´??ê¶Œí•œ??ê±°ë??˜ì—ˆ?µë‹ˆ?? ì£¼ì†Œì°??¼ìª½ ?”’?ì„œ ?ˆìš©?¼ë¡œ ë³€ê²½í•˜?¸ìš”."            : code === "audio-capture"            ? "ë§ˆì´???¥ì¹˜ë¥?ì°¾ì„ ???†ìŠµ?ˆë‹¤. OS???…ë ¥ ?¥ì¹˜ë¥??•ì¸?˜ì„¸??"            : code === "no-speech"            ? "ë§ì†Œë¦¬ê? ê°ì??˜ì? ?Šì•˜?µë‹ˆ?? ì¡°ê¸ˆ ???¬ê²Œ ?ë ·?˜ê²Œ ë§ì???ì£¼ì„¸??"            : "?Œì„± ?¸ì‹ ?¤ë¥˜ê°€ ë°œìƒ?ˆìŠµ?ˆë‹¤. ?¤ì‹œ ?œë„??ì£¼ì„¸??";                setError(errorMsg);        speak(errorMsg);      };      r.onend = () => {        log("??onend");        setListening(false);        const text = (finalText || interimText || "").trim();        if (!text) {          speak("?Œì„±??ê°ì??˜ì? ?Šì•˜?µë‹ˆ?? ?¤ì‹œ ?œë„??ì£¼ì„¸??");          return;        }        if (field === "name") {          const cleaned = cleanName(text);          setName(cleaned);          speak(`?´ë¦„??${cleaned}ë¡??¤ì •?˜ì—ˆ?µë‹ˆ??`);        } else if (field === "email") {          const fixed = normalizeEmail(text);          setEmail(fixed);          if (!isValidEmail(fixed)) {            setError("?´ë©”???•ì‹???¬ë°”ë¥´ì? ?ŠìŠµ?ˆë‹¤. ?¤ì‹œ ë§ì???ì£¼ì„¸??");            speak("?´ë©”???•ì‹???¬ë°”ë¥´ì? ?ŠìŠµ?ˆë‹¤. ?¤ì‹œ ë§ì???ì£¼ì„¸??");          } else {            speak(`?´ë©”?¼ì´ ${fixed}ë¡??¤ì •?˜ì—ˆ?µë‹ˆ??`);          }        } else {          const val = text.replace(/\s+/g, "");          setPw(val);          if (!isStrongPassword(val)) {            setError("ë¹„ë?ë²ˆí˜¸??8???´ìƒ?´ì–´???©ë‹ˆ??");            speak("ë¹„ë?ë²ˆí˜¸??8???´ìƒ?´ì–´???©ë‹ˆ??");          } else {            speak("ë¹„ë?ë²ˆí˜¸ê°€ ?¤ì •?˜ì—ˆ?µë‹ˆ??");          }        }      };      r.start(); // ì¦‰ì‹œ ?œì‘      log(`?™ start(lang=${r.lang})`);    } catch (err: any) {      setListening(false);      setError(err?.message || "?Œì„± ?¸ì‹ ì´ˆê¸°???¤íŒ¨");      speak("?Œì„± ?¸ì‹ ì´ˆê¸°?”ì— ?¤íŒ¨?ˆìŠµ?ˆë‹¤.");    }  };  // ?¨ê³„ ê²€ì¦?  const stepValid =    (step === 0 && cleanName(name.trim()).length >= 2) ||    (step === 1 && isValidEmail(email.trim())) ||    (step === 2 && isStrongPassword(pw)) ||    step === 3;  const next = () => {    setStep((s) => (Math.min(3, s + 1) as Step));    if (step < 3) {      const nextStep = step + 1;      if (nextStep === 1) speak("?´ë¦„???•ì¸?˜ì—ˆ?µë‹ˆ?? ?´ë©”?¼ì„ ?…ë ¥??ì£¼ì„¸??");      else if (nextStep === 2) speak("?´ë©”?¼ì´ ?•ì¸?˜ì—ˆ?µë‹ˆ?? ë¹„ë?ë²ˆí˜¸ë¥??…ë ¥??ì£¼ì„¸??");      else if (nextStep === 3) speak("ëª¨ë“  ?•ë³´ê°€ ?…ë ¥?˜ì—ˆ?µë‹ˆ?? ?•ì¸ ??ê°€?…í•´ ì£¼ì„¸??");    }  };    const prev = () => {    setStep((s) => (Math.max(0, s - 1) as Step));    if (step > 0) {      const prevStep = step - 1;      if (prevStep === 0) speak("?´ë¦„ ?…ë ¥ ?¨ê³„ë¡??Œì•„ê°”ìŠµ?ˆë‹¤.");      else if (prevStep === 1) speak("?´ë©”???…ë ¥ ?¨ê³„ë¡??Œì•„ê°”ìŠµ?ˆë‹¤.");      else if (prevStep === 2) speak("ë¹„ë?ë²ˆí˜¸ ?…ë ¥ ?¨ê³„ë¡??Œì•„ê°”ìŠµ?ˆë‹¤.");    }  };  // Firebase Auth ?œì¶œ  async function submitAuth() {    setError(null);    setLoading(true);        try {      if (mode === "signup") {        // ?Œì›ê°€??        const userCredential = await signUpWithFirebase(email, pw);        speak(`?Œì›ê°€?…ì´ ?„ë£Œ?˜ì—ˆ?µë‹ˆ?? ?˜ì˜?©ë‹ˆ?? ${name}??`);        alert(`?‰ ?Œì›ê°€???„ë£Œ!\n?´ë¦„: ${name}\n?´ë©”?? ${email}\nUID: ${userCredential.user.uid}`);                // ?´ë¦„ ?…ë°?´íŠ¸ (? íƒ?¬í•­)        // await updateProfile(userCredential.user, { displayName: name });              } else {        // ë¡œê·¸??        const userCredential = await signInWithFirebase(email, pw);        speak(`ë¡œê·¸?¸ì´ ?„ë£Œ?˜ì—ˆ?µë‹ˆ?? ?˜ì˜?©ë‹ˆ?? ${userCredential.user.displayName || email}??`);        alert(`?” ë¡œê·¸???„ë£Œ!\n?´ë©”?? ${email}\nUID: ${userCredential.user.uid}`);      }            // TODO: ?¤ì œ ?¼ìš°??(?? ë©”ì¸ ?˜ì´ì§€ë¡??´ë™)      // navigate('/dashboard');          } catch (e: any) {      setError(e?.message || "?¸ì¦ ì¤??¤ë¥˜ê°€ ë°œìƒ?ˆìŠµ?ˆë‹¤.");      speak(e?.message || "?¸ì¦ ì¤??¤ë¥˜ê°€ ë°œìƒ?ˆìŠµ?ˆë‹¤.");    } finally {      setLoading(false);    }  }  // ëª¨ë“œ ?„í™˜  const toggleMode = () => {    const newMode = mode === "signup" ? "signin" : "signup";    setMode(newMode);    setStep(0);    setName("");    setEmail("");    setPw("");    setError(null);        if (newMode === "signup") {      speak("?Œì›ê°€??ëª¨ë“œë¡??„í™˜?˜ì—ˆ?µë‹ˆ??");    } else {      speak("ë¡œê·¸??ëª¨ë“œë¡??„í™˜?˜ì—ˆ?µë‹ˆ??");    }  };  // ---------------- UI ?¤í???----------------  const wrap: React.CSSProperties = {    maxWidth: 560,    margin: "32px auto",    padding: "0 16px",    fontFamily: "system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif",  };  const title: React.CSSProperties = { fontSize: 22, fontWeight: 800, margin: "12px 0 4px" };  const sub: React.CSSProperties = { color: "#64748b", marginBottom: 16 };  const row: React.CSSProperties = { display: "flex", gap: 8, alignItems: "center" };  const btn: React.CSSProperties = {    border: 0,    background: "#2563eb",    color: "#fff",    padding: "10px 14px",    borderRadius: 10,    cursor: "pointer",    fontWeight: 700,  };  const ghost: React.CSSProperties = {    border: "2px solid #e2e8f0",    background: "#fff",    color: "#334155",    padding: "8px 12px",    borderRadius: 10,    cursor: "pointer",    fontWeight: 700,  };  const input: React.CSSProperties = {    flex: 1,    border: "2px solid #e2e8f0",    borderRadius: 10,    padding: "10px 12px",    outline: "none",  };  const modeToggle: React.CSSProperties = {    ...ghost,    background: mode === "signup" ? "#10b981" : "#f59e0b",    color: "#fff",    borderColor: mode === "signup" ? "#10b981" : "#f59e0b",  };  return (    <div style={wrap}>      {/* HTTPS ?íƒœ ?œì‹œ */}      <div style={{         padding: "8px 12px",         background: checkHTTPS() ? "#dcfce7" : "#fef3c7",         color: checkHTTPS() ? "#166534" : "#92400e",        borderRadius: 8,        marginBottom: 16,        fontSize: 12,        textAlign: "center"      }}>        {checkHTTPS() ? "?”’ HTTPS ë³´ì•ˆ ?°ê²°" : "? ï¸ HTTP ?°ê²° (ë³´ì•ˆ ê¶Œì¥)"}      </div>      <h2 style={title}>        {mode === "signup" ? "?Œì„± ?Œì›ê°€?? : "?Œì„± ë¡œê·¸??}      </h2>            {/* ëª¨ë“œ ?„í™˜ ë²„íŠ¼ */}      <div style={{ marginBottom: 16 }}>        <button style={modeToggle} onClick={toggleMode}>          {mode === "signup" ? "?” ë¡œê·¸??ëª¨ë“œë¡??„í™˜" : "?“ ?Œì›ê°€??ëª¨ë“œë¡??„í™˜"}        </button>      </div>      <div style={sub}>        ?¸ì–´: {safeLocale}{" "}        <span style={{ marginLeft: 8 }}>          {meterOn ? (            <button style={ghost} onClick={stopMeter}>?”Œ ë¯¸í„° ì¢…ë£Œ</button>          ) : (            <button style={ghost} onClick={startMeter}>?”Š ë¯¸í„° ?œì‘</button>          )}        </span>      </div>      {/* ë§ˆì´???…ë ¥ ?ˆë²¨ ?œì‹œ */}      <div style={{ margin: "8px 0 16px" }}>        <div style={{ fontSize: 12, color: "#64748b", marginBottom: 4 }}>          ë§ˆì´???…ë ¥ ?ˆë²¨{" "}          {listening ? "?¤ ?Œì„± ?¸ì‹ ì¤? : meterOn ? (micLevel > 0.1 ? "?¤ ?…ë ¥ ê°ì?" : "???ê¸°ì¤‘") : "(êº¼ì§)"}        </div>        <div style={{ height: 8, background: "#e2e8f0", borderRadius: 6, overflow: "hidden" }}>          <div            style={{              height: "100%",              width: `${listening ? 100 : Math.round(micLevel * 100)}%`,              background: listening ? "#2563eb" : "#10b981",              transition: "width .08s",            }}          />        </div>      </div>      {/* ì§„í–‰ ë°?*/}      <div style={{ height: 8, background: "#e2e8f0", borderRadius: 6, overflow: "hidden", margin: "12px 0 24px" }}>        <div          style={{            height: "100%",            width: `${(step + 1) * 25}%`,            background: "#2563eb",            transition: "width .15s",          }}        />      </div>      {step === 0 && (        <section>          <h3 style={title}>1/4 ?´ë¦„ ë§í•˜ê¸?/h3>          <p style={sub}>?? "?´ë¦„?€ ?´ì¬ë§? / "ë°±ìŠ¹ê¶?</p>          <div style={row}>            <input              style={input}              aria-label="?´ë¦„"              placeholder="?´ë¦„"              value={name}              onChange={(e) => setName(e.target.value)}            />            <button              style={ghost}              onClick={() => doListen("name")}              disabled={listening}              title="?´ë¦„???Œì„±?¼ë¡œ ?…ë ¥"            >              {listening ? "?£ëŠ” ì¤?.." : "?™ ë§í•˜ê¸?}            </button>          </div>        </section>      )}      {step === 1 && (        <section>          <h3 style={title}>2/4 ?´ë©”??ë§í•˜ê¸?/h3>          <p style={sub}>?? "?´ë©”?¼ì? jaeman ê³¨ë±…??ì§€ë©”ì¼ ??ì»?</p>          <div style={row}>            <input              style={input}              aria-label="?´ë©”??              placeholder="?´ë©”??              value={email}              onChange={(e) => setEmail(e.target.value)}            />            <button              style={ghost}              onClick={() => doListen("email")}              disabled={listening}              title="?´ë©”?¼ì„ ?Œì„±?¼ë¡œ ?…ë ¥"            >              {listening ? "?£ëŠ” ì¤?.." : "?™ ë§í•˜ê¸?}            </button>          </div>          {!isValidEmail(email) && email && (            <div style={{ color: "#dc2626", marginTop: 8 }}>?¬ë°”ë¥??´ë©”???•ì‹???„ë‹™?ˆë‹¤.</div>          )}        </section>      )}      {step === 2 && (        <section>          <h3 style={title}>3/4 ë¹„ë?ë²ˆí˜¸ ë§í•˜ê¸?/h3>          <p style={sub}>8???´ìƒ ê¶Œì¥. (ê³µê°œ ?¥ì†Œ?ì„œ??ì§ì ‘ ?…ë ¥ ê¶Œì¥)</p>          <div style={row}>            <input              style={input}              type="password"              aria-label="ë¹„ë?ë²ˆí˜¸"              placeholder="ë¹„ë?ë²ˆí˜¸"              value={pw}              onChange={(e) => setPw(e.target.value)}            />            <button              style={ghost}              onClick={() => doListen("pw")}              disabled={listening}              title="ë¹„ë?ë²ˆí˜¸ë¥??Œì„±?¼ë¡œ ?…ë ¥"            >              {listening ? "?£ëŠ” ì¤?.." : "?™ ë§í•˜ê¸?}            </button>          </div>          {!isStrongPassword(pw) && pw && (            <div style={{ color: "#dc2626", marginTop: 8 }}>ë¹„ë?ë²ˆí˜¸??8???´ìƒ?´ì–´???©ë‹ˆ??</div>          )}        </section>      )}      {step === 3 && (        <section>          <h3 style={title}>4/4 ?•ì¸ ??{mode === "signup" ? "ê°€?? : "ë¡œê·¸??}</h3>          <ul style={{ lineHeight: 1.8, color: "#334155" }}>            <li><b>?´ë¦„</b>: {name || "-"}</li>            <li><b>?´ë©”??/b>: {email || "-"}</li>          </ul>          <p style={{ color: "#64748b" }}>??ë¹„ë?ë²ˆí˜¸??ë³´ì•ˆ???œì‹œ?˜ì? ?ŠìŠµ?ˆë‹¤.</p>        </section>      )}      {/* ?¤ë¥˜ */}      {error && <div style={{ color: "#dc2626", marginTop: 8 }}>{error}</div>}      {/* STT ë¡œê·¸ */}      <div        style={{          marginTop: 16,          padding: 12,          background: "#f8fafc",          borderRadius: 8,          border: "1px solid #e2e8f0",        }}      >        <div style={{ fontSize: 12, fontWeight: 600, color: "#475569", marginBottom: 8 }}>          ?¤ STT ë¡œê·¸:        </div>        <div          style={{            height: 120,            overflow: "auto",            fontSize: 11,            fontFamily: "monospace",            background: "#0f172a",            color: "#e2e8f0",            padding: 8,            borderRadius: 4,          }}        >          {srLog.length === 0 ? (            <span style={{ color: "#64748b" }}>?Œì„± ?¸ì‹???œì‘?˜ë©´ ë¡œê·¸ê°€ ?œì‹œ?©ë‹ˆ??..</span>          ) : (            srLog.map((msg, i) => <div key={i} style={{ marginBottom: 2 }}>{msg}</div>)          )}        </div>      </div>      {/* ?´ë¹„ê²Œì´??*/}      <div style={{ display: "flex", gap: 8, marginTop: 16 }}>        <button style={ghost} onClick={prev} disabled={step === 0}>          ?´ì „        </button>        {step < 3 ? (          <button            style={{ ...btn, opacity: stepValid ? 1 : 0.6 }}            onClick={next}            disabled={!stepValid}          >            ?¤ìŒ          </button>        ) : (          <button            style={{ ...btn, opacity: stepValid ? 1 : 0.6 }}            onClick={submitAuth}            disabled={!stepValid || loading}          >            {loading ? "ì²˜ë¦¬ ì¤?.." : mode === "signup" ? "ê°€?…í•˜ê¸? : "ë¡œê·¸??}          </button>        )}      </div>      {/* TTS ?ŒìŠ¤??ë²„íŠ¼ */}      <div style={{ marginTop: 16, textAlign: "center" }}>        <button           style={{ ...ghost, fontSize: 12, padding: "6px 10px" }}          onClick={() => speak("?Œì„± ?¼ë“œë°±ì´ ?•ìƒ ?‘ë™?˜ê³  ?ˆìŠµ?ˆë‹¤.")}        >          ?”Š TTS ?ŒìŠ¤??        </button>      </div>    </div>  );}