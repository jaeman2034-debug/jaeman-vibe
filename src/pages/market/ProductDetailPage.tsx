import React, { useState, useEffect } from 'react';import { useParams, useNavigate } from 'react-router-dom';import { doc, getDoc } from 'firebase/firestore';import { db } from '@/lib/firebase';import type { ProductDoc } from '@/types/product';import { getUid, LoginRequiredUI } from '@/lib/auth';import { FavoriteButton } from '@/components/favorite/FavoriteButton';import { StatusBadge } from '@/components/market/StatusBadge';import { DistanceBadge } from '@/components/market/DistanceBadge';import { LoadingSpinner } from '@/components/ui/LoadingSpinner';import { ErrorState } from '@/components/ui/ErrorState';export default function ProductDetailPage() {  const { id } = useParams<{ id: string }>();  const navigate = useNavigate();  const [product, setProduct] = useState<ProductDoc | null>(null);  const [loading, setLoading] = useState(true);  const [error, setError] = useState<string | null>(null);  const [currentImageIndex, setCurrentImageIndex] = useState(0);  const uid = getUid();  useEffect(() => {    if (!id) return;    const fetchProduct = async () => {      try {        setLoading(true);        const docRef = doc(db, 'products', id);        const docSnap = await getDoc(docRef);        if (docSnap.exists()) {          const data = docSnap.data() as ProductDoc;          setProduct({ id: docSnap.id, ...data });        } else {          setError('?í’ˆ??ì°¾ì„ ???†ìŠµ?ˆë‹¤.');        }      } catch (err: any) {        console.error('?í’ˆ ì¡°íšŒ ?¤íŒ¨:', err);        setError('?í’ˆ ì¡°íšŒ???¤íŒ¨?ˆìŠµ?ˆë‹¤: ' + err.message);      } finally {        setLoading(false);      }    };    fetchProduct();  }, [id]);  if (loading) {    return (      <div style={{ display: 'flex', justifyContent: 'center', alignItems: 'center', minHeight: '50vh' }}>        <LoadingSpinner />      </div>    );  }  if (error || !product) {    return <ErrorState message={error || '?í’ˆ??ì°¾ì„ ???†ìŠµ?ˆë‹¤.'} />;  }  const handleImageChange = (index: number) => {    setCurrentImageIndex(index);  };  const formatPrice = (price: number) => {    return price.toLocaleString('ko-KR') + '??;  };  const formatDate = (timestamp: any) => {    if (!timestamp) return '? ì§œ ?•ë³´ ?†ìŒ';    const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);    return date.toLocaleDateString('ko-KR');  };  return (    <div style={{ maxWidth: 1200, margin: '0 auto', padding: '20px' }}>      {/* ?¤ë” */}      <div style={{ marginBottom: '20px' }}>        <button          onClick={() => navigate(-1)}          style={{            background: 'none',            border: 'none',            fontSize: '16px',            cursor: 'pointer',            color: '#666',            display: 'flex',            alignItems: 'center',            gap: '8px'          }}        >          ???¤ë¡œê°€ê¸?        </button>      </div>      <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '40px' }}>        {/* ?´ë?ì§€ ?¹ì…˜ */}        <div>          {product.images && product.images.length > 0 ? (            <div>              {/* ë©”ì¸ ?´ë?ì§€ */}              <div style={{                 aspectRatio: '1',                 backgroundColor: '#f5f5f5',                 borderRadius: '12px',                overflow: 'hidden',                marginBottom: '16px'              }}>                <img                  src={product.images[currentImageIndex]}                  alt={product.title}                  style={{                    width: '100%',                    height: '100%',                    objectFit: 'cover'                  }}                />              </div>              {/* ?¸ë„¤???´ë?ì§€??*/}              {product.images.length > 1 && (                <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>                  {product.images.map((image, index) => (                    <button                      key={index}                      onClick={() => handleImageChange(index)}                      style={{                        width: '80px',                        height: '80px',                        border: index === currentImageIndex ? '3px solid #007bff' : '1px solid #ddd',                        borderRadius: '8px',                        overflow: 'hidden',                        cursor: 'pointer',                        background: 'none',                        padding: 0                      }}                    >                      <img                        src={image}                        alt={`${product.title} ${index + 1}`}                        style={{                          width: '100%',                          height: '100%',                          objectFit: 'cover'                        }}                      />                    </button>                  ))}                </div>              )}            </div>          ) : (            <div style={{              aspectRatio: '1',              backgroundColor: '#f5f5f5',              borderRadius: '12px',              display: 'flex',              alignItems: 'center',              justifyContent: 'center',              color: '#999'            }}>              ?´ë?ì§€ ?†ìŒ            </div>          )}        </div>        {/* ?í’ˆ ?•ë³´ ?¹ì…˜ */}        <div>          {/* ?í’ˆ ?íƒœ ë°?ì°œí•˜ê¸?*/}          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '20px' }}>            <StatusBadge status={product.status} size="lg" />            {uid && <FavoriteButton itemId={product.id} size="lg" />}          </div>          {/* ?í’ˆ ?œëª© */}          <h1 style={{             fontSize: '28px',             fontWeight: '700',             marginBottom: '16px',            lineHeight: '1.3'          }}>            {product.title}          </h1>          {/* ê°€ê²?*/}          <div style={{ marginBottom: '24px' }}>            <span style={{               fontSize: '32px',               fontWeight: '700',               color: '#007bff'            }}>              {formatPrice(product.price)}            </span>          </div>          {/* ?í’ˆ ?¤ëª… */}          {product.description && (            <div style={{ marginBottom: '24px' }}>              <h3 style={{ fontSize: '18px', fontWeight: '600', marginBottom: '12px' }}>?í’ˆ ?¤ëª…</h3>              <p style={{                 fontSize: '16px',                 lineHeight: '1.6',                 color: '#333',                whiteSpace: 'pre-wrap'              }}>                {product.description}              </p>            </div>          )}          {/* ?„ì¹˜ ?•ë³´ */}          {product.region && product.region.provider !== 'none' && (            <div style={{ marginBottom: '24px' }}>              <h3 style={{ fontSize: '18px', fontWeight: '600', marginBottom: '12px' }}>?„ì¹˜</h3>              <div style={{                 padding: '16px',                 backgroundColor: '#f8f9fa',                 borderRadius: '8px',                fontSize: '16px'              }}>                ?“ {product.region.full || `${product.region.si} ${product.region.gu} ${product.region.dong}`}              </div>            </div>          )}          {/* ?±ë¡ ?•ë³´ */}          <div style={{             padding: '16px',             backgroundColor: '#f8f9fa',             borderRadius: '8px',            fontSize: '14px',            color: '#666'          }}>            <div style={{ marginBottom: '8px' }}>              ?±ë¡?? {formatDate(product.createdAt)}            </div>            {product.updatedAt && product.updatedAt !== product.createdAt && (              <div>                ?˜ì •?? {formatDate(product.updatedAt)}              </div>            )}          </div>          {/* ?ë§¤???°ë½ ë²„íŠ¼ */}          {uid && uid !== product.sellerId && (            <div style={{ marginTop: '24px' }}>              <button                style={{                  width: '100%',                  padding: '16px',                  backgroundColor: '#007bff',                  color: 'white',                  border: 'none',                  borderRadius: '8px',                  fontSize: '16px',                  fontWeight: '600',                  cursor: 'pointer'                }}                onClick={() => alert('?°ë½ ê¸°ëŠ¥?€ ì¶”í›„ êµ¬í˜„ ?ˆì •?…ë‹ˆ??')}              >                ?ë§¤?ì—ê²??°ë½?˜ê¸°              </button>            </div>          )}        </div>      </div>    </div>  );} 
