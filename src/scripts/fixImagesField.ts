import { collection, getDocs, updateDoc, doc } from "firebase/firestore";import { db } from "@/lib/firebase";/** * ?ï¿½ì‹œ ?ï¿½í¬ë¦½íŠ¸: marketï¿?products ì»¬ë ‰?ï¿½ì˜ images ?ï¿½ë“œ êµ¬ì¡° ?ï¿½ë¦¬ *  * ?ï¿½ìš©ï¿? * 1. ???ï¿½ì¼??ë¸Œë¼?ï¿½ï¿½? ì½˜ì†”?ï¿½ì„œ ?ï¿½í–‰ * 2. ?ï¿½ëŠ” ê°œë°œ ì¤‘ì— ?ï¿½ì‹œï¿??ï¿½ì´ì§€???ï¿½í•¨ *  * ì£¼ì˜: ?ï¿½ë¡œ?ï¿½ì…˜?ï¿½ì„œ???ï¿½ìš©?ï¿½ï¿½? ë§ˆì„¸?? */// ê¸°ì¡´ ?ï¿½ìˆ˜ (?ï¿½ì„¸??ë¡œê¹… ?ï¿½í•¨)export async function fixImagesField() {  try {    console.log("?ï¿½ï¿½ images ?ï¿½ë“œ êµ¬ì¡° ?ï¿½ë¦¬ ?ï¿½ì‘...");        let totalFixed = 0;        // 1. market ì»¬ë ‰???ï¿½ë¦¬    console.log("?ï¿½ï¿½ market ì»¬ë ‰???ï¿½ë¦¬ ï¿?..");    const marketSnap = await getDocs(collection(db, "market"));    let marketFixed = 0;        for (const d of marketSnap.docs) {      const data = d.data() as any;            // imagesê°€ ê°ì²´(map)??ê²½ìš°ï¿??ï¿½ì •      if (data.images && !Array.isArray(data.images)) {        console.log(`?ï¿½ï¿½ market ë¬¸ì„œ ${d.id} ?ï¿½ì •:`, data.images);                // images ?ï¿½ì— ?ï¿½ì–´ê°€ ?ï¿½ë˜ ?ï¿½ëª»???ï¿½ë“œ?ï¿½ì„ ?ï¿½ìœ„ï¿??ï¿½ë¦¬ï¿? images??ï¿?ë°°ì—´ï¿?ì´ˆê¸°??        const { images, ...rest } = data;        const correctedData = { ...images, ...rest, images: [] };                await updateDoc(doc(db, "market", d.id), correctedData);                marketFixed++;      }    }        console.log(`??market ì»¬ë ‰???ï¿½ë¦¬ ?ï¿½ë£Œ! ${marketFixed}ï¿?ë¬¸ì„œ ?ï¿½ì •??);        // 2. products ì»¬ë ‰???ï¿½ë¦¬    console.log("?ï¿½ï¿½ products ì»¬ë ‰???ï¿½ë¦¬ ï¿?..");    const productsSnap = await getDocs(collection(db, "products"));    let productsFixed = 0;        for (const d of productsSnap.docs) {      const data = d.data() as any;            // imagesê°€ ê°ì²´(map)??ê²½ìš°ï¿??ï¿½ì •      if (data.images && !Array.isArray(data.images)) {        console.log(`?ï¿½ï¿½ products ë¬¸ì„œ ${d.id} ?ï¿½ì •:`, data.images);                // images ?ï¿½ì— ?ï¿½ì–´ê°€ ?ï¿½ë˜ ?ï¿½ëª»???ï¿½ë“œ?ï¿½ì„ ?ï¿½ìœ„ï¿??ï¿½ë¦¬ï¿? images??ï¿?ë°°ì—´ï¿?ì´ˆê¸°??        const { images, ...rest } = data;        const correctedData = { ...images, ...rest, images: [] };                await updateDoc(doc(db, "products", d.id), correctedData);                productsFixed++;      }    }        console.log(`??products ì»¬ë ‰???ï¿½ë¦¬ ?ï¿½ë£Œ! ${productsFixed}ï¿?ë¬¸ì„œ ?ï¿½ì •??);        totalFixed = marketFixed + productsFixed;    console.log(`?ï¿½ï¿½ ?ï¿½ì²´ ?ï¿½ë¦¬ ?ï¿½ë£Œ! ï¿?${totalFixed}ï¿?ë¬¸ì„œ ?ï¿½ì •??);    alert(`images ?ï¿½ë“œ êµ¬ì¡° ?ï¿½ë¦¬ ?ï¿½ë£Œ!\n\nmarket: ${marketFixed}ï¿?nproducts: ${productsFixed}ï¿?nï¿?${totalFixed}ï¿?ë¬¸ì„œê°€ ?ï¿½ì •?ï¿½ì—ˆ?ï¿½ë‹ˆ??`);        return totalFixed;  } catch (error) {    console.error("???ï¿½ë¦¬ ï¿??ï¿½ë¥˜ ë°œìƒ:", error);    alert("?ï¿½ë¦¬ ï¿??ï¿½ë¥˜ê°€ ë°œìƒ?ï¿½ìŠµ?ï¿½ë‹¤: " + error);    throw error;  }}// ê°•ë ¥???ï¿½ê´„ ?ï¿½ì • ?ï¿½ìˆ˜ (???ï¿½ìœ¨??export async function fixImagesFieldForce() {  try {    console.log("?? ê°•ë ¥??images ?ï¿½ë“œ êµ¬ì¡° ?ï¿½ë¦¬ ?ï¿½ì‘...");        let totalChanged = 0;        // 1. market ì»¬ë ‰???ï¿½ë¦¬    console.log("?ï¿½ï¿½ market ì»¬ë ‰???ï¿½ë¦¬ ï¿?..");    const marketSnap = await getDocs(collection(db, "market"));    let marketChanged = 0;        for (const d of marketSnap.docs) {      const data = d.data();      // imagesê°€ ë°°ì—´???ï¿½ë‹ˆï¿?ê°ì²´(map)??ê²½ìš°ï¿??ï¿½ì •      if (data.images && !Array.isArray(data.images) && typeof data.images === "object") {        const { images, ...rest } = data;        await updateDoc(doc(db, "market", d.id), {          ...images,          // lat/lng/price/title ?ï¿½ì„ ?ï¿½ìœ„ï¿??ï¿½ê²©          ...rest,          images: Array.isArray(images) ? images : [], // URL ë°°ì—´(ì§€ê¸ˆï¿½? ë¹„ì–´?ï¿½ì„ ???ï¿½ìŒ)        });        marketChanged++;        console.log(`??market ë¬¸ì„œ ${d.id} ?ï¿½ì •??);      }    }        console.log(`??market ì»¬ë ‰???ï¿½ë¦¬ ?ï¿½ë£Œ! ${marketChanged}ï¿?ë¬¸ì„œ ?ï¿½ì •??);        // 2. products ì»¬ë ‰???ï¿½ë¦¬    console.log("?ï¿½ï¿½ products ì»¬ë ‰???ï¿½ë¦¬ ï¿?..");    const productsSnap = await getDocs(collection(db, "products"));    let productsChanged = 0;        for (const d of productsSnap.docs) {      const data = d.data();      // imagesê°€ ë°°ì—´???ï¿½ë‹ˆï¿?ê°ì²´(map)??ê²½ìš°ï¿??ï¿½ì •      if (data.images && !Array.isArray(data.images) && typeof data.images === "object") {        const { images, ...rest } = data;        await updateDoc(doc(db, "products", d.id), {          ...images,          // lat/lng/price/title ?ï¿½ì„ ?ï¿½ìœ„ï¿??ï¿½ê²©          ...rest,          images: Array.isArray(images) ? images : [], // URL ë°°ì—´(ì§€ê¸ˆï¿½? ë¹„ì–´?ï¿½ì„ ???ï¿½ìŒ)        });        productsChanged++;        console.log(`??products ë¬¸ì„œ ${d.id} ?ï¿½ì •??);      }    }        console.log(`??products ì»¬ë ‰???ï¿½ë¦¬ ?ï¿½ë£Œ! ${productsChanged}ï¿?ë¬¸ì„œ ?ï¿½ì •??);        totalChanged = marketChanged + productsChanged;    console.log(`?ï¿½ï¿½ ê°•ë ¥???ï¿½ë¦¬ ?ï¿½ë£Œ! ï¿?${totalChanged}ï¿?ë¬¸ì„œ ?ï¿½ì •??);    alert(`images ?ï¿½ë“œ êµ¬ì¡° ?ï¿½ë¦¬ ?ï¿½ë£Œ!\n\nmarket: ${marketChanged}ï¿?nproducts: ${productsChanged}ï¿?nï¿?${totalChanged}ï¿?ë¬¸ì„œê°€ ?ï¿½ì •?ï¿½ì—ˆ?ï¿½ë‹ˆ??`);        return totalChanged;  } catch (error) {    console.error("??ê°•ë ¥???ï¿½ë¦¬ ï¿??ï¿½ë¥˜ ë°œìƒ:", error);    alert("ê°•ë ¥???ï¿½ë¦¬ ï¿??ï¿½ë¥˜ê°€ ë°œìƒ?ï¿½ìŠµ?ï¿½ë‹¤: " + error);    throw error;  }}// ë¸Œë¼?ï¿½ï¿½? ì½˜ì†”?ï¿½ì„œ ì§ì ‘ ?ï¿½í–‰?????ï¿½ë„ï¿??ï¿½ì—­ ?ï¿½ìˆ˜ï¿??ï¿½ë¡if (typeof window !== 'undefined') {  (window as any).fixImagesField = fixImagesField;  (window as any).fixImagesFieldForce = fixImagesFieldForce;  console.log("?ï¿½ï¿½ fixImagesField() ?ï¿½ìˆ˜ê°€ ?ï¿½ì—­???ï¿½ë¡?ï¿½ì—ˆ?ï¿½ë‹ˆ??");  console.log("?? fixImagesFieldForce() ?ï¿½ìˆ˜ê°€ ?ï¿½ì—­???ï¿½ë¡?ï¿½ì—ˆ?ï¿½ë‹ˆ??");  console.log("ë¸Œë¼?ï¿½ï¿½? ì½˜ì†”?ï¿½ì„œ fixImagesField() ?ï¿½ëŠ” fixImagesFieldForce()ï¿??ï¿½í–‰?ï¿½ì„¸??");}
