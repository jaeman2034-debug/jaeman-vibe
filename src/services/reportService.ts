import { addDoc, collection, doc, getDoc, setDoc, serverTimestamp, updateDoc } from 'firebase/firestore';import { auth, db } from '@/lib/firebase';export interface Report {  id?: string;  reporterId: string;  targetId: string;  reason: string;  context?: string;  createdAt?: any;}export const REPORT_REASONS = [  '?¤íŒ¸/ê´‘ê³ ',  'ë¶€?ì ˆ???¸ì–´',  '?¬ê¸°/?¬ì¹­',  '?? ¥/?„í˜‘',  '?±ì  ì½˜í…ì¸?,  'ê¸°í?'];// ?¬ìš©??? ê³ export async function reportUser(targetId: string, reason: string, context?: string) {  const user = auth.currentUser;  if (!user) throw new Error('ë¡œê·¸?¸ì´ ?„ìš”?©ë‹ˆ??');  if (user.uid === targetId) throw new Error('?ì‹ ??? ê³ ?????†ìŠµ?ˆë‹¤.');  try {    const reportRef = collection(db, 'reports');    await addDoc(reportRef, {      reporterId: user.uid,      targetId,      reason,      context: context?.trim() || '',      createdAt: serverTimestamp(),    });    return true;  } catch (error) {    console.error('? ê³  ?¤íŒ¨:', error);    throw new Error('? ê³  ì²˜ë¦¬???¤íŒ¨?ˆìŠµ?ˆë‹¤.');  }}// ?¬ìš©??ì°¨ë‹¨export async function blockUser(targetId: string) {  const user = auth.currentUser;  if (!user) throw new Error('ë¡œê·¸?¸ì´ ?„ìš”?©ë‹ˆ??');  if (user.uid === targetId) throw new Error('?ì‹ ??ì°¨ë‹¨?????†ìŠµ?ˆë‹¤.');  try {    const profileRef = doc(db, 'profiles', user.uid);    const profileSnap = await getDoc(profileRef);    if (profileSnap.exists()) {      const currentBlocked = profileSnap.data().blocked || {};      currentBlocked[targetId] = true;      await updateDoc(profileRef, {        blocked: currentBlocked,        updatedAt: serverTimestamp()      });    } else {      // ?„ë¡œ?„ì´ ?†ìœ¼ë©??ˆë¡œ ?ì„±      await setDoc(profileRef, {        blocked: { [targetId]: true },        createdAt: serverTimestamp(),        updatedAt: serverTimestamp()      }, { merge: true });    }    return true;  } catch (error) {    console.error('?¬ìš©??ì°¨ë‹¨ ?¤íŒ¨:', error);    throw new Error('?¬ìš©??ì°¨ë‹¨???¤íŒ¨?ˆìŠµ?ˆë‹¤.');  }}// ?¬ìš©??ì°¨ë‹¨ ?´ì œexport async function unblockUser(targetId: string) {  const user = auth.currentUser;  if (!user) throw new Error('ë¡œê·¸?¸ì´ ?„ìš”?©ë‹ˆ??');  try {    const profileRef = doc(db, 'profiles', user.uid);    const profileSnap = await getDoc(profileRef);    if (profileSnap.exists()) {      const currentBlocked = profileSnap.data().blocked || {};      delete currentBlocked[targetId];      await updateDoc(profileRef, {        blocked: currentBlocked,        updatedAt: serverTimestamp()      });    }    return true;  } catch (error) {    console.error('?¬ìš©??ì°¨ë‹¨ ?´ì œ ?¤íŒ¨:', error);    throw new Error('?¬ìš©??ì°¨ë‹¨ ?´ì œ???¤íŒ¨?ˆìŠµ?ˆë‹¤.');  }}// ì°¨ë‹¨???¬ìš©??ëª©ë¡ ì¡°íšŒexport async function getBlockedUsers(): Promise<string[]> {  const user = auth.currentUser;  if (!user) return [];  try {    const profileRef = doc(db, 'profiles', user.uid);    const profileSnap = await getDoc(profileRef);    if (profileSnap.exists()) {      const blocked = profileSnap.data().blocked || {};      return Object.keys(blocked).filter(uid => blocked[uid] === true);    }    return [];  } catch (error) {    console.error('ì°¨ë‹¨???¬ìš©??ëª©ë¡ ì¡°íšŒ ?¤íŒ¨:', error);    return [];  }}// ?¬ìš©?ê? ì°¨ë‹¨?˜ì—ˆ?”ì? ?•ì¸export async function isUserBlocked(targetId: string): Promise<boolean> {  const user = auth.currentUser;  if (!user) return false;  try {    const profileRef = doc(db, 'profiles', user.uid);    const profileSnap = await getDoc(profileRef);    if (profileSnap.exists()) {      const blocked = profileSnap.data().blocked || {};      return blocked[targetId] === true;    }    return false;  } catch (error) {    console.error('?¬ìš©??ì°¨ë‹¨ ?íƒœ ?•ì¸ ?¤íŒ¨:', error);    return false;  }}