import { auth, storage } from "@/lib/firebase";import { ref, uploadBytesResumable, getDownloadURL } from "firebase/storage";import { v4 as uuid } from "uuid";// ???…ë¡œ?œëœ ?´ë?ì§€ ?€???•ì˜export type UploadedImage = {   url: string;   path: string;   filename: string;  size: number;  type: string;};// ???¨ì¼ ?´ë?ì§€ ?…ë¡œ??(Resumable ?¬ìš©)export async function uploadProductImage(file: File): Promise<UploadedImage> {  const uid = auth.currentUser?.uid;  if (!uid) throw new Error("ë¡œê·¸?¸ì´ ?„ìš”?©ë‹ˆ??");  // ??UUID ê¸°ë°˜ ê³ ìœ  ê²½ë¡œ ?ì„± (market/ ?´ë” ?¬ìš©)  const id = uuid();  const clean = file.name.replace(/[^\w.\-]+/g, "_");  const ext = (file.name.split(".").pop() || "jpg").toLowerCase();  const path = `market/${id}-${clean}`;  const r = ref(storage, path);  try {    // ??uploadBytesResumable ?¬ìš© (CORS ë¬¸ì œ ?†ìŒ, ì§„í–‰ë¥?ì¶”ì  ê°€??    const snap = await uploadBytesResumable(r, file, {      contentType: file.type || "image/jpeg",      cacheControl: "public,max-age=31536000,immutable",    });        // ??ê³µê°œ URL ?ë“ (? í° ?¬í•¨)    const url = await getDownloadURL(snap.ref);        console.log(`[?…ë¡œ?? ${file.name} ?„ë£Œ: ${path}`);        return {       url,       path,      filename: file.name,      size: file.size,      type: file.type || "image/jpeg"    };  } catch (error) {    console.error(`[?…ë¡œ?? ${file.name} ?¤íŒ¨:`, error);    throw new Error(`?Œì¼ ${file.name} ?…ë¡œ???¤íŒ¨: ${error}`);  }}// ???¤ì¤‘ ?´ë?ì§€ ?…ë¡œ??(ê¸°ì¡´ ?¸í™˜??? ì?)export async function uploadProductImages(  files: FileList,   onProgress?: (current: number, total: number, fileName: string) => void): Promise<UploadedImage[]> {  if (!files || files.length === 0) return [];    const uploadedImages: UploadedImage[] = [];    for (let i = 0; i < files.length; i++) {    const file = files[i];    try {      // ??ì§„í–‰ ?í™© ì½œë°± ?¸ì¶œ      onProgress?.(i + 1, files.length, file.name);            // ???¨ì¼ ?´ë?ì§€ ?…ë¡œ???¨ìˆ˜ ?¬ìš©      const uploadedImage = await uploadProductImage(file);      uploadedImages.push(uploadedImage);          } catch (error) {      console.error(`[?…ë¡œ?? ${file.name} ?¤íŒ¨:`, error);      throw new Error(`?Œì¼ ${file.name} ?…ë¡œ???¤íŒ¨: ${error}`);    }  }    return uploadedImages;}
