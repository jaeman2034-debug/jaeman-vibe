// Í∏∞Ï°¥ ?ÅÌíà Î¨∏ÏÑú??sellerId ?ÑÎìú Î∞±ÌïÑ ?†Ìã∏Î¶¨Ìã∞import { collection, getDocs, updateDoc, doc, serverTimestamp } from 'firebase/firestore';import { db } from '@/lib/firebase';function pickSellerIdFromDoc(p: any) {  return p?.sellerId ?? p?.seller?.uid ?? p?.ownerId ?? p?.createdBy ?? p?.uid;}export async function backfillSellerId() {  console.log('[BACKFILL] sellerId Î∞±ÌïÑ ?úÏûë...');    try {    const snap = await getDocs(collection(db, 'products'));    console.log(`[BACKFILL] Ï¥?${snap.docs.length}Í∞?Î¨∏ÏÑú Î∞úÍ≤¨`);        let fixed = 0;    let skipped = 0;        for (const d of snap.docs) {      const p = d.data();            if (!p?.sellerId) {        const sid = pickSellerIdFromDoc(p);        if (sid) {          console.log(`[BACKFILL] Î¨∏ÏÑú ${d.id} ?òÏ†ï: sellerId = ${sid}`);                    await updateDoc(doc(db, 'products', d.id), {            sellerId: sid,            updatedAt: serverTimestamp()          });                    fixed++;          await new Promise(r => setTimeout(r, 100)); // Í≥ºÏÜç Î∞©Ï? (100ms)        } else {          console.warn(`[BACKFILL] Î¨∏ÏÑú ${d.id}: sellerIdÎ•?Ï∞æÏùÑ ???ÜÏùå`, p);          skipped++;        }      } else {        console.log(`[BACKFILL] Î¨∏ÏÑú ${d.id}: ?¥Î? sellerId Ï°¥Ïû¨ (${p.sellerId})`);      }    }        console.log(`[BACKFILL] ?ÑÎ£å! ?òÏ†ï: ${fixed}, Í±¥ÎÑà?Ä: ${skipped}`);    return { fixed, skipped, total: snap.docs.length };      } catch (error) {    console.error('[BACKFILL] Î∞±ÌïÑ ?§Ìå®:', error);    throw error;  }}// market Ïª¨Î†â?òÎèÑ ?®Íªò Î∞±ÌïÑ (backward compatibility)export async function backfillMarketSellerId() {  console.log('[BACKFILL] market Ïª¨Î†â??sellerId Î∞±ÌïÑ ?úÏûë...');    try {    const snap = await getDocs(collection(db, 'market'));    console.log(`[BACKFILL] market Ïª¨Î†â??Ï¥?${snap.docs.length}Í∞?Î¨∏ÏÑú Î∞úÍ≤¨`);        let fixed = 0;    let skipped = 0;        for (const d of snap.docs) {      const p = d.data();            if (!p?.sellerId) {        const sid = pickSellerIdFromDoc(p);        if (sid) {          console.log(`[BACKFILL] market Î¨∏ÏÑú ${d.id} ?òÏ†ï: sellerId = ${sid}`);                    await updateDoc(doc(db, 'market', d.id), {            sellerId: sid,            updatedAt: serverTimestamp()          });                    fixed++;          await new Promise(r => setTimeout(r, 100)); // Í≥ºÏÜç Î∞©Ï? (100ms)        } else {          console.warn(`[BACKFILL] market Î¨∏ÏÑú ${d.id}: sellerIdÎ•?Ï∞æÏùÑ ???ÜÏùå`, p);          skipped++;        }      } else {        console.log(`[BACKFILL] market Î¨∏ÏÑú ${d.id}: ?¥Î? sellerId Ï°¥Ïû¨ (${p.sellerId})`);      }    }        console.log(`[BACKFILL] market ?ÑÎ£å! ?òÏ†ï: ${fixed}, Í±¥ÎÑà?Ä: ${skipped}`);    return { fixed, skipped, total: snap.docs.length };      } catch (error) {    console.error('[BACKFILL] market Î∞±ÌïÑ ?§Ìå®:', error);    throw error;  }}// ?ÑÏ≤¥ Î∞±ÌïÑ ?§Ìñâexport async function backfillAllSellerId() {  console.log('[BACKFILL] ?ÑÏ≤¥ sellerId Î∞±ÌïÑ ?úÏûë...');    const productsResult = await backfillSellerId();  const marketResult = await backfillMarketSellerId();    const totalFixed = productsResult.fixed + marketResult.fixed;  const totalSkipped = productsResult.skipped + marketResult.skipped;  const totalDocs = productsResult.total + marketResult.total;    console.log(`[BACKFILL] ?ÑÏ≤¥ ?ÑÎ£å! Ï¥??òÏ†ï: ${totalFixed}, Ï¥?Í±¥ÎÑà?Ä: ${totalSkipped}, Ï¥?Î¨∏ÏÑú: ${totalDocs}`);    return {    products: productsResult,    market: marketResult,    total: { fixed: totalFixed, skipped: totalSkipped, docs: totalDocs }  };}