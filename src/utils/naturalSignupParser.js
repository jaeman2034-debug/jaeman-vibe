"use strict";
// ==== Natural Signup Parser (drop-in) ====// ?�자 ?�국?????�자const DIGIT_KO: Record<string, string> = {  "??:"0","�?:"0","�?:"0",  "??:"1","??:"2","??:"2","??:"3","??:"4","??:"5","??:"6","�?:"6","�?:"7","??:"8","�?:"9",};const DIGIT_TOKENS = Object.keys(DIGIT_KO).sort((a,b)=>b.length-a.length);// ?�파�??�국???�펠�?간단 버전)const ALPHA_KO: Record<string, string> = {  "?�이":"a","�?:"b","??:"c","??:"d","??:"e","?�프":"f","지":"g","?�이�?:"h","?�이":"i",  "?�이":"j","케??:"k","??:"l","??:"m","??:"n","??:"o","??:"p","??:"q","?�르":"r",  "?�스":"s","??:"t","??:"u","브이":"v","?�블??:"w","?�스":"x","?�??:"y","?�트":"z","지??:"z",};// ?�메???�공??최상?�도메인 ?��? ???�문const PROVIDER_KO: Record<string,string> = {  "지메일":"gmail","g메일":"gmail","g 메일":"gmail","gmail":"gmail",  "?�이�?:"naver","?�음":"daum","?�메??:"hanmail","카카??:"kakao","카카?�메??:"kakao",};const TLD_KO: Record<string,string> = {  "�?:"com","�?:"com","컴마":"com","컴퓨??:"com","??:"net","?�트":"net",};// 구두????기호const SYM_RULES: Array<[RegExp,string]> = [  [/(골뱅????\bat\b)/g, " @ "],  [/(????�?/g, " . "],];// 공백 ?�리const squish = (s:string) => s.replace(/\s+/g," ").trim();// ?�국???�자/?�파 ?�펠링을 ???�자�?바꾸??가벼운 ?�규??function koTokensToAscii(s: string) {  let out = s;  // ?�볼 치환  for (const [re,rep] of SYM_RULES) out = out.replace(re, rep);  // ?�큰 ?�위 치환  out = out.split(/\s+/).map(t=>{    if (ALPHA_KO[t]) return ALPHA_KO[t];    if (DIGIT_KO[t]) return DIGIT_KO[t];    return t;  }).join(" ");  return out;}// ?�화 추출: 01x�??�작?�는 10~11?�리 ?�선function extractPhone(raw: string): string {  // ?�국???�자 ?�어�??�자�?바꾼 ??모두 ?�자�??��?  const ko = raw.replace(new RegExp(DIGIT_TOKENS.join("|"),"g"), (m)=>DIGIT_KO[m] ?? m);  const onlyDigits = ko.replace(/[^\d]/g,"");  // ?�보: 010 ~ 019 �??�작, 10~11?�리  const candidates: string[] = [];  for (let i=0;i<onlyDigits.length-9;i++){    for (let len of [11,10]){      const sub = onlyDigits.slice(i,i+len);      if (/^01\d/.test(sub) && (len===10 || len===11)) candidates.push(sub);    }  }  // 가???�에???�힌 �??�선 반환  const picked = candidates[0] || "";  return picked ? picked.replace(/(\d{3})(\d{3,4})(\d{4})/, "$1-$2-$3") : "";}// ?�메??추출(관?�어 ?�용: "?�이??골뱅??지메일 ??�? / "id gmail com" ??function extractEmail(rawInput: string): string {  let s = rawInput.toLowerCase();  s = koTokensToAscii(s);  s = squish(s);  // ?�공???�메???��? ???�문  Object.entries(PROVIDER_KO).forEach(([k,v])=>{    s = s.replace(new RegExp(`\\b${k}\\b`, "g"), ` ${v} `);  });  Object.entries(TLD_KO).forEach(([k,v])=>{    s = s.replace(new RegExp(`\\b${k}\\b`, "g"), ` ${v} `);  });  // ?�한 ?�인???�소 ?�거  s = s.replace(/\b(처럼|그리�??�니???�에???�메?��?|?�메?��????�메?�이|메일?�|주소???�름?�|?�화번호??번호??\b/g, " ");  s = squish(s);  // 1) ?��? ?�성???�메?�이 ?�으�?그�?�??�용  const emailRe = /([a-z0-9._%+-]{1,64})@([a-z0-9-]{1,63})\.([a-z.]{2,10})/i;  const m = s.match(emailRe);  if (m) return `${m[1]}@${m[2]}.${m[3]}`;  // 2) ?�큰??보면??i d / @ / provider / tld 조합 ?�구??  const tokens = s.split(/\s+/);  let id = "", hasAt = false, domLeft = "", tld = "";  for (let i=0;i<tokens.length;i++){    const tk = tokens[i];    if (tk === "@") { hasAt = true; continue; }    if (tk === ".") { /* skip lone dots */ continue; }    // provider ?�는 tld    if (["gmail","naver","daum","hanmail","kakao"].includes(tk)) {      domLeft = tk; continue;    }    if (["com","net","co.kr","kr"].includes(tk)) { tld = tk; continue; }    // ?�파?�만 id???�적    if (/^[a-z0-9._-]+$/.test(tk)) {      if (!hasAt) id += tk;      else if (!domLeft) domLeft = tk; // '@' ?�후?�면 ?�메???�쪽      else if (!tld) tld = tk;         // ?�시 'gmail com' 같이 ?�속    }  }  // ?�적 조합  if (id && (hasAt || domLeft)) {    const dom = domLeft ? `${domLeft}.${tld || "com"}` : "";    const email = `${id}@${dom}`.replace(/\.+/g,".").replace(/@\./,"@");    if (/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(email)) return email;  }  return ""; // �?찾으�?�?�?}// ?�름 추출(가??�?'?��?�? 2~6??구간)function extractName(raw: string): string {  const hangulChunks = raw.replace(/[^가-??s]/g," ").split(/\s+/).filter(Boolean);  // ?��? ?�어 보이??2~6?? ?�보 �?가??�?것을 ?�택  const cands = hangulChunks.filter(w => w.length >= 2 && w.length <= 6);  // "???�름?� ?? ?�턴 ?�선  const m = raw.match(/(??s*?�름?�|?�??\s*([가-??{2,6})/);  if (m) return m[2];  if (cands.length) return cands.sort((a,b)=>b.length-a.length)[0];  return "";}// 비�?번호 추출("비�?번호???? ?�쪽 ?�파??기호 8+ ?�선)function extractPassword(raw:string): string {  const after = raw.split(/비�?번호(???�요)?/)[2] || "";  if (after) {    const t = koTokensToAscii(after.toLowerCase()).replace(/\s+/g,"");    const m = t.match(/[a-z0-9!@#$%^&*()_+\-=\[\]{};':",.<>/?]{8,}/i);    if (m) return m[0].slice(0,32); // ?�전?�게 32???�한  }  // �?찾으�?비워??  return "";}export function parseNaturalSignup(raw: string) {  const text = squish(raw || "");  const name  = extractName(text);  const email = extractEmail(text);  const phone = extractPhone(text);  const password = extractPassword(text);  return { name, email, phone, password };} 
