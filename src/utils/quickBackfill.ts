// ë¹ ë¥¸ ë°±í•„ ? í‹¸ë¦¬í‹° (?…ì„œ??ë²„ì „)import {  doc, getDoc, setDoc, updateDoc, serverTimestamp, deleteDoc} from 'firebase/firestore';import { db, auth } from '@/lib/firebase';// ??ê±´ë§Œ ë³´ì • (?…ì„œ?? products???†ìœ¼ë©?market?ì„œ ê°€?¸ì????ì„±)export async function setMyselfAsSeller(productId: string) {  const uid = auth.currentUser?.uid;  if (!uid) throw new Error("ë¡œê·¸?¸ì´ ?„ìš”?©ë‹ˆ??");  if (!productId) throw new Error("?í’ˆ IDê°€ ë¹„ì–´ ?ˆìŠµ?ˆë‹¤.");  const pRef = doc(db, "products", productId);  const pSnap = await getDoc(pRef);  if (pSnap.exists()) {    // ???´ë? products???ˆìœ¼ë©??…ë°?´íŠ¸ë§?    await updateDoc(pRef, {      sellerId: uid,      updatedAt: serverTimestamp(),    });    console.log("??products ë¬¸ì„œ??sellerId ?¤ì • ?„ë£Œ:", productId);    return;  }  // â¬‡ï¸ products???†ìœ¼ë©?market?ì„œ ê°€?¸ì???ë§ˆì´ê·¸ë ˆ?´ì…˜ + sellerId ì§€??  const mRef = doc(db, "market", productId);  const mSnap = await getDoc(mRef);  if (!mSnap.exists()) {    // market?ë„ ?†ìœ¼ë©?ìµœì†Œ ë¬¸ì„œ?¼ë„ ?ì„±    await setDoc(pRef, {      sellerId: uid,      status: "?ë§¤ì¤?,      title: "",      price: 0,      createdAt: serverTimestamp(),      updatedAt: serverTimestamp(),      migratedFrom: "manual-empty",    });    console.log("? ï¸ market???ë³¸???†ì–´ ìµœì†Œ ?„ë“œë¡??ì„±?ˆìŠµ?ˆë‹¤:", productId);    return;  }  const d = mSnap.data() as any;  // ?„ìš” ?„ë“œë§??´ê?(?†ëŠ” ê±?ê¸°ë³¸ê°?  await setDoc(    pRef,    {      title: d.title ?? "",      price: d.price ?? 0,      description: d.description ?? "",      category: d.category ?? "",      images: d.images ?? [],      geo: d.geo ?? null,      address: d.address ?? null,      status: d.status ?? "?ë§¤ì¤?,      sellerId: uid,                     // ???¤ë„ˆ ?¤ì •      createdAt: d.createdAt ?? serverTimestamp(),      updatedAt: serverTimestamp(),      migratedFrom: "market",    },    { merge: true }  );  // (? íƒ) market ë¬¸ì„œ ?•ë¦¬  try { await deleteDoc(mRef); } catch {}  console.log("??market ??products ë§ˆì´ê·¸ë ˆ?´ì…˜ + sellerId ?¤ì • ?„ë£Œ:", productId);}// ?„ì¬ ?¬ìš©?ì˜ ëª¨ë“  ?í’ˆ??sellerId ?¤ì • (ë°±í•„ + ?´ë°± ì§€??export async function backfillMyProducts() {  const uid = auth.currentUser?.uid;  if (!uid) throw new Error('ë¡œê·¸?¸ì´ ?„ìš”?©ë‹ˆ??);    console.log('?”„ ???í’ˆ sellerId ë°±í•„ ?œì‘...');    try {    // ?„ì¬ ?í’ˆ ?ì„¸ ?˜ì´ì§€??IDë¥?ê°€?¸ì˜¤??ë°©ë²•    const currentProductId = window.location.pathname.split('/').pop();    if (currentProductId && currentProductId !== 'market') {      await setMyselfAsSeller(currentProductId);      console.log('???„ì¬ ?í’ˆ ë°±í•„ ?„ë£Œ');            // ?˜ì´ì§€ ?ˆë¡œê³ ì¹¨?¼ë¡œ ë³€ê²½ì‚¬??ë°˜ì˜      window.location.reload();    } else {      console.log('? ï¸ ?í’ˆ ?ì„¸ ?˜ì´ì§€?ì„œ ?¤í–‰?´ì£¼?¸ìš”');    }  } catch (error) {    console.error('??ë°±í•„ ?¤íŒ¨:', error);    throw error;  }}// ?¬ëŸ¬ ?í’ˆ????ë²ˆì— ë°±í•„ (?´ë°± ì§€??export async function backfillAllMyProducts() {  const uid = auth.currentUser?.uid;  if (!uid) throw new Error('ë¡œê·¸?¸ì´ ?„ìš”?©ë‹ˆ??);    console.log('?”„ ëª¨ë“  ?í’ˆ sellerId ë°±í•„ ?œì‘...');    try {    // 1. products ì»¬ë ‰?˜ì—?????í’ˆ ì°¾ê¸°    const productsQuery = query(      collection(db, 'products'),      where('sellerId', '==', uid)    );    const productsSnapshot = await getDocs(productsQuery);        // 2. market ì»¬ë ‰?˜ì—?????í’ˆ ì°¾ê¸° (?´ë°±)    const marketQuery = query(      collection(db, 'market'),      where('sellerId', '==', uid)    );    const marketSnapshot = await getDocs(marketQuery);        console.log(`?“Š ?í’ˆ ?„í™©: products ${productsSnapshot.size}ê°? market ${marketSnapshot.size}ê°?);        let processedCount = 0;        // 3. products???ˆëŠ” ?í’ˆ??sellerId ?¤ì •    for (const doc of productsSnapshot.docs) {      try {        await updateDoc(doc.ref, {          sellerId: uid,          updatedAt: serverTimestamp(),        });        processedCount++;        console.log(`??products: ${doc.id} sellerId ?¤ì • ?„ë£Œ`);      } catch (error) {        console.warn(`? ï¸ products: ${doc.id} sellerId ?¤ì • ?¤íŒ¨:`, error);      }    }        // 4. market?ë§Œ ?ˆëŠ” ?í’ˆ??productsë¡?ë§ˆì´ê·¸ë ˆ?´ì…˜ + sellerId ?¤ì •    for (const doc of marketSnapshot.docs) {      try {        const productId = doc.id;        const productData = doc.data();                // products???™ì¼ IDë¡??ì„±        await setDoc(          doc(db, 'products', productId),          {            title: productData.title ?? "",            price: productData.price ?? 0,            description: productData.description ?? "",            category: productData.category ?? "",            images: productData.images ?? [],            geo: productData.geo ?? null,            address: productData.address ?? null,            status: productData.status ?? "?ë§¤ì¤?,            sellerId: uid,                     // ???¤ë„ˆ ?¤ì •            createdAt: productData.createdAt ?? serverTimestamp(),            updatedAt: serverTimestamp(),            migratedFrom: "market-backfill",          },          { merge: true }        );                // (? íƒ) market ë¬¸ì„œ ?•ë¦¬        try { await deleteDoc(doc.ref); } catch {}                processedCount++;        console.log(`??market ??products ë§ˆì´ê·¸ë ˆ?´ì…˜: ${productId}`);      } catch (error) {        console.warn(`? ï¸ market ??products ë§ˆì´ê·¸ë ˆ?´ì…˜ ?¤íŒ¨ ${doc.id}:`, error);      }    }        console.log(`?‰ ë°±í•„ ?„ë£Œ! ì´?${processedCount}ê°??í’ˆ ì²˜ë¦¬??);    return processedCount;      } catch (error) {    console.error('???„ì²´ ë°±í•„ ?¤íŒ¨:', error);    throw error;  }}// ë¸Œë¼?°ì? ì½˜ì†”?ì„œ ì§ì ‘ ?¤í–‰??export function quickBackfill() {  console.log('?? ë¹ ë¥¸ ë°±í•„ ?¤í–‰...');  console.log('?¬ìš©ë²? backfillMyProducts() ?ëŠ” setMyselfAsSeller("?í’ˆID") ?ëŠ” backfillAllMyProducts()');    // ?„ì—­ ?¨ìˆ˜ë¡??±ë¡ (ë¸Œë¼?°ì? ì½˜ì†”?ì„œ ì§ì ‘ ?¸ì¶œ ê°€??  (window as any).backfillMyProducts = backfillMyProducts;  (window as any).setMyselfAsSeller = setMyselfAsSeller;  (window as any).backfillAllMyProducts = backfillAllMyProducts;    console.log('???„ì—­ ?¨ìˆ˜ ?±ë¡ ?„ë£Œ');  console.log('?“ ?„ì¬ ?í’ˆ ë°±í•„: backfillMyProducts()');  console.log('?“ ?¹ì • ?í’ˆ ë°±í•„: setMyselfAsSeller("?í’ˆID")');  console.log('?“ ëª¨ë“  ?í’ˆ ë°±í•„: backfillAllMyProducts()');}