import { collection, getDocs, query, where, orderBy, limit } from "firebase/firestore";import { db } from "@/lib/firebase";export type LatLng = { lat: number; lng: number };function haversineKm(a: LatLng, b: LatLng) {  const R = 6371; // km  const dLat = ((b.lat - a.lat) * Math.PI) / 180;  const dLng = ((b.lng - a.lng) * Math.PI) / 180;  const s1 = Math.sin(dLat / 2) ** 2;  const s2 = Math.cos((a.lat * Math.PI) / 180) * Math.cos((b.lat * Math.PI) / 180) * Math.sin(dLng / 2) ** 2;  return 2 * R * Math.asin(Math.sqrt(s1 + s2));}export async function fetchWithinRadius(collectionName: string, center: LatLng, radiusKm: number) {  // Firestore???¤ì¤‘ ?„ë“œ ë²”ìœ„ ì¿¼ë¦¬ê°€ ?œí•œ?ì´ë¯€ë¡?lat ë²”ìœ„ë¡?1ì°? lng???´ë¼?´ì–¸???„í„°  const latDelta = (radiusKm / 111); // ?„ë„ 1????111km  const minLat = center.lat - latDelta;  const maxLat = center.lat + latDelta;  const ref = collection(db, collectionName);  const q1 = query(ref, where("lat", ">=", minLat), where("lat", "<=", maxLat), limit(500));  const snap = await getDocs(q1);  const results: Array<{ id: string; title: string; lat: number; lng: number; distanceKm: number }> = [];  snap.forEach((d) => {    const v = d.data() as any;    if (typeof v.lat !== "number" || typeof v.lng !== "number") return;    const dist = haversineKm(center, { lat: v.lat, lng: v.lng });    if (dist <= radiusKm) {      results.push({ id: d.id, title: v.title || v.name || "Untitled", lat: v.lat, lng: v.lng, distanceKm: dist });    }  });  results.sort((a, b) => a.distanceKm - b.distanceKm);  return results.slice(0, 50);} 