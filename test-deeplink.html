<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YAGO VIBE ë”¥ë§í¬ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-card {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #4A90E2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 8px;
            font-size: 14px;
        }
        .test-button:hover {
            background: #357ABD;
        }
        .result {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            margin: 12px 0;
            font-family: monospace;
            font-size: 12px;
        }
        .success { border-left: 4px solid #28a745; }
        .error { border-left: 4px solid #dc3545; }
        .info { border-left: 4px solid #17a2b8; }
    </style>
</head>
<body>
    <h1>ğŸš€ YAGO VIBE ë”¥ë§í¬ í…ŒìŠ¤íŠ¸</h1>
    
    <div class="test-card">
        <h2>ğŸ“± 1. ì•Œë¦¼ ê¶Œí•œ í™•ì¸</h2>
        <button class="test-button" onclick="checkNotificationPermission()">ì•Œë¦¼ ê¶Œí•œ í™•ì¸</button>
        <div id="permission-result" class="result info" style="display:none;"></div>
    </div>

    <div class="test-card">
        <h2>ğŸ”— 2. ë”¥ë§í¬ í…ŒìŠ¤íŠ¸</h2>
        <p>ì•„ë˜ ë²„íŠ¼ë“¤ì„ í´ë¦­í•˜ì—¬ ê° í˜ì´ì§€ë¡œ ì •ìƒ ì´ë™í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”:</p>
        
        <button class="test-button" onclick="testNavigation('/chat/test-room-123')">
            ğŸ’¬ ì±„íŒ…ë°© ë”¥ë§í¬ í…ŒìŠ¤íŠ¸
        </button>
        
        <button class="test-button" onclick="testNavigation('/product/test-product-456')">
            ğŸ›’ ìƒí’ˆ í˜ì´ì§€ ë”¥ë§í¬ í…ŒìŠ¤íŠ¸
        </button>
        
        <button class="test-button" onclick="testNavigation('/market')">
            ğŸª ë§ˆì¼“ í˜ì´ì§€ í…ŒìŠ¤íŠ¸
        </button>
        
        <div id="navigation-result" class="result info" style="display:none;"></div>
    </div>

    <div class="test-card">
        <h2>ğŸ“¨ 3. í‘¸ì‹œ ì•Œë¦¼ ì‹œë®¬ë ˆì´ì…˜</h2>
        <p>ì‹¤ì œ í‘¸ì‹œ ì•Œë¦¼ì„ ì‹œë®¬ë ˆì´ì…˜í•˜ì—¬ ë”¥ë§í¬ê°€ ì‘ë™í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤:</p>
        
        <button class="test-button" onclick="simulatePushNotification('chat', 'test-room-123')">
            ğŸ’¬ ì±„íŒ… ì•Œë¦¼ ì‹œë®¬ë ˆì´ì…˜
        </button>
        
        <button class="test-button" onclick="simulatePushNotification('product', 'test-product-456')">
            âœ… ê±°ë˜ ì™„ë£Œ ì•Œë¦¼ ì‹œë®¬ë ˆì´ì…˜
        </button>
        
        <button class="test-button" onclick="simulatePushNotification('inquiry', 'test-room-789')">
            ğŸ›’ ìƒˆ ë¬¸ì˜ ì•Œë¦¼ ì‹œë®¬ë ˆì´ì…˜
        </button>
        
        <div id="push-result" class="result info" style="display:none;"></div>
    </div>

    <div class="test-card">
        <h2>ğŸ§ª 4. ì„œë¹„ìŠ¤ì›Œì»¤ ìƒíƒœ í™•ì¸</h2>
        <button class="test-button" onclick="checkServiceWorker()">ì„œë¹„ìŠ¤ì›Œì»¤ ìƒíƒœ í™•ì¸</button>
        <div id="sw-result" class="result info" style="display:none;"></div>
    </div>

    <script>
        // ì•Œë¦¼ ê¶Œí•œ í™•ì¸
        function checkNotificationPermission() {
            const result = document.getElementById('permission-result');
            
            if ('Notification' in window) {
                const permission = Notification.permission;
                result.className = `result ${permission === 'granted' ? 'success' : 'error'}`;
                result.innerHTML = `
                    <strong>ì•Œë¦¼ ê¶Œí•œ ìƒíƒœ:</strong> ${permission}<br>
                    ${permission === 'granted' ? 'âœ… ì•Œë¦¼ ê¶Œí•œì´ í—ˆìš©ë˜ì–´ ìˆìŠµë‹ˆë‹¤.' : 'âŒ ì•Œë¦¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.'}
                `;
            } else {
                result.className = 'result error';
                result.innerHTML = 'âŒ ì´ ë¸Œë¼ìš°ì €ëŠ” ì•Œë¦¼ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
            }
            result.style.display = 'block';
        }

        // ë”¥ë§í¬ ë„¤ë¹„ê²Œì´ì…˜ í…ŒìŠ¤íŠ¸
        function testNavigation(url) {
            const result = document.getElementById('navigation-result');
            
            try {
                // í˜„ì¬ í˜ì´ì§€ URL í™•ì¸
                const currentUrl = window.location.href;
                const baseUrl = currentUrl.split('/').slice(0, -1).join('/');
                const targetUrl = baseUrl + url;
                
                result.className = 'result info';
                result.innerHTML = `
                    <strong>ë”¥ë§í¬ í…ŒìŠ¤íŠ¸:</strong><br>
                    í˜„ì¬ URL: ${currentUrl}<br>
                    ì´ë™í•  URL: ${targetUrl}<br>
                    <a href="${url}" target="_blank">ğŸ”— ìƒˆ íƒ­ì—ì„œ ì—´ê¸°</a> | 
                    <a href="${url}">ğŸ“± í˜„ì¬ íƒ­ì—ì„œ ì´ë™</a>
                `;
                result.style.display = 'block';
            } catch (error) {
                result.className = 'result error';
                result.innerHTML = `âŒ ë”¥ë§í¬ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`;
                result.style.display = 'block';
            }
        }

        // í‘¸ì‹œ ì•Œë¦¼ ì‹œë®¬ë ˆì´ì…˜
        function simulatePushNotification(type, id) {
            const result = document.getElementById('push-result');
            
            if (Notification.permission !== 'granted') {
                result.className = 'result error';
                result.innerHTML = 'âŒ ì•Œë¦¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. ë¨¼ì € ì•Œë¦¼ ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                result.style.display = 'block';
                return;
            }

            let title, body, data;
            
            switch (type) {
                case 'chat':
                    title = 'ğŸ’¬ ìƒˆ ë©”ì‹œì§€';
                    body = 'ë©”ì‹œì§€ê°€ ë„ì°©í–ˆìŠµë‹ˆë‹¤.';
                    data = { roomId: id, clickUrl: `/chat/${id}` };
                    break;
                case 'product':
                    title = 'âœ… ê±°ë˜ ì™„ë£Œ';
                    body = 'ìƒí’ˆ ê±°ë˜ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.';
                    data = { productId: id, clickUrl: `/product/${id}` };
                    break;
                case 'inquiry':
                    title = 'ğŸ›’ ìƒˆ ë¬¸ì˜ ë„ì°©!';
                    body = 'ìƒˆë¡œìš´ ë¬¸ì˜ê°€ ë„ì°©í–ˆì–´ìš”.';
                    data = { roomId: id, clickUrl: `/chat/${id}` };
                    break;
            }

            const notification = new Notification(title, {
                body: body,
                icon: '/icons/icon-192.svg',
                data: data,
                requireInteraction: true
            });

            // í´ë¦­ ì´ë²¤íŠ¸ ì‹œë®¬ë ˆì´ì…˜
            notification.onclick = function(event) {
                const clickUrl = event.target.data.clickUrl || '/';
                result.className = 'result success';
                result.innerHTML = `
                    <strong>âœ… í‘¸ì‹œ ì•Œë¦¼ í´ë¦­ë¨:</strong><br>
                    ì œëª©: ${title}<br>
                    ì´ë™í•  URL: ${clickUrl}<br>
                    <a href="${clickUrl}" target="_blank">ğŸ”— ìƒˆ íƒ­ì—ì„œ ì—´ê¸°</a>
                `;
                result.style.display = 'block';
                notification.close();
            };

            result.className = 'result info';
            result.innerHTML = `
                <strong>ğŸ“¨ í‘¸ì‹œ ì•Œë¦¼ ì‹œë®¬ë ˆì´ì…˜:</strong><br>
                ì œëª©: ${title}<br>
                ë‚´ìš©: ${body}<br>
                ë°ì´í„°: ${JSON.stringify(data)}<br>
                <em>ì•Œë¦¼ì„ í´ë¦­í•˜ì—¬ ë”¥ë§í¬ë¥¼ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.</em>
            `;
            result.style.display = 'block';
        }

        // ì„œë¹„ìŠ¤ì›Œì»¤ ìƒíƒœ í™•ì¸
        function checkServiceWorker() {
            const result = document.getElementById('sw-result');
            
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(registrations => {
                    if (registrations.length > 0) {
                        result.className = 'result success';
                        result.innerHTML = `
                            <strong>âœ… ì„œë¹„ìŠ¤ì›Œì»¤ ë“±ë¡ë¨:</strong><br>
                            ë“±ë¡ëœ SW ê°œìˆ˜: ${registrations.length}<br>
                            ${registrations.map(reg => `- ${reg.scope}`).join('<br>')}
                        `;
                    } else {
                        result.className = 'result error';
                        result.innerHTML = 'âŒ ë“±ë¡ëœ ì„œë¹„ìŠ¤ì›Œì»¤ê°€ ì—†ìŠµë‹ˆë‹¤.';
                    }
                    result.style.display = 'block';
                });
            } else {
                result.className = 'result error';
                result.innerHTML = 'âŒ ì´ ë¸Œë¼ìš°ì €ëŠ” ì„œë¹„ìŠ¤ì›Œì»¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                result.style.display = 'block';
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        window.onload = function() {
            console.log('ğŸš€ YAGO VIBE ë”¥ë§í¬ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œë¨');
            checkNotificationPermission();
            checkServiceWorker();
        };
    </script>
</body>
</html>
